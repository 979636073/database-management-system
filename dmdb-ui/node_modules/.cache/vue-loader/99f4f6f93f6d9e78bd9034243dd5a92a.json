{"remainingRequest":"D:\\开发\\database-management-system\\dmdb-ui\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\开发\\database-management-system\\dmdb-ui\\src\\components\\MultiWindowLayout.vue?vue&type=script&lang=js","dependencies":[{"path":"D:\\开发\\database-management-system\\dmdb-ui\\src\\components\\MultiWindowLayout.vue","mtime":1770390073400},{"path":"D:\\开发\\database-management-system\\dmdb-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\开发\\database-management-system\\dmdb-ui\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"D:\\开发\\database-management-system\\dmdb-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\开发\\database-management-system\\dmdb-ui\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQppbXBvcnQgcmVxdWVzdCBmcm9tICJAL3V0aWxzL3JlcXVlc3QiOw0KaW1wb3J0IFRhYmxlRGV0YWlsIGZyb20gIi4vVGFibGVEZXRhaWwudnVlIjsNCmltcG9ydCBSb2xlRGV0YWlsIGZyb20gIi4vUm9sZURldGFpbC52dWUiOw0KDQpjb25zdCBTVE9SQUdFX0tFWSA9ICJETURCX0NPTk5FQ1RJT05TIjsNCg0KZXhwb3J0IGRlZmF1bHQgew0KICBuYW1lOiAiTXVsdGlXaW5kb3dMYXlvdXQiLA0KICBjb21wb25lbnRzOiB7IFRhYmxlRGV0YWlsLCBSb2xlRGV0YWlsIH0sDQogIGRhdGEoKSB7DQogICAgcmV0dXJuIHsNCiAgICAgIGZpbHRlclRleHQ6ICIiLA0KICAgICAgdHJlZURhdGE6IFtdLA0KICAgICAgZGVmYXVsdFByb3BzOiB7IGxhYmVsOiAibGFiZWwiLCBpc0xlYWY6ICJsZWFmIiB9LA0KICAgICAgdGFiczogW10sDQogICAgICBhY3RpdmVUYWI6ICIiLA0KDQogICAgICBnbG9iYWxWaWV3TW9kZTogImRhdGEiLA0KDQogICAgICBpc1JlZnJlc2hpbmc6IGZhbHNlLA0KICAgICAgZGlhbG9nVmlzaWJsZTogZmFsc2UsDQogICAgICBpc0VkaXRNb2RlOiBmYWxzZSwNCiAgICAgIGN1cnJlbnRFZGl0Tm9kZTogbnVsbCwNCiAgICAgIGRpYWxvZ1RpdGxlOiAi5paw5bu66L+e5o6lIiwNCiAgICAgIGNvbm5lY3Rpbmc6IGZhbHNlLA0KICAgICAgdGVzdGluZzogZmFsc2UsDQogICAgICBjb25uRm9ybTogew0KICAgICAgICBuYW1lOiAi5pys5Zyw6L6+5qKmIiwNCiAgICAgICAgaG9zdDogImxvY2FsaG9zdCIsDQogICAgICAgIHBvcnQ6ICI1MjM2IiwNCiAgICAgICAgdXNlcjogIlNZU0RCQSIsDQogICAgICAgIHBhc3N3b3JkOiAiIiwNCiAgICAgIH0sDQoNCiAgICAgIHN1Ym1pdHRpbmc6IGZhbHNlLA0KICAgICAgY3VycmVudE5vZGVEYXRhOiBudWxsLA0KICAgICAgY3VycmVudE5vZGVSZWY6IG51bGwsDQoNCiAgICAgIC8vIOihqC/op4blm74v6Kem5Y+R5ZmoIOW8ueeql+eKtuaAgQ0KICAgICAgY3JlYXRlVGFibGVWaXNpYmxlOiBmYWxzZSwNCiAgICAgIHRhYmxlRm9ybTogew0KICAgICAgICB0YWJsZU5hbWU6ICIiLA0KICAgICAgICBjb2x1bW5zOiBbDQogICAgICAgICAgeyBuYW1lOiAiSUQiLCB0eXBlOiAiSU5URUdFUiIsIGxlbmd0aDogIiIsIHBrOiB0cnVlLCBub3ROdWxsOiB0cnVlIH0sDQogICAgICAgIF0sDQogICAgICB9LA0KICAgICAgY3JlYXRlVmlld1Zpc2libGU6IGZhbHNlLA0KICAgICAgdmlld0Zvcm06IHsgbmFtZTogIiIsIHNxbDogIiIgfSwNCiAgICAgIGNyZWF0ZVRyaWdnZXJWaXNpYmxlOiBmYWxzZSwNCiAgICAgIHRyaWdnZXJTcWw6ICIiLA0KDQogICAgICAvLyDop5LoibLlvLnnqpfnirbmgIENCiAgICAgIGNyZWF0ZVJvbGVWaXNpYmxlOiBmYWxzZSwNCiAgICAgIHJvbGVGb3JtOiB7IG5hbWU6ICIiIH0NCiAgICB9Ow0KICB9LA0KICB3YXRjaDogew0KICAgIGZpbHRlclRleHQodmFsKSB7DQogICAgICB0aGlzLiRyZWZzLnRyZWUuZmlsdGVyKHZhbCk7DQogICAgfSwNCiAgfSwNCiAgY3JlYXRlZCgpIHsNCiAgICB0aGlzLnJlc3RvcmVDb25uZWN0aW9ucygpOw0KICB9LA0KICBtZXRob2RzOiB7DQogICAgZmlsdGVyTm9kZSh2YWx1ZSwgZGF0YSkgew0KICAgICAgaWYgKCF2YWx1ZSkgcmV0dXJuIHRydWU7DQogICAgICByZXR1cm4gZGF0YS5sYWJlbC50b0xvd2VyQ2FzZSgpLmluZGV4T2YodmFsdWUudG9Mb3dlckNhc2UoKSkgIT09IC0xOw0KICAgIH0sDQogICAgLy8g44CQ5qC45b+D44CR5qC55o2u6IqC54K557G75Z6L6L+U5Zue5Zu+5qCHDQogICAgZ2V0SWNvbih0eXBlKSB7DQogICAgICBpZiAodHlwZSA9PT0gInJvb3QiKSByZXR1cm4gImVsLWljb24tY29ubmVjdGlvbiI7DQogICAgICBpZiAodHlwZSA9PT0gImZvbGRlcl9zY2hlbWEiKSByZXR1cm4gImVsLWljb24tZmlsZXMiOw0KICAgICAgaWYgKHR5cGUgPT09ICJmb2xkZXJfcm9sZSIpIHJldHVybiAiZWwtaWNvbi11c2VyLXNvbGlkIjsgLy8g6KeS6Imy5paH5Lu25aS55Zu+5qCHDQogICAgICBpZiAodHlwZSA9PT0gInNjaGVtYSIpIHJldHVybiAiZWwtaWNvbi1mb2xkZXItb3BlbmVkIjsNCiAgICAgIGlmICh0eXBlICYmIHR5cGUuc3RhcnRzV2l0aCgiZm9sZGVyXyIpKSByZXR1cm4gImVsLWljb24tZm9sZGVyIjsNCiAgICAgIGlmICh0eXBlID09PSAidGFibGUiKSByZXR1cm4gImVsLWljb24tZG9jdW1lbnQtY29weSI7DQogICAgICBpZiAodHlwZSA9PT0gInZpZXciKSByZXR1cm4gImVsLWljb24tdmlldyI7DQogICAgICBpZiAodHlwZSA9PT0gInRyaWdnZXIiKSByZXR1cm4gImVsLWljb24tcy1vcGVyYXRpb24iOw0KICAgICAgaWYgKHR5cGUgPT09ICJyb2xlIikgcmV0dXJuICJlbC1pY29uLXVzZXIiOyAvLyDlhbfkvZPop5LoibLlm77moIcNCiAgICAgIHJldHVybiAiZWwtaWNvbi1kb2N1bWVudCI7DQogICAgfSwNCiAgICBoYW5kbGVWaWV3TW9kZUNoYW5nZShtb2RlKSB7DQogICAgICB0aGlzLmdsb2JhbFZpZXdNb2RlID0gbW9kZTsNCiAgICB9LA0KICAgIGhhbmRsZVJlZnJlc2goKSB7DQogICAgICB0aGlzLmlzUmVmcmVzaGluZyA9IHRydWU7DQogICAgICB0aGlzLnRyZWVEYXRhID0gW107DQogICAgICB0aGlzLiRuZXh0VGljaygoKSA9PiB7DQogICAgICAgIHRoaXMucmVzdG9yZUNvbm5lY3Rpb25zKCk7DQogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgICAgIHRoaXMuaXNSZWZyZXNoaW5nID0gZmFsc2U7DQogICAgICAgICAgdGhpcy4kbWVzc2FnZS5zdWNjZXNzKCLliJfooajlt7LliLfmlrAiKTsNCiAgICAgICAgfSwgNTAwKTsNCiAgICAgIH0pOw0KICAgIH0sDQogICAgcmVzdG9yZUNvbm5lY3Rpb25zKCkgew0KICAgICAgY29uc3QgY2FjaGVkID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oU1RPUkFHRV9LRVkpOw0KICAgICAgaWYgKGNhY2hlZCkgew0KICAgICAgICB0cnkgew0KICAgICAgICAgIGNvbnN0IGxpc3QgPSBKU09OLnBhcnNlKGNhY2hlZCk7DQogICAgICAgICAgdGhpcy50cmVlRGF0YSA9IGxpc3QubWFwKChpdGVtKSA9PiAoew0KICAgICAgICAgICAgLi4uaXRlbSwNCiAgICAgICAgICAgIGxvYWRpbmc6IHRydWUsDQogICAgICAgICAgICBjb25uU3RhdHVzOiAiY29ubmVjdGluZyIsDQogICAgICAgICAgICBlcnJvck1zZzogIiIsDQogICAgICAgICAgfSkpOw0KICAgICAgICAgIHRoaXMudHJlZURhdGEuZm9yRWFjaChhc3luYyAobm9kZSkgPT4gew0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgcmVxdWVzdC5wb3N0KCIvY29ubmVjdGlvbi9jb25uZWN0Iiwgew0KICAgICAgICAgICAgICAgIGlkOiBub2RlLmlkLA0KICAgICAgICAgICAgICAgIC4uLm5vZGUuY29uZmlnLA0KICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0Tm9kZSA9IHRoaXMudHJlZURhdGEuZmluZChuID0+IG4uaWQgPT09IG5vZGUuaWQpOw0KICAgICAgICAgICAgICBpZiAodGFyZ2V0Tm9kZSkgew0KICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5jb2RlID09PSAyMDApIHsNCiAgICAgICAgICAgICAgICAgIHRoaXMuJHNldCh0YXJnZXROb2RlLCAnbG9hZGluZycsIGZhbHNlKTsNCiAgICAgICAgICAgICAgICAgIHRoaXMuJHNldCh0YXJnZXROb2RlLCAnY29ublN0YXR1cycsICdzdWNjZXNzJyk7DQogICAgICAgICAgICAgICAgICB0aGlzLiRzZXQodGFyZ2V0Tm9kZSwgJ2Vycm9yTXNnJywgJycpOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICB0aGlzLiRzZXQodGFyZ2V0Tm9kZSwgJ2xvYWRpbmcnLCBmYWxzZSk7DQogICAgICAgICAgICAgICAgICB0aGlzLiRzZXQodGFyZ2V0Tm9kZSwgJ2Nvbm5TdGF0dXMnLCAnZmFpbCcpOw0KICAgICAgICAgICAgICAgICAgdGhpcy4kc2V0KHRhcmdldE5vZGUsICdlcnJvck1zZycsIHJlcy5kYXRhLm1zZyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgICAgIGNvbnN0IG1zZyA9IGUucmVzcG9uc2U/LmRhdGE/Lm1zZyB8fCBlLm1lc3NhZ2UgfHwgIui/nuaOpeWksei0pSI7DQogICAgICAgICAgICAgIGNvbnN0IHRhcmdldE5vZGUgPSB0aGlzLnRyZWVEYXRhLmZpbmQobiA9PiBuLmlkID09PSBub2RlLmlkKTsNCiAgICAgICAgICAgICAgaWYgKHRhcmdldE5vZGUpIHsNCiAgICAgICAgICAgICAgICB0aGlzLiRzZXQodGFyZ2V0Tm9kZSwgJ2xvYWRpbmcnLCBmYWxzZSk7DQogICAgICAgICAgICAgICAgdGhpcy4kc2V0KHRhcmdldE5vZGUsICdjb25uU3RhdHVzJywgJ2ZhaWwnKTsNCiAgICAgICAgICAgICAgICB0aGlzLiRzZXQodGFyZ2V0Tm9kZSwgJ2Vycm9yTXNnJywgbXNnKTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0pOw0KICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgY29uc29sZS5lcnJvcigiUmVzdG9yZSBmYWlsZWQ6IiwgZSk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9LA0KICAgIHNhdmVDb25uZWN0aW9ucygpIHsNCiAgICAgIGNvbnN0IGxpc3RUb1NhdmUgPSB0aGlzLnRyZWVEYXRhLm1hcCgobm9kZSkgPT4gKHsNCiAgICAgICAgaWQ6IG5vZGUuaWQsDQogICAgICAgIGxhYmVsOiBub2RlLmxhYmVsLA0KICAgICAgICB0eXBlOiAicm9vdCIsDQogICAgICAgIGxlYWY6IGZhbHNlLA0KICAgICAgICBjb25maWc6IG5vZGUuY29uZmlnLA0KICAgICAgfSkpOw0KICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oU1RPUkFHRV9LRVksIEpTT04uc3RyaW5naWZ5KGxpc3RUb1NhdmUpKTsNCiAgICB9LA0KDQogICAgLy8g44CQ5qC45b+D44CR6IqC54K55Yqg6L296YC76L6RDQogICAgYXN5bmMgbG9hZE5vZGUobm9kZSwgcmVzb2x2ZSkgew0KICAgICAgaWYgKG5vZGUubGV2ZWwgPT09IDApIHJldHVybiByZXNvbHZlKHRoaXMudHJlZURhdGEpOw0KICAgICAgY29uc3QgZGF0YSA9IG5vZGUuZGF0YTsNCg0KICAgICAgaWYgKGRhdGEubG9hZGluZykgew0KICAgICAgICB0aGlzLiRtZXNzYWdlLndhcm5pbmcoIuato+WcqOWwneivleaBouWkjei/nuaOpe+8jOivt+eojeWAmS4uLiIpOw0KICAgICAgICByZXR1cm4gcmVzb2x2ZShbXSk7DQogICAgICB9DQogICAgICBpZiAoZGF0YS50eXBlID09PSAicm9vdCIgJiYgZGF0YS5jb25uU3RhdHVzID09PSAiZmFpbCIpIHsNCiAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcihkYXRhLmVycm9yTXNnIHx8ICLov57mjqXkuI3lj6/nlKgiKTsNCiAgICAgICAgcmV0dXJuIHJlc29sdmUoW10pOw0KICAgICAgfQ0KDQogICAgICBpZiAoZGF0YS50eXBlID09PSAicm9vdCIpIHsNCiAgICAgICAgcmVzb2x2ZShbDQogICAgICAgICAgeyBsYWJlbDogJ+aooeW8jycsIHR5cGU6ICdmb2xkZXJfc2NoZW1hJywgY29ubklkOiBkYXRhLmlkLCBjb25uTmFtZTogZGF0YS5sYWJlbCwgbGVhZjogZmFsc2UgfSwNCiAgICAgICAgICAvLyDjgJDmlrDlop7jgJHop5LoibLnrqHnkIblhaXlj6PoioLngrkNCiAgICAgICAgICB7IGxhYmVsOiAn6KeS6ImyJywgdHlwZTogJ2ZvbGRlcl9yb2xlJywgY29ubklkOiBkYXRhLmlkLCBjb25uTmFtZTogZGF0YS5sYWJlbCwgbGVhZjogZmFsc2UgfQ0KICAgICAgICBdKTsNCiAgICAgIH0gZWxzZSBpZiAoZGF0YS50eXBlID09PSAiZm9sZGVyX3JvbGUiKSB7DQogICAgICAgIC8vIOOAkOaWsOWinuOAkeWKoOi9veinkuiJsuWIl+ihqA0KICAgICAgICB0cnkgew0KICAgICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHJlcXVlc3QuZ2V0KCIvZGIvcm9sZXMiLCB7IGhlYWRlcnM6IHsgIkNvbm4tSWQiOiBkYXRhLmNvbm5JZCB9IH0pOw0KICAgICAgICAgIGNvbnN0IHJvbGVzID0gKHJlcy5kYXRhLmRhdGEgfHwgW10pLm1hcChyID0+ICh7DQogICAgICAgICAgICBsYWJlbDogci5ST0xFX05BTUUsDQogICAgICAgICAgICB0eXBlOiAicm9sZSIsDQogICAgICAgICAgICBjb25uSWQ6IGRhdGEuY29ubklkLA0KICAgICAgICAgICAgY29ubk5hbWU6IGRhdGEuY29ubk5hbWUsDQogICAgICAgICAgICBsZWFmOiB0cnVlDQogICAgICAgICAgfSkpOw0KICAgICAgICAgIHJlc29sdmUocm9sZXMpOw0KICAgICAgICB9IGNhdGNoIChlKSB7IHJlc29sdmUoW10pOyB9DQogICAgICB9IGVsc2UgaWYgKGRhdGEudHlwZSA9PT0gImZvbGRlcl9zY2hlbWEiKSB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgcmVxdWVzdC5nZXQoIi9kYi9zY2hlbWFzIiwgew0KICAgICAgICAgICAgaGVhZGVyczogeyAiQ29ubi1JZCI6IGRhdGEuY29ubklkIH0sDQogICAgICAgICAgfSk7DQogICAgICAgICAgY29uc3Qgc29ydGVkU2NoZW1hcyA9IChyZXMuZGF0YS5kYXRhIHx8IFtdKS5zb3J0KChhLCBiKSA9PiBhLmxvY2FsZUNvbXBhcmUoYikpOw0KICAgICAgICAgIGNvbnN0IHNjaGVtYU5vZGVzID0gc29ydGVkU2NoZW1hcy5tYXAoKHMpID0+ICh7DQogICAgICAgICAgICBsYWJlbDogcywNCiAgICAgICAgICAgIHR5cGU6ICJzY2hlbWEiLA0KICAgICAgICAgICAgY29ubklkOiBkYXRhLmNvbm5JZCwNCiAgICAgICAgICAgIGNvbm5OYW1lOiBkYXRhLmNvbm5OYW1lLA0KICAgICAgICAgICAgbGVhZjogZmFsc2UsDQogICAgICAgICAgfSkpOw0KICAgICAgICAgIHJlc29sdmUoc2NoZW1hTm9kZXMpOw0KICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgcmVzb2x2ZShbXSk7DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSBpZiAoZGF0YS50eXBlID09PSAic2NoZW1hIikgew0KICAgICAgICByZXNvbHZlKFsNCiAgICAgICAgICB7IGxhYmVsOiAi5pWw5o2u6KGoIiwgdHlwZTogImZvbGRlcl90YWJsZSIsIGNvbm5JZDogZGF0YS5jb25uSWQsIGNvbm5OYW1lOiBkYXRhLmNvbm5OYW1lLCBzY2hlbWE6IGRhdGEubGFiZWwsIGxlYWY6IGZhbHNlIH0sDQogICAgICAgICAgeyBsYWJlbDogIuinhuWbviIsIHR5cGU6ICJmb2xkZXJfdmlldyIsIGNvbm5JZDogZGF0YS5jb25uSWQsIGNvbm5OYW1lOiBkYXRhLmNvbm5OYW1lLCBzY2hlbWE6IGRhdGEubGFiZWwsIGxlYWY6IGZhbHNlIH0sDQogICAgICAgICAgeyBsYWJlbDogIuinpuWPkeWZqCIsIHR5cGU6ICJmb2xkZXJfdHJpZ2dlciIsIGNvbm5JZDogZGF0YS5jb25uSWQsIGNvbm5OYW1lOiBkYXRhLmNvbm5OYW1lLCBzY2hlbWE6IGRhdGEubGFiZWwsIGxlYWY6IGZhbHNlIH0sDQogICAgICAgIF0pOw0KICAgICAgfSBlbHNlIGlmIChkYXRhLnR5cGUgPT09ICJmb2xkZXJfdGFibGUiKSB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgcmVxdWVzdC5nZXQoIi9kYi90YWJsZXMiLCB7DQogICAgICAgICAgICBwYXJhbXM6IHsgc2NoZW1hOiBkYXRhLnNjaGVtYSB9LA0KICAgICAgICAgICAgaGVhZGVyczogeyAiQ29ubi1JZCI6IGRhdGEuY29ubklkIH0sDQogICAgICAgICAgfSk7DQogICAgICAgICAgY29uc3QgdGFibGVzID0gcmVzLmRhdGEuZGF0YS5tYXAoKHQpID0+ICh7DQogICAgICAgICAgICBsYWJlbDogdC5UQUJMRV9OQU1FLA0KICAgICAgICAgICAgY29tbWVudDogdC5DT01NRU5UUywNCiAgICAgICAgICAgIHR5cGU6ICJ0YWJsZSIsDQogICAgICAgICAgICBjb25uSWQ6IGRhdGEuY29ubklkLA0KICAgICAgICAgICAgY29ubk5hbWU6IGRhdGEuY29ubk5hbWUsDQogICAgICAgICAgICBzY2hlbWE6IGRhdGEuc2NoZW1hLA0KICAgICAgICAgICAgbGVhZjogdHJ1ZSwNCiAgICAgICAgICB9KSk7DQogICAgICAgICAgcmVzb2x2ZSh0YWJsZXMpOw0KICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgcmVzb2x2ZShbXSk7DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSBpZiAoZGF0YS50eXBlID09PSAiZm9sZGVyX3ZpZXciKSB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgcmVxdWVzdC5nZXQoIi9kYi92aWV3cyIsIHsNCiAgICAgICAgICAgIHBhcmFtczogeyBzY2hlbWE6IGRhdGEuc2NoZW1hIH0sDQogICAgICAgICAgICBoZWFkZXJzOiB7ICJDb25uLUlkIjogZGF0YS5jb25uSWQgfSwNCiAgICAgICAgICB9KTsNCiAgICAgICAgICBjb25zdCB2aWV3cyA9IHJlcy5kYXRhLmRhdGEubWFwKCh2KSA9PiAoew0KICAgICAgICAgICAgbGFiZWw6IHYuVklFV19OQU1FLA0KICAgICAgICAgICAgdHlwZTogInZpZXciLA0KICAgICAgICAgICAgY29ubklkOiBkYXRhLmNvbm5JZCwNCiAgICAgICAgICAgIGNvbm5OYW1lOiBkYXRhLmNvbm5OYW1lLA0KICAgICAgICAgICAgc2NoZW1hOiBkYXRhLnNjaGVtYSwNCiAgICAgICAgICAgIGxlYWY6IHRydWUsDQogICAgICAgICAgfSkpOw0KICAgICAgICAgIHJlc29sdmUodmlld3MpOw0KICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgcmVzb2x2ZShbXSk7DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSBpZiAoZGF0YS50eXBlID09PSAiZm9sZGVyX3RyaWdnZXIiKSB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgcmVxdWVzdC5nZXQoIi9kYi90cmlnZ2VycyIsIHsNCiAgICAgICAgICAgIHBhcmFtczogeyBzY2hlbWE6IGRhdGEuc2NoZW1hIH0sDQogICAgICAgICAgICBoZWFkZXJzOiB7ICJDb25uLUlkIjogZGF0YS5jb25uSWQgfSwNCiAgICAgICAgICB9KTsNCiAgICAgICAgICBjb25zdCB0cmlnZ2VycyA9IHJlcy5kYXRhLmRhdGEubWFwKCh0KSA9PiAoew0KICAgICAgICAgICAgbGFiZWw6IHQuVFJJR0dFUl9OQU1FLA0KICAgICAgICAgICAgc3RhdHVzOiB0LlNUQVRVUywNCiAgICAgICAgICAgIHR5cGU6ICJ0cmlnZ2VyIiwNCiAgICAgICAgICAgIGNvbm5JZDogZGF0YS5jb25uSWQsDQogICAgICAgICAgICBjb25uTmFtZTogZGF0YS5jb25uTmFtZSwNCiAgICAgICAgICAgIHNjaGVtYTogZGF0YS5zY2hlbWEsDQogICAgICAgICAgICBsZWFmOiB0cnVlLA0KICAgICAgICAgIH0pKTsNCiAgICAgICAgICByZXNvbHZlKHRyaWdnZXJzKTsNCiAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgIHJlc29sdmUoW10pOw0KICAgICAgICB9DQogICAgICB9IGVsc2Ugew0KICAgICAgICByZXNvbHZlKFtdKTsNCiAgICAgIH0NCiAgICB9LA0KDQogICAgb3BlbkFkZERpYWxvZygpIHsNCiAgICAgIHRoaXMuaXNFZGl0TW9kZSA9IGZhbHNlOw0KICAgICAgdGhpcy5kaWFsb2dUaXRsZSA9ICLmlrDlu7rov57mjqUiOw0KICAgICAgdGhpcy5jb25uRm9ybSA9IHsNCiAgICAgICAgbmFtZTogIuacrOWcsOi+vuaipiIsDQogICAgICAgIGhvc3Q6ICJsb2NhbGhvc3QiLA0KICAgICAgICBwb3J0OiAiNTIzNiIsDQogICAgICAgIHVzZXI6ICJTWVNEQkEiLA0KICAgICAgICBwYXNzd29yZDogIiIsDQogICAgICB9Ow0KICAgICAgdGhpcy5kaWFsb2dWaXNpYmxlID0gdHJ1ZTsNCiAgICB9LA0KICAgIG9wZW5FZGl0RGlhbG9nKGRhdGEpIHsNCiAgICAgIHRoaXMuaXNFZGl0TW9kZSA9IHRydWU7DQogICAgICB0aGlzLmN1cnJlbnRFZGl0Tm9kZSA9IGRhdGE7DQogICAgICB0aGlzLmRpYWxvZ1RpdGxlID0gIue8lui+kei/nuaOpSI7DQogICAgICB0aGlzLmNvbm5Gb3JtID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkYXRhLmNvbmZpZyB8fCB7fSkpOw0KICAgICAgaWYgKCFkYXRhLmNvbmZpZykgdGhpcy5jb25uRm9ybS5uYW1lID0gZGF0YS5sYWJlbDsNCiAgICAgIHRoaXMuZGlhbG9nVmlzaWJsZSA9IHRydWU7DQogICAgfSwNCiAgICB2YWxpZGF0ZUNvbm5OYW1lKG5hbWUpIHsNCiAgICAgIGlmICghbmFtZSB8fCAhbmFtZS50cmltKCkpIHJldHVybiBmYWxzZTsNCiAgICAgIGNvbnN0IGV4aXN0ID0gdGhpcy50cmVlRGF0YS5maW5kKChub2RlKSA9PiB7DQogICAgICAgIGlmICh0aGlzLmlzRWRpdE1vZGUgJiYgdGhpcy5jdXJyZW50RWRpdE5vZGUpIHsNCiAgICAgICAgICByZXR1cm4gbm9kZS5sYWJlbCA9PT0gbmFtZSAmJiBub2RlLmlkICE9PSB0aGlzLmN1cnJlbnRFZGl0Tm9kZS5pZDsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gbm9kZS5sYWJlbCA9PT0gbmFtZTsNCiAgICAgIH0pOw0KICAgICAgcmV0dXJuICFleGlzdDsNCiAgICB9LA0KICAgIGFzeW5jIHRlc3RDb25uZWN0aW9uKCkgew0KICAgICAgdGhpcy50ZXN0aW5nID0gdHJ1ZTsNCiAgICAgIHRyeSB7DQogICAgICAgIGNvbnN0IHBheWxvYWQgPSB7IC4uLnRoaXMuY29ubkZvcm0gfTsNCiAgICAgICAgaWYgKHRoaXMuaXNFZGl0TW9kZSAmJiB0aGlzLmN1cnJlbnRFZGl0Tm9kZSkgew0KICAgICAgICAgIHBheWxvYWQuaWQgPSB0aGlzLmN1cnJlbnRFZGl0Tm9kZS5pZDsNCiAgICAgICAgfQ0KICAgICAgICBjb25zdCByZXMgPSBhd2FpdCByZXF1ZXN0LnBvc3QoIi9jb25uZWN0aW9uL2Nvbm5lY3QiLCBwYXlsb2FkKTsNCiAgICAgICAgaWYgKHJlcy5kYXRhLmNvZGUgPT09IDIwMCkgew0KICAgICAgICAgIHRoaXMuJG1lc3NhZ2Uuc3VjY2Vzcygi6L+e5o6l5oiQ5Yqf77yBIik7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcigi6L+e5o6l5aSx6LSlOiAiICsgcmVzLmRhdGEubXNnKTsNCiAgICAgICAgfQ0KICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCLov57mjqXlvILluLjvvIzor7fmo4Dmn6XnvZHnu5wiKTsNCiAgICAgIH0gZmluYWxseSB7DQogICAgICAgIHRoaXMudGVzdGluZyA9IGZhbHNlOw0KICAgICAgfQ0KICAgIH0sDQogICAgYXN5bmMgc3VibWl0Q29ubmVjdGlvbigpIHsNCiAgICAgIGlmICghdGhpcy5jb25uRm9ybS5uYW1lKSB7DQogICAgICAgIHRoaXMuJG1lc3NhZ2Uud2FybmluZygi6K+36L6T5YWl6L+e5o6l5ZCN56ewIik7DQogICAgICAgIHJldHVybjsNCiAgICAgIH0NCiAgICAgIGlmICghdGhpcy52YWxpZGF0ZUNvbm5OYW1lKHRoaXMuY29ubkZvcm0ubmFtZSkpIHsNCiAgICAgICAgdGhpcy4kbWVzc2FnZS53YXJuaW5nKCLov57mjqXlkI3np7Dlt7LlrZjlnKjvvIzor7fkvb/nlKjlhbbku5blkI3np7AiKTsNCiAgICAgICAgcmV0dXJuOw0KICAgICAgfQ0KICAgICAgdGhpcy5jb25uZWN0aW5nID0gdHJ1ZTsNCiAgICAgIHRyeSB7DQogICAgICAgIGlmICh0aGlzLmlzRWRpdE1vZGUpIHsNCiAgICAgICAgICBjb25zdCBjb25uSWQgPSB0aGlzLmN1cnJlbnRFZGl0Tm9kZS5pZDsNCiAgICAgICAgICBjb25zdCByZXMgPSBhd2FpdCByZXF1ZXN0LnBvc3QoIi9jb25uZWN0aW9uL2Nvbm5lY3QiLCB7DQogICAgICAgICAgICBpZDogY29ubklkLA0KICAgICAgICAgICAgLi4udGhpcy5jb25uRm9ybSwNCiAgICAgICAgICB9KTsNCiAgICAgICAgICBpZiAocmVzLmRhdGEuY29kZSAhPT0gMjAwKSB7DQogICAgICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKHJlcy5kYXRhLm1zZyB8fCAi6L+e5o6l5aSx6LSl77yM5peg5rOV5L+d5a2Y6YWN572uIik7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgfQ0KICAgICAgICAgIGNvbnN0IHRhcmdldE5vZGUgPSB0aGlzLnRyZWVEYXRhLmZpbmQobiA9PiBuLmlkID09PSBjb25uSWQpOw0KICAgICAgICAgIGlmICh0YXJnZXROb2RlKSB7DQogICAgICAgICAgICB0aGlzLiRzZXQodGFyZ2V0Tm9kZSwgImxhYmVsIiwgdGhpcy5jb25uRm9ybS5uYW1lKTsNCiAgICAgICAgICAgIHRoaXMuJHNldCh0YXJnZXROb2RlLCAiY29uZmlnIiwgSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLmNvbm5Gb3JtKSkpOw0KICAgICAgICAgICAgdGhpcy4kc2V0KHRhcmdldE5vZGUsICJjb25uU3RhdHVzIiwgInN1Y2Nlc3MiKTsNCiAgICAgICAgICAgIHRoaXMuJHNldCh0YXJnZXROb2RlLCAiZXJyb3JNc2ciLCAiIik7DQogICAgICAgICAgICB0aGlzLiRzZXQodGFyZ2V0Tm9kZSwgImxvYWRpbmciLCBmYWxzZSk7DQogICAgICAgICAgfQ0KICAgICAgICAgIHRoaXMuc2F2ZUNvbm5lY3Rpb25zKCk7DQogICAgICAgICAgdGhpcy4kbWVzc2FnZS5zdWNjZXNzKCLmm7TmlrDmiJDlip8iKTsNCiAgICAgICAgICB0aGlzLmRpYWxvZ1Zpc2libGUgPSBmYWxzZTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBjb25zdCByZXMgPSBhd2FpdCByZXF1ZXN0LnBvc3QoIi9jb25uZWN0aW9uL2Nvbm5lY3QiLCB0aGlzLmNvbm5Gb3JtKTsNCiAgICAgICAgICBpZiAocmVzLmRhdGEuY29kZSA9PT0gMjAwKSB7DQogICAgICAgICAgICBjb25zdCBuZXdJZCA9IHJlcy5kYXRhLmRhdGE7DQogICAgICAgICAgICBjb25zdCBleGlzdHMgPSB0aGlzLnRyZWVEYXRhLnNvbWUobiA9PiBuLmlkID09PSBuZXdJZCk7DQogICAgICAgICAgICBpZiAoIWV4aXN0cykgew0KICAgICAgICAgICAgICB0aGlzLnRyZWVEYXRhLnB1c2goew0KICAgICAgICAgICAgICAgIGlkOiBuZXdJZCwNCiAgICAgICAgICAgICAgICBsYWJlbDogdGhpcy5jb25uRm9ybS5uYW1lLA0KICAgICAgICAgICAgICAgIHR5cGU6ICJyb290IiwNCiAgICAgICAgICAgICAgICBsZWFmOiBmYWxzZSwNCiAgICAgICAgICAgICAgICBjb25maWc6IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5jb25uRm9ybSkpLA0KICAgICAgICAgICAgICAgIGNvbm5TdGF0dXM6ICJzdWNjZXNzIiwNCiAgICAgICAgICAgICAgICBlcnJvck1zZzogIiIsDQogICAgICAgICAgICAgICAgbG9hZGluZzogZmFsc2UsDQogICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICB0aGlzLnNhdmVDb25uZWN0aW9ucygpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdGhpcy5kaWFsb2dWaXNpYmxlID0gZmFsc2U7DQogICAgICAgICAgICB0aGlzLiRtZXNzYWdlLnN1Y2Nlc3MoIuWIm+W7uuaIkOWKnyIpOw0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCLliJvlu7rlpLHotKU6ICIgKyByZXMuZGF0YS5tc2cpOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCLov57mjqXlpLHotKXvvIzml6Dms5Xkv53lrZjphY3nva4iKTsNCiAgICAgIH0gZmluYWxseSB7DQogICAgICAgIHRoaXMuY29ubmVjdGluZyA9IGZhbHNlOw0KICAgICAgfQ0KICAgIH0sDQogICAgaGFuZGxlRGVsZXRlQ29ubihub2RlLCBkYXRhKSB7DQogICAgICB0aGlzLiRjb25maXJtKGDnoa7lrprliKDpmaTov57mjqXjgJAke2RhdGEubGFiZWx944CR5ZCXP2AsICLmj5DnpLoiLCB7DQogICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwNCiAgICAgIH0pDQogICAgICAgIC50aGVuKGFzeW5jICgpID0+IHsNCiAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgYXdhaXQgcmVxdWVzdC5kZWxldGUoIi9jb25uZWN0aW9uL2RlbGV0ZSIsIHsNCiAgICAgICAgICAgICAgaGVhZGVyczogeyAiQ29ubi1JZCI6IGRhdGEuaWQgfSwNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgIH0gY2F0Y2ggKGUpIHsgfQ0KICAgICAgICAgIHRoaXMudHJlZURhdGEgPSB0aGlzLnRyZWVEYXRhLmZpbHRlcihkID0+IGQuaWQgIT09IGRhdGEuaWQpOw0KICAgICAgICAgIHRoaXMudGFicyA9IHRoaXMudGFicy5maWx0ZXIoKHQpID0+IHQuY29ubklkICE9PSBkYXRhLmlkKTsNCiAgICAgICAgICBpZiAodGhpcy50YWJzLmxlbmd0aCA9PT0gMCkgdGhpcy5hY3RpdmVUYWIgPSAiIjsNCiAgICAgICAgICBlbHNlIGlmICghdGhpcy50YWJzLmZpbmQoKHQpID0+IHQua2V5ID09PSB0aGlzLmFjdGl2ZVRhYikpDQogICAgICAgICAgICB0aGlzLmFjdGl2ZVRhYiA9IHRoaXMudGFic1t0aGlzLnRhYnMubGVuZ3RoIC0gMV0ua2V5Ow0KICAgICAgICAgIHRoaXMuc2F2ZUNvbm5lY3Rpb25zKCk7DQogICAgICAgICAgdGhpcy4kbWVzc2FnZS5zdWNjZXNzKCLliKDpmaTmiJDlip8iKTsNCiAgICAgICAgfSkNCiAgICAgICAgLmNhdGNoKCgpID0+IHsgfSk7DQogICAgfSwNCg0KICAgIC8vIOOAkOS/ruWkjeOAkeeCueWHu+iKgueCuemAu+i+kQ0KICAgIGhhbmRsZU5vZGVDbGljayhkYXRhKSB7DQogICAgICBpZiAoZGF0YS50eXBlID09PSAidGFibGUiIHx8IGRhdGEudHlwZSA9PT0gInZpZXciKSB7DQogICAgICAgIC8vIOS/ruWkjeWFs+mUru+8muWwhiBkYXRhLmxhYmVsIOS9nOS4uiB0YWJsZU5hbWUg5Lyg5YWlDQogICAgICAgIHRoaXMuaGFuZGxlT3BlblRhYmxlKHsNCiAgICAgICAgICBjb25uSWQ6IGRhdGEuY29ubklkLA0KICAgICAgICAgIGNvbm5OYW1lOiBkYXRhLmNvbm5OYW1lLA0KICAgICAgICAgIHNjaGVtYTogZGF0YS5zY2hlbWEsDQogICAgICAgICAgdGFibGVOYW1lOiBkYXRhLmxhYmVsLCAvLyDlv4XpobvkvKDpgJIgdGFibGVOYW1l77yBDQogICAgICAgICAgdHlwZTogZGF0YS50eXBlDQogICAgICAgIH0pOw0KICAgICAgfSBlbHNlIGlmIChkYXRhLnR5cGUgPT09ICJyb2xlIikgew0KICAgICAgICAvLyDjgJDmlrDlop7jgJHmiZPlvIDop5LoibLor6bmg4UgVGFiDQogICAgICAgIHRoaXMub3BlblRhYihkYXRhLmNvbm5JZCwgZGF0YS5jb25uTmFtZSwgbnVsbCwgZGF0YS5sYWJlbCwgJ3JvbGUnKTsNCiAgICAgIH0gZWxzZSBpZiAoZGF0YS50eXBlID09PSAidHJpZ2dlciIpIHsNCiAgICAgICAgdGhpcy4kbWVzc2FnZS5pbmZvKA0KICAgICAgICAgIGDop6blj5HlmaggWyR7ZGF0YS5sYWJlbH1d77yaJHtkYXRhLnN0YXR1cyA9PT0gIkVOQUJMRUQiID8gIuW3suWQr+eUqCIgOiAi5bey56aB55SoIg0KICAgICAgICAgIH0gKOaaguS4jeaUr+aMgee8lui+kSlgDQogICAgICAgICk7DQogICAgICB9DQogICAgfSwNCg0KICAgIGhhbmRsZU9wZW5UYWJsZShwYXlsb2FkKSB7DQogICAgICBsZXQgY05hbWUgPSAiVW5rbm93biI7DQogICAgICBjb25zdCBzaWJsaW5nID0gdGhpcy50YWJzLmZpbmQoKHQpID0+IHQuY29ubklkID09PSBwYXlsb2FkLmNvbm5JZCk7DQogICAgICBpZiAoc2libGluZykgY05hbWUgPSBzaWJsaW5nLmNvbm5OYW1lOw0KICAgICAgZWxzZSB7DQogICAgICAgIGNvbnN0IHJvb3ROb2RlID0gdGhpcy50cmVlRGF0YS5maW5kKCh0KSA9PiB0LmlkID09PSBwYXlsb2FkLmNvbm5JZCk7DQogICAgICAgIGlmIChyb290Tm9kZSkgY05hbWUgPSByb290Tm9kZS5sYWJlbDsNCiAgICAgIH0NCiAgICAgIGNvbnN0IHR5cGUgPSBwYXlsb2FkLnR5cGUgfHwgJ3RhYmxlJzsNCg0KICAgICAgdGhpcy5vcGVuVGFiKA0KICAgICAgICBwYXlsb2FkLmNvbm5JZCwNCiAgICAgICAgY05hbWUsDQogICAgICAgIHBheWxvYWQuc2NoZW1hLA0KICAgICAgICBwYXlsb2FkLnRhYmxlTmFtZSwgLy8g56Gu5L+d6L+Z6YeM5pyJ5YC8DQogICAgICAgIHR5cGUsDQogICAgICAgIHBheWxvYWQuZmlsdGVyLA0KICAgICAgICBwYXlsb2FkLmluaXRWaWV3TW9kZQ0KICAgICAgKTsNCiAgICB9LA0KDQogICAgb3BlblRhYigNCiAgICAgIGNvbm5JZCwNCiAgICAgIGNvbm5OYW1lLA0KICAgICAgc2NoZW1hLA0KICAgICAgdGFibGVOYW1lLA0KICAgICAgdGFibGVUeXBlID0gJ3RhYmxlJywNCiAgICAgIGZpbHRlciA9IG51bGwsDQogICAgICB0YXJnZXRWaWV3TW9kZSA9IG51bGwNCiAgICApIHsNCiAgICAgIC8vIOWMuuWIhuinkuiJsuWSjOihqC/op4blm77nmoQgS2V5DQogICAgICBjb25zdCBpc1JvbGUgPSB0YWJsZVR5cGUgPT09ICdyb2xlJzsNCiAgICAgIGNvbnN0IHRhYktleSA9IGlzUm9sZSA/IGBST0xFLSR7Y29ubklkfS0ke3RhYmxlTmFtZX1gIDogYCR7Y29ubklkfS0ke3NjaGVtYX0tJHt0YWJsZU5hbWV9YDsNCiAgICAgIGNvbnN0IHRpdGxlID0gaXNSb2xlID8gYOinkuiJsjogJHt0YWJsZU5hbWV9YCA6IGAke2Nvbm5OYW1lfSAtICR7dGFibGVOYW1lfWA7DQoNCiAgICAgIGNvbnN0IGV4aXN0SW5kZXggPSB0aGlzLnRhYnMuZmluZEluZGV4KCh0KSA9PiB0LmtleSA9PT0gdGFiS2V5KTsNCiAgICAgIGNvbnN0IGZpbmFsVmlld01vZGUgPSB0YXJnZXRWaWV3TW9kZSB8fCB0aGlzLmdsb2JhbFZpZXdNb2RlIHx8ICJkYXRhIjsNCg0KICAgICAgaWYgKGV4aXN0SW5kZXggPiAtMSkgew0KICAgICAgICB0aGlzLmFjdGl2ZVRhYiA9IHRhYktleTsNCiAgICAgICAgaWYgKCFpc1JvbGUpIHsNCiAgICAgICAgICBjb25zdCB0YWIgPSB0aGlzLnRhYnNbZXhpc3RJbmRleF07DQogICAgICAgICAgY29uc3QgbmVlZFVwZGF0ZSA9DQogICAgICAgICAgICBmaWx0ZXIgfHwgKHRhcmdldFZpZXdNb2RlICYmIHRhYi5pbml0Vmlld01vZGUgIT09IHRhcmdldFZpZXdNb2RlKTsNCiAgICAgICAgICBpZiAobmVlZFVwZGF0ZSkgew0KICAgICAgICAgICAgdGhpcy4kc2V0KHRoaXMudGFicywgZXhpc3RJbmRleCwgeyAuLi50YWIsIGZpbHRlcjogZmlsdGVyIHx8IHRhYi5maWx0ZXIsIGluaXRWaWV3TW9kZTogZmluYWxWaWV3TW9kZSB9KTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHRoaXMudGFicy5wdXNoKHsNCiAgICAgICAgICBrZXk6IHRhYktleSwNCiAgICAgICAgICB0aXRsZTogdGl0bGUsDQogICAgICAgICAgY29ubklkOiBjb25uSWQsDQogICAgICAgICAgY29ubk5hbWU6IGNvbm5OYW1lLA0KICAgICAgICAgIHNjaGVtYTogc2NoZW1hLA0KICAgICAgICAgIHRhYmxlTmFtZTogdGFibGVOYW1lLA0KICAgICAgICAgIHRhYmxlVHlwZTogdGFibGVUeXBlLA0KICAgICAgICAgIHR5cGU6IHRhYmxlVHlwZSwgLy8g5L6bIHYtaWYg5L2/55SoDQogICAgICAgICAgcm9sZU5hbWU6IGlzUm9sZSA/IHRhYmxlTmFtZSA6IG51bGwsDQogICAgICAgICAgZmlsdGVyOiBmaWx0ZXIsDQogICAgICAgICAgaW5pdFZpZXdNb2RlOiBmaW5hbFZpZXdNb2RlLA0KICAgICAgICB9KTsNCiAgICAgICAgdGhpcy5hY3RpdmVUYWIgPSB0YWJLZXk7DQogICAgICB9DQogICAgfSwNCg0KICAgIHJlbW92ZVRhYih0YXJnZXROYW1lKSB7DQogICAgICBjb25zdCB0YWJzID0gdGhpcy50YWJzOw0KICAgICAgbGV0IGFjdGl2ZU5hbWUgPSB0aGlzLmFjdGl2ZVRhYjsNCiAgICAgIGlmIChhY3RpdmVOYW1lID09PSB0YXJnZXROYW1lKSB7DQogICAgICAgIHRhYnMuZm9yRWFjaCgodGFiLCBpbmRleCkgPT4gew0KICAgICAgICAgIGlmICh0YWIua2V5ID09PSB0YXJnZXROYW1lKSB7DQogICAgICAgICAgICBjb25zdCBuZXh0VGFiID0gdGFic1tpbmRleCArIDFdIHx8IHRhYnNbaW5kZXggLSAxXTsNCiAgICAgICAgICAgIGlmIChuZXh0VGFiKSBhY3RpdmVOYW1lID0gbmV4dFRhYi5rZXk7DQogICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICAgIH0NCiAgICAgIHRoaXMuYWN0aXZlVGFiID0gYWN0aXZlTmFtZTsNCiAgICAgIHRoaXMudGFicyA9IHRhYnMuZmlsdGVyKCh0YWIpID0+IHRhYi5rZXkgIT09IHRhcmdldE5hbWUpOw0KICAgIH0sDQoNCiAgICBvcGVuQ3JlYXRlRGlhbG9nKG5vZGUsIGRhdGEpIHsNCiAgICAgIHRoaXMuY3VycmVudE5vZGVEYXRhID0gZGF0YTsNCiAgICAgIHRoaXMuY3VycmVudE5vZGVSZWYgPSBub2RlOw0KICAgICAgaWYgKGRhdGEudHlwZSA9PT0gImZvbGRlcl90YWJsZSIpIHsNCiAgICAgICAgdGhpcy50YWJsZUZvcm0gPSB7DQogICAgICAgICAgdGFibGVOYW1lOiAiIiwNCiAgICAgICAgICBjb2x1bW5zOiBbDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgIG5hbWU6ICJJRCIsDQogICAgICAgICAgICAgIHR5cGU6ICJJTlRFR0VSIiwNCiAgICAgICAgICAgICAgbGVuZ3RoOiAiIiwNCiAgICAgICAgICAgICAgcGs6IHRydWUsDQogICAgICAgICAgICAgIG5vdE51bGw6IHRydWUsDQogICAgICAgICAgICB9LA0KICAgICAgICAgIF0sDQogICAgICAgIH07DQogICAgICAgIHRoaXMuY3JlYXRlVGFibGVWaXNpYmxlID0gdHJ1ZTsNCiAgICAgIH0gZWxzZSBpZiAoZGF0YS50eXBlID09PSAiZm9sZGVyX3ZpZXciKSB7DQogICAgICAgIHRoaXMudmlld0Zvcm0gPSB7IG5hbWU6ICIiLCBzcWw6ICIiIH07DQogICAgICAgIHRoaXMuY3JlYXRlVmlld1Zpc2libGUgPSB0cnVlOw0KICAgICAgfSBlbHNlIGlmIChkYXRhLnR5cGUgPT09ICJmb2xkZXJfdHJpZ2dlciIpIHsNCiAgICAgICAgdGhpcy50cmlnZ2VyU3FsID0gYENSRUFURSBPUiBSRVBMQUNFIFRSSUdHRVIgIiR7ZGF0YS5zY2hlbWF9Ii4iVFJHX05BTUUiXG5CRUZPUkUgSU5TRVJUIE9OICIke2RhdGEuc2NoZW1hfSIuIlRBQkxFX05BTUUiXG5GT1IgRUFDSCBST1dcbkJFR0lOXG5cdC0tIGxvZ2ljIGhlcmVcbkVORDtgOw0KICAgICAgICB0aGlzLmNyZWF0ZVRyaWdnZXJWaXNpYmxlID0gdHJ1ZTsNCiAgICAgIH0gZWxzZSBpZiAoZGF0YS50eXBlID09PSAiZm9sZGVyX3JvbGUiKSB7DQogICAgICAgIC8vIOOAkOaWsOWinuOAkeaWsOW7uuinkuiJsg0KICAgICAgICB0aGlzLnJvbGVGb3JtLm5hbWUgPSAiIjsNCiAgICAgICAgdGhpcy5jcmVhdGVSb2xlVmlzaWJsZSA9IHRydWU7DQogICAgICB9DQogICAgfSwNCg0KICAgIGhhbmRsZURlbGV0ZU9iamVjdChub2RlLCBkYXRhKSB7DQogICAgICBjb25zdCB0eXBlTmFtZSA9IHsgdGFibGU6ICfooagnLCB2aWV3OiAn6KeG5Zu+JywgdHJpZ2dlcjogJ+inpuWPkeWZqCcsIHJvbGU6ICfop5LoibInIH1bZGF0YS50eXBlXTsNCiAgICAgIHRoaXMuJGNvbmZpcm0oDQogICAgICAgIGDnoa7lrprliKDpmaQke3R5cGVOYW1lfeOAkCR7ZGF0YS5sYWJlbH3jgJHlkJfvvJ/mraTmk43kvZzkuI3lj6/mgaLlpI3vvIFgLA0KICAgICAgICAi5Y2x6Zmp5pON5L2cIiwNCiAgICAgICAgew0KICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwNCiAgICAgICAgICBjb25maXJtQnV0dG9uQ2xhc3M6ICJlbC1idXR0b24tLWRhbmdlciIsDQogICAgICAgIH0NCiAgICAgICkNCiAgICAgICAgLnRoZW4oYXN5bmMgKCkgPT4gew0KICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICBjb25zdCB1cmwgPSBkYXRhLnR5cGUgPT09ICdyb2xlJyA/ICIvZGIvcm9sZS9kZWxldGUiIDogIi9kYi9leGVjdXRlIjsNCiAgICAgICAgICAgIGNvbnN0IHBhcmFtcyA9IGRhdGEudHlwZSA9PT0gJ3JvbGUnID8geyByb2xlTmFtZTogZGF0YS5sYWJlbCB9IDogeyBzcWw6IGBEUk9QICR7ZGF0YS50eXBlLnRvVXBwZXJDYXNlKCl9ICIke2RhdGEuc2NoZW1hfSIuIiR7ZGF0YS5sYWJlbH0iYCB9Ow0KICAgICAgICAgICAgY29uc3QgbWV0aG9kID0gZGF0YS50eXBlID09PSAncm9sZScgPyAnZGVsZXRlJyA6ICdwb3N0JzsNCg0KICAgICAgICAgICAgLy8g5L2/55SoIHJlcXVlc3Qg5a6e5L6L77yM5Yqo5oCB6YWN572uIG1ldGhvZA0KICAgICAgICAgICAgY29uc3QgcmVxQ29uZmlnID0gew0KICAgICAgICAgICAgICBtZXRob2QsDQogICAgICAgICAgICAgIHVybCwNCiAgICAgICAgICAgICAgaGVhZGVyczogeyAiQ29ubi1JZCI6IGRhdGEuY29ubklkIH0sDQogICAgICAgICAgICAgIFttZXRob2QgPT09ICdkZWxldGUnID8gJ3BhcmFtcycgOiAnZGF0YSddOiBwYXJhbXMNCiAgICAgICAgICAgIH07DQoNCiAgICAgICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHJlcXVlc3QocmVxQ29uZmlnKTsNCg0KICAgICAgICAgICAgaWYgKHJlcy5kYXRhLmNvZGUgPT09IDIwMCkgew0KICAgICAgICAgICAgICB0aGlzLiRtZXNzYWdlLnN1Y2Nlc3MoIuWIoOmZpOaIkOWKnyIpOw0KICAgICAgICAgICAgICBjb25zdCB0YWJLZXkgPSBkYXRhLnR5cGUgPT09ICdyb2xlJw0KICAgICAgICAgICAgICAgID8gYFJPTEUtJHtkYXRhLmNvbm5JZH0tJHtkYXRhLmxhYmVsfWANCiAgICAgICAgICAgICAgICA6IGAke2RhdGEuY29ubklkfS0ke2RhdGEuc2NoZW1hfS0ke2RhdGEubGFiZWx9YDsNCiAgICAgICAgICAgICAgdGhpcy5yZW1vdmVUYWIodGFiS2V5KTsNCiAgICAgICAgICAgICAgaWYgKG5vZGUucGFyZW50KSB7DQogICAgICAgICAgICAgICAgbm9kZS5wYXJlbnQubG9hZGVkID0gZmFsc2U7DQogICAgICAgICAgICAgICAgbm9kZS5wYXJlbnQuZXhwYW5kKCk7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IocmVzLmRhdGEubXNnKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCLmk43kvZzlpLHotKUiKTsNCiAgICAgICAgICB9DQogICAgICAgIH0pDQogICAgICAgIC5jYXRjaCgoKSA9PiB7IH0pOw0KICAgIH0sDQoNCiAgICBhZGRUYWJsZUNvbHVtbigpIHsNCiAgICAgIHRoaXMudGFibGVGb3JtLmNvbHVtbnMucHVzaCh7DQogICAgICAgIG5hbWU6ICIiLA0KICAgICAgICB0eXBlOiAiVkFSQ0hBUiIsDQogICAgICAgIGxlbmd0aDogIjUwIiwNCiAgICAgICAgcGs6IGZhbHNlLA0KICAgICAgICBub3ROdWxsOiBmYWxzZSwNCiAgICAgIH0pOw0KICAgIH0sDQogICAgcmVtb3ZlVGFibGVDb2x1bW4oaW5kZXgpIHsNCiAgICAgIHRoaXMudGFibGVGb3JtLmNvbHVtbnMuc3BsaWNlKGluZGV4LCAxKTsNCiAgICB9LA0KICAgIGFzeW5jIGV4ZWN1dGVEREwoc3FsKSB7DQogICAgICB0aGlzLnN1Ym1pdHRpbmcgPSB0cnVlOw0KICAgICAgdHJ5IHsNCiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgcmVxdWVzdC5wb3N0KA0KICAgICAgICAgICIvZGIvZXhlY3V0ZSIsDQogICAgICAgICAgeyBzcWw6IHNxbCB9LA0KICAgICAgICAgIHsgaGVhZGVyczogeyAiQ29ubi1JZCI6IHRoaXMuY3VycmVudE5vZGVEYXRhLmNvbm5JZCB9IH0NCiAgICAgICAgKTsNCiAgICAgICAgaWYgKHJlcy5kYXRhLmNvZGUgPT09IDIwMCkgew0KICAgICAgICAgIHRoaXMuJG1lc3NhZ2Uuc3VjY2Vzcygi5Yib5bu65oiQ5YqfIik7DQogICAgICAgICAgdGhpcy5jdXJyZW50Tm9kZVJlZi5sb2FkZWQgPSBmYWxzZTsNCiAgICAgICAgICB0aGlzLmN1cnJlbnROb2RlUmVmLmV4cGFuZCgpOw0KICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IocmVzLmRhdGEubXNnKTsNCiAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcigi6K+35rGC5aSx6LSlIik7DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgIH0gZmluYWxseSB7DQogICAgICAgIHRoaXMuc3VibWl0dGluZyA9IGZhbHNlOw0KICAgICAgfQ0KICAgIH0sDQogICAgLy8g44CQ5qC45b+D5L+u5pS544CR5pSv5oyB5aSN5ZCI5Li76ZSu55qE5bu66KGoIFNRTCDnlJ/miJANCiAgICBhc3luYyBzdWJtaXRDcmVhdGVUYWJsZSgpIHsNCiAgICAgIGlmICghdGhpcy50YWJsZUZvcm0udGFibGVOYW1lKSByZXR1cm4gdGhpcy4kbWVzc2FnZS53YXJuaW5nKCLor7fovpPlhaXooajlkI0iKTsNCiAgICAgIGNvbnN0IHNjaGVtYSA9IHRoaXMuY3VycmVudE5vZGVEYXRhLnNjaGVtYTsNCiAgICAgIGNvbnN0IGZ1bGxUYWJsZU5hbWUgPSBgIiR7c2NoZW1hfSIuIiR7dGhpcy50YWJsZUZvcm0udGFibGVOYW1lfSJgOw0KDQogICAgICAvLyAxLiDnlJ/miJDmma7pgJrliJflrprkuYkNCiAgICAgIGxldCBjb2xzU3FsID0gdGhpcy50YWJsZUZvcm0uY29sdW1ucw0KICAgICAgICAubWFwKChjb2wpID0+IHsNCiAgICAgICAgICBsZXQgbGluZSA9IGAiJHtjb2wubmFtZX0iICR7Y29sLnR5cGV9YDsNCiAgICAgICAgICBpZiAoDQogICAgICAgICAgICBjb2wubGVuZ3RoICYmDQogICAgICAgICAgICAhWyJJTlRFR0VSIiwgIkRBVEUiLCAiVElNRVNUQU1QIiwgIlRFWFQiXS5pbmNsdWRlcyhjb2wudHlwZSkNCiAgICAgICAgICApDQogICAgICAgICAgICBsaW5lICs9IGAoJHtjb2wubGVuZ3RofSlgOw0KICAgICAgICAgIGlmIChjb2wubm90TnVsbCkgbGluZSArPSAiIE5PVCBOVUxMIjsNCiAgICAgICAgICAvLyDms6jmhI/vvJrkuI3lho3ov5nph4zliqAgUFJJTUFSWSBLRVkNCiAgICAgICAgICByZXR1cm4gbGluZTsNCiAgICAgICAgfSkNCiAgICAgICAgLmpvaW4oIixcbiAgIik7DQoNCiAgICAgIC8vIDIuIOaUtumbhuaJgOacieWLvumAieS6hiBQSyDnmoTliJcNCiAgICAgIGNvbnN0IHBrQ29scyA9IHRoaXMudGFibGVGb3JtLmNvbHVtbnMNCiAgICAgICAgLmZpbHRlcihjID0+IGMucGspDQogICAgICAgIC5tYXAoYyA9PiBgIiR7Yy5uYW1lfSJgKTsNCg0KICAgICAgLy8gMy4g5aaC5p6c5pyJ5Li76ZSu77yM5re75Yqg6KGo57qn57qm5p2fDQogICAgICBsZXQgcGtTcWwgPSAiIjsNCiAgICAgIGlmIChwa0NvbHMubGVuZ3RoID4gMCkgew0KICAgICAgICAvLyBDT05TVFJBSU5UIFBLX+ihqOWQjSBQUklNQVJZIEtFWSAo5YiXMSwg5YiXMikNCiAgICAgICAgcGtTcWwgPSBgLFxuICBDT05TVFJBSU5UICJQS18ke3RoaXMudGFibGVGb3JtLnRhYmxlTmFtZX0iIFBSSU1BUlkgS0VZICgke3BrQ29scy5qb2luKCcsICcpfSlgOw0KICAgICAgfQ0KDQogICAgICBjb25zdCBzcWwgPSBgQ1JFQVRFIFRBQkxFICR7ZnVsbFRhYmxlTmFtZX0gKFxuICAke2NvbHNTcWx9JHtwa1NxbH1cbik7YDsNCg0KICAgICAgaWYgKGF3YWl0IHRoaXMuZXhlY3V0ZURETChzcWwpKSB0aGlzLmNyZWF0ZVRhYmxlVmlzaWJsZSA9IGZhbHNlOw0KICAgIH0sDQogICAgYXN5bmMgc3VibWl0Q3JlYXRlVmlldygpIHsNCiAgICAgIGlmICghdGhpcy52aWV3Rm9ybS5uYW1lIHx8ICF0aGlzLnZpZXdGb3JtLnNxbCkNCiAgICAgICAgcmV0dXJuIHRoaXMuJG1lc3NhZ2Uud2FybmluZygi6K+35aGr5YaZ5a6M5pW0Iik7DQogICAgICBjb25zdCBzY2hlbWEgPSB0aGlzLmN1cnJlbnROb2RlRGF0YS5zY2hlbWE7DQogICAgICBjb25zdCBzcWwgPSBgQ1JFQVRFIE9SIFJFUExBQ0UgVklFVyAiJHtzY2hlbWF9Ii4iJHt0aGlzLnZpZXdGb3JtLm5hbWV9IiBBU1xuJHt0aGlzLnZpZXdGb3JtLnNxbH1gOw0KICAgICAgaWYgKGF3YWl0IHRoaXMuZXhlY3V0ZURETChzcWwpKSB0aGlzLmNyZWF0ZVZpZXdWaXNpYmxlID0gZmFsc2U7DQogICAgfSwNCiAgICBhc3luYyBzdWJtaXRDcmVhdGVUcmlnZ2VyKCkgew0KICAgICAgaWYgKCF0aGlzLnRyaWdnZXJTcWwpIHJldHVybjsNCiAgICAgIGlmIChhd2FpdCB0aGlzLmV4ZWN1dGVEREwodGhpcy50cmlnZ2VyU3FsKSkNCiAgICAgICAgdGhpcy5jcmVhdGVUcmlnZ2VyVmlzaWJsZSA9IGZhbHNlOw0KICAgIH0sDQoNCiAgICAvLyDjgJDmlrDlop7jgJHmj5DkuqTliJvlu7rop5LoibINCiAgICBhc3luYyBzdWJtaXRDcmVhdGVSb2xlKCkgew0KICAgICAgaWYgKCF0aGlzLnJvbGVGb3JtLm5hbWUpIHJldHVybiB0aGlzLiRtZXNzYWdlLndhcm5pbmcoIuivt+i+k+WFpeinkuiJsuWQjeensCIpOw0KICAgICAgdHJ5IHsNCiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgcmVxdWVzdC5wb3N0KCIvZGIvcm9sZS9jcmVhdGUiLCB7IHJvbGVOYW1lOiB0aGlzLnJvbGVGb3JtLm5hbWUgfSwgeyBoZWFkZXJzOiB7ICJDb25uLUlkIjogdGhpcy5jdXJyZW50Tm9kZURhdGEuY29ubklkIH0gfSk7DQogICAgICAgIGlmIChyZXMuZGF0YS5jb2RlID09PSAyMDApIHsNCiAgICAgICAgICB0aGlzLiRtZXNzYWdlLnN1Y2Nlc3MoIuWIm+W7uuaIkOWKnyIpOw0KICAgICAgICAgIHRoaXMuY3JlYXRlUm9sZVZpc2libGUgPSBmYWxzZTsNCiAgICAgICAgICB0aGlzLmN1cnJlbnROb2RlUmVmLmxvYWRlZCA9IGZhbHNlOw0KICAgICAgICAgIHRoaXMuY3VycmVudE5vZGVSZWYuZXhwYW5kKCk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcihyZXMuZGF0YS5tc2cpOw0KICAgICAgICB9DQogICAgICB9IGNhdGNoIChlKSB7IHRoaXMuJG1lc3NhZ2UuZXJyb3IoIuWIm+W7uuWksei0pSIpOyB9DQogICAgfQ0KICB9LA0KfTsNCg=="},{"version":3,"sources":["MultiWindowLayout.vue"],"names":[],"mappings":";AA4NA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"MultiWindowLayout.vue","sourceRoot":"src/components","sourcesContent":["<template>\r\n  <el-container class=\"layout-container\">\r\n    <el-aside width=\"280px\" class=\"sidebar\">\r\n      <div class=\"sidebar-header-wrapper\">\r\n        <div class=\"sidebar-header-top\">\r\n          <span class=\"app-title\"><i class=\"el-icon-coin\"></i> 数据库列表</span>\r\n          <div class=\"header-actions\">\r\n            <el-button type=\"text\" icon=\"el-icon-refresh\" @click=\"handleRefresh\" title=\"刷新列表\" :loading=\"isRefreshing\"\r\n              style=\"margin-right: 8px; font-size: 16px\">\r\n            </el-button>\r\n            <el-button type=\"text\" icon=\"el-icon-circle-plus-outline\" @click=\"openAddDialog\" title=\"新建连接\"\r\n              style=\"font-size: 16px\">\r\n            </el-button>\r\n          </div>\r\n        </div>\r\n        <div class=\"sidebar-search\">\r\n          <el-input placeholder=\"过滤库/表/角色...\" v-model=\"filterText\" size=\"mini\" clearable prefix-icon=\"el-icon-search\">\r\n          </el-input>\r\n        </div>\r\n      </div>\r\n\r\n      <el-tree ref=\"tree\" :data=\"treeData\" :props=\"defaultProps\" :load=\"loadNode\" lazy node-key=\"id\" highlight-current\r\n        :filter-node-method=\"filterNode\" @node-click=\"handleNodeClick\" class=\"db-tree\" :expand-on-click-node=\"false\">\r\n        <span class=\"custom-tree-node\" slot-scope=\"{ node, data }\">\r\n          <span class=\"node-label\">\r\n            <i :class=\"getIcon(data.type)\" :style=\"{ color: data.connStatus === 'fail' ? '#F56C6C' : '' }\"></i>\r\n\r\n            {{ node.label }}\r\n\r\n            <i v-if=\"data.loading\" class=\"el-icon-loading\" style=\"margin-left: 5px\"></i>\r\n\r\n            <el-tooltip v-if=\"data.type === 'root' && data.connStatus === 'fail'\" class=\"item\" effect=\"dark\"\r\n              :content=\"data.errorMsg || '连接失败'\" placement=\"top\">\r\n              <span style=\"\r\n                  color: #f56c6c;\r\n                  font-size: 12px;\r\n                  margin-left: 5px;\r\n                  cursor: pointer;\r\n                  font-weight: bold;\r\n                \">\r\n                <i class=\"el-icon-warning-outline\"></i> (离线)\r\n              </span>\r\n            </el-tooltip>\r\n\r\n            <span v-if=\"data.comment\" style=\"color: #999; font-size: 12px; margin-left: 5px\">{{ data.comment }}</span>\r\n\r\n            <span v-if=\"data.type === 'trigger'\" :style=\"{\r\n              color: data.status === 'ENABLED' ? '#67C23A' : '#909399',\r\n              fontSize: '12px',\r\n              marginLeft: '5px',\r\n              fontWeight: 'bold',\r\n            }\">\r\n              {{ data.status === \"ENABLED\" ? \"●\" : \"○\" }}\r\n            </span>\r\n          </span>\r\n\r\n          <span class=\"node-actions\">\r\n            <template v-if=\"data.type === 'root'\">\r\n              <el-button type=\"text\" icon=\"el-icon-edit\" size=\"mini\" @click.stop=\"openEditDialog(data)\"></el-button>\r\n              <el-button type=\"text\" icon=\"el-icon-delete\" size=\"mini\"\r\n                @click.stop=\"handleDeleteConn(node, data)\"></el-button>\r\n            </template>\r\n\r\n            <template v-if=\"data.type && data.type.startsWith('folder_')\">\r\n              <el-button type=\"text\" icon=\"el-icon-plus\" size=\"mini\" title=\"新建\"\r\n                @click.stop=\"openCreateDialog(node, data)\"></el-button>\r\n            </template>\r\n\r\n            <template v-if=\"['table', 'view', 'trigger', 'role'].includes(data.type)\">\r\n              <el-button type=\"text\" icon=\"el-icon-delete\" size=\"mini\" style=\"color: #f56c6c\" title=\"删除\"\r\n                @click.stop=\"handleDeleteObject(node, data)\"></el-button>\r\n            </template>\r\n          </span>\r\n        </span>\r\n      </el-tree>\r\n    </el-aside>\r\n\r\n    <el-main class=\"main-content\">\r\n      <div v-if=\"tabs.length === 0\" class=\"empty-state\">\r\n        <i class=\"el-icon-monitor\"></i>\r\n        <p>请新建连接并选择数据表、视图或角色进行管理</p>\r\n      </div>\r\n\r\n      <el-tabs v-else v-model=\"activeTab\" type=\"card\" closable @tab-remove=\"removeTab\" class=\"content-tabs\">\r\n        <el-tab-pane v-for=\"item in tabs\" :key=\"item.key\" :label=\"item.title\" :name=\"item.key\">\r\n          <TableDetail v-if=\"item.type === 'table' || item.type === 'view'\" :conn-id=\"item.connId\"\r\n            :conn-name=\"item.connName\" :schema=\"item.schema\" :table-name=\"item.tableName\" :table-type=\"item.tableType\"\r\n            :initial-filter=\"item.filter\" :init-view-mode=\"item.initViewMode\" @view-mode-change=\"handleViewModeChange\"\r\n            @open-table=\"handleOpenTable\" />\r\n\r\n          <RoleDetail v-else-if=\"item.type === 'role'\" :conn-id=\"item.connId\" :role-name=\"item.roleName\" />\r\n        </el-tab-pane>\r\n      </el-tabs>\r\n    </el-main>\r\n\r\n    <el-dialog :title=\"dialogTitle\" :visible.sync=\"dialogVisible\" width=\"400px\" :close-on-click-modal=\"false\">\r\n      <el-form :model=\"connForm\" label-width=\"80px\" size=\"small\">\r\n        <el-form-item label=\"名称\" required>\r\n          <el-input v-model=\"connForm.name\" placeholder=\"连接名称 (唯一)\"></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"主机\" required>\r\n          <el-input v-model=\"connForm.host\"></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"端口\" required>\r\n          <el-input v-model=\"connForm.port\"></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"用户\" required>\r\n          <el-input v-model=\"connForm.user\"></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"密码\">\r\n          <el-input v-model=\"connForm.password\" type=\"password\"></el-input>\r\n        </el-form-item>\r\n      </el-form>\r\n      <div slot=\"footer\">\r\n        <el-button @click=\"dialogVisible = false\">取消</el-button>\r\n        <el-button type=\"success\" plain @click=\"testConnection\" :loading=\"testing\">测试连接</el-button>\r\n        <el-button type=\"primary\" @click=\"submitConnection\" :loading=\"connecting\">保存并连接</el-button>\r\n      </div>\r\n    </el-dialog>\r\n\r\n    <el-dialog title=\"新建数据表\" :visible.sync=\"createTableVisible\" width=\"700px\" :close-on-click-modal=\"false\">\r\n      <el-form :model=\"tableForm\" size=\"small\" label-width=\"80px\">\r\n        <el-form-item label=\"表名\" required>\r\n          <el-input v-model=\"tableForm.tableName\" placeholder=\"例如: ORDER_ITEMS\" style=\"width: 100%\"></el-input>\r\n        </el-form-item>\r\n\r\n        <div style=\"\r\n            margin-bottom: 10px;\r\n            font-weight: bold;\r\n            border-bottom: 1px solid #eee;\r\n            padding-bottom: 5px;\r\n          \">\r\n          列定义\r\n          <el-button type=\"text\" icon=\"el-icon-plus\" style=\"float: right\" @click=\"addTableColumn\">添加列</el-button>\r\n        </div>\r\n\r\n        <el-table :data=\"tableForm.columns\" border size=\"mini\" max-height=\"300\">\r\n          <el-table-column label=\"列名\" width=\"150\">\r\n            <template slot-scope=\"scope\"><el-input v-model=\"scope.row.name\" placeholder=\"列名\"></el-input></template>\r\n          </el-table-column>\r\n          <el-table-column label=\"类型\" width=\"120\">\r\n            <template slot-scope=\"scope\">\r\n              <el-select v-model=\"scope.row.type\" placeholder=\"类型\">\r\n                <el-option value=\"VARCHAR\"></el-option>\r\n                <el-option value=\"INTEGER\"></el-option>\r\n                <el-option value=\"DATE\"></el-option>\r\n                <el-option value=\"TIMESTAMP\"></el-option>\r\n                <el-option value=\"DECIMAL\"></el-option>\r\n                <el-option value=\"TEXT\"></el-option>\r\n              </el-select>\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column label=\"长度\" width=\"80\">\r\n            <template slot-scope=\"scope\"><el-input v-model=\"scope.row.length\" :disabled=\"['INTEGER', 'DATE', 'TIMESTAMP', 'TEXT'].includes(\r\n              scope.row.type\r\n            )\r\n              \"></el-input></template>\r\n          </el-table-column>\r\n          <el-table-column label=\"主键\" width=\"60\" align=\"center\">\r\n            <template slot-scope=\"scope\"><el-checkbox v-model=\"scope.row.pk\"></el-checkbox></template>\r\n          </el-table-column>\r\n          <el-table-column label=\"非空\" width=\"60\" align=\"center\">\r\n            <template slot-scope=\"scope\"><el-checkbox v-model=\"scope.row.notNull\"></el-checkbox></template>\r\n          </el-table-column>\r\n          <el-table-column label=\"操作\" width=\"60\" align=\"center\">\r\n            <template slot-scope=\"scope\"><el-button type=\"text\" icon=\"el-icon-delete\" style=\"color: #f56c6c\"\r\n                @click=\"removeTableColumn(scope.$index)\"></el-button></template>\r\n          </el-table-column>\r\n        </el-table>\r\n        <div style=\"margin-top: 5px; font-size: 12px; color: #909399;\">\r\n          <i class=\"el-icon-info\"></i> 支持勾选多个列作为复合主键。\r\n        </div>\r\n      </el-form>\r\n      <div slot=\"footer\">\r\n        <el-button size=\"small\" @click=\"createTableVisible = false\">取消</el-button>\r\n        <el-button size=\"small\" type=\"primary\" @click=\"submitCreateTable\" :loading=\"submitting\">创建</el-button>\r\n      </div>\r\n    </el-dialog>\r\n\r\n    <el-dialog title=\"新建视图\" :visible.sync=\"createViewVisible\" width=\"600px\" :close-on-click-modal=\"false\">\r\n      <el-form :model=\"viewForm\" size=\"small\" label-width=\"80px\">\r\n        <el-form-item label=\"视图名\" required>\r\n          <el-input v-model=\"viewForm.name\" placeholder=\"例如: V_USER_STATS\"></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"定义SQL\" required>\r\n          <el-input type=\"textarea\" :rows=\"8\" v-model=\"viewForm.sql\" placeholder=\"SELECT * FROM ...\"></el-input>\r\n        </el-form-item>\r\n      </el-form>\r\n      <div slot=\"footer\">\r\n        <el-button size=\"small\" @click=\"createViewVisible = false\">取消</el-button>\r\n        <el-button size=\"small\" type=\"primary\" @click=\"submitCreateView\" :loading=\"submitting\">创建</el-button>\r\n      </div>\r\n    </el-dialog>\r\n\r\n    <el-dialog title=\"新建触发器\" :visible.sync=\"createTriggerVisible\" width=\"600px\" :close-on-click-modal=\"false\">\r\n      <el-alert title=\"触发器定义较复杂，请直接输入完整 Create SQL\" type=\"info\" :closable=\"false\"\r\n        style=\"margin-bottom: 10px\"></el-alert>\r\n      <el-input type=\"textarea\" :rows=\"12\" v-model=\"triggerSql\" placeholder=\"CREATE OR REPLACE TRIGGER ...\"></el-input>\r\n      <div slot=\"footer\">\r\n        <el-button size=\"small\" @click=\"createTriggerVisible = false\">取消</el-button>\r\n        <el-button size=\"small\" type=\"primary\" @click=\"submitCreateTrigger\" :loading=\"submitting\">创建</el-button>\r\n      </div>\r\n    </el-dialog>\r\n\r\n    <el-dialog title=\"新建角色\" :visible.sync=\"createRoleVisible\" width=\"400px\" :close-on-click-modal=\"false\">\r\n      <el-form :model=\"roleForm\" size=\"small\" label-width=\"80px\">\r\n        <el-form-item label=\"角色名称\" required>\r\n          <el-input v-model=\"roleForm.name\" placeholder=\"例如: ROLE_HR\"></el-input>\r\n        </el-form-item>\r\n      </el-form>\r\n      <div slot=\"footer\">\r\n        <el-button @click=\"createRoleVisible = false\" size=\"small\">取消</el-button>\r\n        <el-button type=\"primary\" @click=\"submitCreateRole\" size=\"small\">创建</el-button>\r\n      </div>\r\n    </el-dialog>\r\n\r\n  </el-container>\r\n</template>\r\n\r\n<script>\r\nimport request from \"@/utils/request\";\r\nimport TableDetail from \"./TableDetail.vue\";\r\nimport RoleDetail from \"./RoleDetail.vue\";\r\n\r\nconst STORAGE_KEY = \"DMDB_CONNECTIONS\";\r\n\r\nexport default {\r\n  name: \"MultiWindowLayout\",\r\n  components: { TableDetail, RoleDetail },\r\n  data() {\r\n    return {\r\n      filterText: \"\",\r\n      treeData: [],\r\n      defaultProps: { label: \"label\", isLeaf: \"leaf\" },\r\n      tabs: [],\r\n      activeTab: \"\",\r\n\r\n      globalViewMode: \"data\",\r\n\r\n      isRefreshing: false,\r\n      dialogVisible: false,\r\n      isEditMode: false,\r\n      currentEditNode: null,\r\n      dialogTitle: \"新建连接\",\r\n      connecting: false,\r\n      testing: false,\r\n      connForm: {\r\n        name: \"本地达梦\",\r\n        host: \"localhost\",\r\n        port: \"5236\",\r\n        user: \"SYSDBA\",\r\n        password: \"\",\r\n      },\r\n\r\n      submitting: false,\r\n      currentNodeData: null,\r\n      currentNodeRef: null,\r\n\r\n      // 表/视图/触发器 弹窗状态\r\n      createTableVisible: false,\r\n      tableForm: {\r\n        tableName: \"\",\r\n        columns: [\r\n          { name: \"ID\", type: \"INTEGER\", length: \"\", pk: true, notNull: true },\r\n        ],\r\n      },\r\n      createViewVisible: false,\r\n      viewForm: { name: \"\", sql: \"\" },\r\n      createTriggerVisible: false,\r\n      triggerSql: \"\",\r\n\r\n      // 角色弹窗状态\r\n      createRoleVisible: false,\r\n      roleForm: { name: \"\" }\r\n    };\r\n  },\r\n  watch: {\r\n    filterText(val) {\r\n      this.$refs.tree.filter(val);\r\n    },\r\n  },\r\n  created() {\r\n    this.restoreConnections();\r\n  },\r\n  methods: {\r\n    filterNode(value, data) {\r\n      if (!value) return true;\r\n      return data.label.toLowerCase().indexOf(value.toLowerCase()) !== -1;\r\n    },\r\n    // 【核心】根据节点类型返回图标\r\n    getIcon(type) {\r\n      if (type === \"root\") return \"el-icon-connection\";\r\n      if (type === \"folder_schema\") return \"el-icon-files\";\r\n      if (type === \"folder_role\") return \"el-icon-user-solid\"; // 角色文件夹图标\r\n      if (type === \"schema\") return \"el-icon-folder-opened\";\r\n      if (type && type.startsWith(\"folder_\")) return \"el-icon-folder\";\r\n      if (type === \"table\") return \"el-icon-document-copy\";\r\n      if (type === \"view\") return \"el-icon-view\";\r\n      if (type === \"trigger\") return \"el-icon-s-operation\";\r\n      if (type === \"role\") return \"el-icon-user\"; // 具体角色图标\r\n      return \"el-icon-document\";\r\n    },\r\n    handleViewModeChange(mode) {\r\n      this.globalViewMode = mode;\r\n    },\r\n    handleRefresh() {\r\n      this.isRefreshing = true;\r\n      this.treeData = [];\r\n      this.$nextTick(() => {\r\n        this.restoreConnections();\r\n        setTimeout(() => {\r\n          this.isRefreshing = false;\r\n          this.$message.success(\"列表已刷新\");\r\n        }, 500);\r\n      });\r\n    },\r\n    restoreConnections() {\r\n      const cached = localStorage.getItem(STORAGE_KEY);\r\n      if (cached) {\r\n        try {\r\n          const list = JSON.parse(cached);\r\n          this.treeData = list.map((item) => ({\r\n            ...item,\r\n            loading: true,\r\n            connStatus: \"connecting\",\r\n            errorMsg: \"\",\r\n          }));\r\n          this.treeData.forEach(async (node) => {\r\n            try {\r\n              const res = await request.post(\"/connection/connect\", {\r\n                id: node.id,\r\n                ...node.config,\r\n              });\r\n              const targetNode = this.treeData.find(n => n.id === node.id);\r\n              if (targetNode) {\r\n                if (res.data.code === 200) {\r\n                  this.$set(targetNode, 'loading', false);\r\n                  this.$set(targetNode, 'connStatus', 'success');\r\n                  this.$set(targetNode, 'errorMsg', '');\r\n                } else {\r\n                  this.$set(targetNode, 'loading', false);\r\n                  this.$set(targetNode, 'connStatus', 'fail');\r\n                  this.$set(targetNode, 'errorMsg', res.data.msg);\r\n                }\r\n              }\r\n            } catch (e) {\r\n              const msg = e.response?.data?.msg || e.message || \"连接失败\";\r\n              const targetNode = this.treeData.find(n => n.id === node.id);\r\n              if (targetNode) {\r\n                this.$set(targetNode, 'loading', false);\r\n                this.$set(targetNode, 'connStatus', 'fail');\r\n                this.$set(targetNode, 'errorMsg', msg);\r\n              }\r\n            }\r\n          });\r\n        } catch (e) {\r\n          console.error(\"Restore failed:\", e);\r\n        }\r\n      }\r\n    },\r\n    saveConnections() {\r\n      const listToSave = this.treeData.map((node) => ({\r\n        id: node.id,\r\n        label: node.label,\r\n        type: \"root\",\r\n        leaf: false,\r\n        config: node.config,\r\n      }));\r\n      localStorage.setItem(STORAGE_KEY, JSON.stringify(listToSave));\r\n    },\r\n\r\n    // 【核心】节点加载逻辑\r\n    async loadNode(node, resolve) {\r\n      if (node.level === 0) return resolve(this.treeData);\r\n      const data = node.data;\r\n\r\n      if (data.loading) {\r\n        this.$message.warning(\"正在尝试恢复连接，请稍候...\");\r\n        return resolve([]);\r\n      }\r\n      if (data.type === \"root\" && data.connStatus === \"fail\") {\r\n        this.$message.error(data.errorMsg || \"连接不可用\");\r\n        return resolve([]);\r\n      }\r\n\r\n      if (data.type === \"root\") {\r\n        resolve([\r\n          { label: '模式', type: 'folder_schema', connId: data.id, connName: data.label, leaf: false },\r\n          // 【新增】角色管理入口节点\r\n          { label: '角色', type: 'folder_role', connId: data.id, connName: data.label, leaf: false }\r\n        ]);\r\n      } else if (data.type === \"folder_role\") {\r\n        // 【新增】加载角色列表\r\n        try {\r\n          const res = await request.get(\"/db/roles\", { headers: { \"Conn-Id\": data.connId } });\r\n          const roles = (res.data.data || []).map(r => ({\r\n            label: r.ROLE_NAME,\r\n            type: \"role\",\r\n            connId: data.connId,\r\n            connName: data.connName,\r\n            leaf: true\r\n          }));\r\n          resolve(roles);\r\n        } catch (e) { resolve([]); }\r\n      } else if (data.type === \"folder_schema\") {\r\n        try {\r\n          const res = await request.get(\"/db/schemas\", {\r\n            headers: { \"Conn-Id\": data.connId },\r\n          });\r\n          const sortedSchemas = (res.data.data || []).sort((a, b) => a.localeCompare(b));\r\n          const schemaNodes = sortedSchemas.map((s) => ({\r\n            label: s,\r\n            type: \"schema\",\r\n            connId: data.connId,\r\n            connName: data.connName,\r\n            leaf: false,\r\n          }));\r\n          resolve(schemaNodes);\r\n        } catch (e) {\r\n          resolve([]);\r\n        }\r\n      } else if (data.type === \"schema\") {\r\n        resolve([\r\n          { label: \"数据表\", type: \"folder_table\", connId: data.connId, connName: data.connName, schema: data.label, leaf: false },\r\n          { label: \"视图\", type: \"folder_view\", connId: data.connId, connName: data.connName, schema: data.label, leaf: false },\r\n          { label: \"触发器\", type: \"folder_trigger\", connId: data.connId, connName: data.connName, schema: data.label, leaf: false },\r\n        ]);\r\n      } else if (data.type === \"folder_table\") {\r\n        try {\r\n          const res = await request.get(\"/db/tables\", {\r\n            params: { schema: data.schema },\r\n            headers: { \"Conn-Id\": data.connId },\r\n          });\r\n          const tables = res.data.data.map((t) => ({\r\n            label: t.TABLE_NAME,\r\n            comment: t.COMMENTS,\r\n            type: \"table\",\r\n            connId: data.connId,\r\n            connName: data.connName,\r\n            schema: data.schema,\r\n            leaf: true,\r\n          }));\r\n          resolve(tables);\r\n        } catch (e) {\r\n          resolve([]);\r\n        }\r\n      } else if (data.type === \"folder_view\") {\r\n        try {\r\n          const res = await request.get(\"/db/views\", {\r\n            params: { schema: data.schema },\r\n            headers: { \"Conn-Id\": data.connId },\r\n          });\r\n          const views = res.data.data.map((v) => ({\r\n            label: v.VIEW_NAME,\r\n            type: \"view\",\r\n            connId: data.connId,\r\n            connName: data.connName,\r\n            schema: data.schema,\r\n            leaf: true,\r\n          }));\r\n          resolve(views);\r\n        } catch (e) {\r\n          resolve([]);\r\n        }\r\n      } else if (data.type === \"folder_trigger\") {\r\n        try {\r\n          const res = await request.get(\"/db/triggers\", {\r\n            params: { schema: data.schema },\r\n            headers: { \"Conn-Id\": data.connId },\r\n          });\r\n          const triggers = res.data.data.map((t) => ({\r\n            label: t.TRIGGER_NAME,\r\n            status: t.STATUS,\r\n            type: \"trigger\",\r\n            connId: data.connId,\r\n            connName: data.connName,\r\n            schema: data.schema,\r\n            leaf: true,\r\n          }));\r\n          resolve(triggers);\r\n        } catch (e) {\r\n          resolve([]);\r\n        }\r\n      } else {\r\n        resolve([]);\r\n      }\r\n    },\r\n\r\n    openAddDialog() {\r\n      this.isEditMode = false;\r\n      this.dialogTitle = \"新建连接\";\r\n      this.connForm = {\r\n        name: \"本地达梦\",\r\n        host: \"localhost\",\r\n        port: \"5236\",\r\n        user: \"SYSDBA\",\r\n        password: \"\",\r\n      };\r\n      this.dialogVisible = true;\r\n    },\r\n    openEditDialog(data) {\r\n      this.isEditMode = true;\r\n      this.currentEditNode = data;\r\n      this.dialogTitle = \"编辑连接\";\r\n      this.connForm = JSON.parse(JSON.stringify(data.config || {}));\r\n      if (!data.config) this.connForm.name = data.label;\r\n      this.dialogVisible = true;\r\n    },\r\n    validateConnName(name) {\r\n      if (!name || !name.trim()) return false;\r\n      const exist = this.treeData.find((node) => {\r\n        if (this.isEditMode && this.currentEditNode) {\r\n          return node.label === name && node.id !== this.currentEditNode.id;\r\n        }\r\n        return node.label === name;\r\n      });\r\n      return !exist;\r\n    },\r\n    async testConnection() {\r\n      this.testing = true;\r\n      try {\r\n        const payload = { ...this.connForm };\r\n        if (this.isEditMode && this.currentEditNode) {\r\n          payload.id = this.currentEditNode.id;\r\n        }\r\n        const res = await request.post(\"/connection/connect\", payload);\r\n        if (res.data.code === 200) {\r\n          this.$message.success(\"连接成功！\");\r\n        } else {\r\n          this.$message.error(\"连接失败: \" + res.data.msg);\r\n        }\r\n      } catch (e) {\r\n        this.$message.error(\"连接异常，请检查网络\");\r\n      } finally {\r\n        this.testing = false;\r\n      }\r\n    },\r\n    async submitConnection() {\r\n      if (!this.connForm.name) {\r\n        this.$message.warning(\"请输入连接名称\");\r\n        return;\r\n      }\r\n      if (!this.validateConnName(this.connForm.name)) {\r\n        this.$message.warning(\"连接名称已存在，请使用其他名称\");\r\n        return;\r\n      }\r\n      this.connecting = true;\r\n      try {\r\n        if (this.isEditMode) {\r\n          const connId = this.currentEditNode.id;\r\n          const res = await request.post(\"/connection/connect\", {\r\n            id: connId,\r\n            ...this.connForm,\r\n          });\r\n          if (res.data.code !== 200) {\r\n            this.$message.error(res.data.msg || \"连接失败，无法保存配置\");\r\n            return;\r\n          }\r\n          const targetNode = this.treeData.find(n => n.id === connId);\r\n          if (targetNode) {\r\n            this.$set(targetNode, \"label\", this.connForm.name);\r\n            this.$set(targetNode, \"config\", JSON.parse(JSON.stringify(this.connForm)));\r\n            this.$set(targetNode, \"connStatus\", \"success\");\r\n            this.$set(targetNode, \"errorMsg\", \"\");\r\n            this.$set(targetNode, \"loading\", false);\r\n          }\r\n          this.saveConnections();\r\n          this.$message.success(\"更新成功\");\r\n          this.dialogVisible = false;\r\n        } else {\r\n          const res = await request.post(\"/connection/connect\", this.connForm);\r\n          if (res.data.code === 200) {\r\n            const newId = res.data.data;\r\n            const exists = this.treeData.some(n => n.id === newId);\r\n            if (!exists) {\r\n              this.treeData.push({\r\n                id: newId,\r\n                label: this.connForm.name,\r\n                type: \"root\",\r\n                leaf: false,\r\n                config: JSON.parse(JSON.stringify(this.connForm)),\r\n                connStatus: \"success\",\r\n                errorMsg: \"\",\r\n                loading: false,\r\n              });\r\n              this.saveConnections();\r\n            }\r\n            this.dialogVisible = false;\r\n            this.$message.success(\"创建成功\");\r\n          } else {\r\n            this.$message.error(\"创建失败: \" + res.data.msg);\r\n          }\r\n        }\r\n      } catch (e) {\r\n        this.$message.error(\"连接失败，无法保存配置\");\r\n      } finally {\r\n        this.connecting = false;\r\n      }\r\n    },\r\n    handleDeleteConn(node, data) {\r\n      this.$confirm(`确定删除连接【${data.label}】吗?`, \"提示\", {\r\n        type: \"warning\",\r\n      })\r\n        .then(async () => {\r\n          try {\r\n            await request.delete(\"/connection/delete\", {\r\n              headers: { \"Conn-Id\": data.id },\r\n            });\r\n          } catch (e) { }\r\n          this.treeData = this.treeData.filter(d => d.id !== data.id);\r\n          this.tabs = this.tabs.filter((t) => t.connId !== data.id);\r\n          if (this.tabs.length === 0) this.activeTab = \"\";\r\n          else if (!this.tabs.find((t) => t.key === this.activeTab))\r\n            this.activeTab = this.tabs[this.tabs.length - 1].key;\r\n          this.saveConnections();\r\n          this.$message.success(\"删除成功\");\r\n        })\r\n        .catch(() => { });\r\n    },\r\n\r\n    // 【修复】点击节点逻辑\r\n    handleNodeClick(data) {\r\n      if (data.type === \"table\" || data.type === \"view\") {\r\n        // 修复关键：将 data.label 作为 tableName 传入\r\n        this.handleOpenTable({\r\n          connId: data.connId,\r\n          connName: data.connName,\r\n          schema: data.schema,\r\n          tableName: data.label, // 必须传递 tableName！\r\n          type: data.type\r\n        });\r\n      } else if (data.type === \"role\") {\r\n        // 【新增】打开角色详情 Tab\r\n        this.openTab(data.connId, data.connName, null, data.label, 'role');\r\n      } else if (data.type === \"trigger\") {\r\n        this.$message.info(\r\n          `触发器 [${data.label}]：${data.status === \"ENABLED\" ? \"已启用\" : \"已禁用\"\r\n          } (暂不支持编辑)`\r\n        );\r\n      }\r\n    },\r\n\r\n    handleOpenTable(payload) {\r\n      let cName = \"Unknown\";\r\n      const sibling = this.tabs.find((t) => t.connId === payload.connId);\r\n      if (sibling) cName = sibling.connName;\r\n      else {\r\n        const rootNode = this.treeData.find((t) => t.id === payload.connId);\r\n        if (rootNode) cName = rootNode.label;\r\n      }\r\n      const type = payload.type || 'table';\r\n\r\n      this.openTab(\r\n        payload.connId,\r\n        cName,\r\n        payload.schema,\r\n        payload.tableName, // 确保这里有值\r\n        type,\r\n        payload.filter,\r\n        payload.initViewMode\r\n      );\r\n    },\r\n\r\n    openTab(\r\n      connId,\r\n      connName,\r\n      schema,\r\n      tableName,\r\n      tableType = 'table',\r\n      filter = null,\r\n      targetViewMode = null\r\n    ) {\r\n      // 区分角色和表/视图的 Key\r\n      const isRole = tableType === 'role';\r\n      const tabKey = isRole ? `ROLE-${connId}-${tableName}` : `${connId}-${schema}-${tableName}`;\r\n      const title = isRole ? `角色: ${tableName}` : `${connName} - ${tableName}`;\r\n\r\n      const existIndex = this.tabs.findIndex((t) => t.key === tabKey);\r\n      const finalViewMode = targetViewMode || this.globalViewMode || \"data\";\r\n\r\n      if (existIndex > -1) {\r\n        this.activeTab = tabKey;\r\n        if (!isRole) {\r\n          const tab = this.tabs[existIndex];\r\n          const needUpdate =\r\n            filter || (targetViewMode && tab.initViewMode !== targetViewMode);\r\n          if (needUpdate) {\r\n            this.$set(this.tabs, existIndex, { ...tab, filter: filter || tab.filter, initViewMode: finalViewMode });\r\n          }\r\n        }\r\n      } else {\r\n        this.tabs.push({\r\n          key: tabKey,\r\n          title: title,\r\n          connId: connId,\r\n          connName: connName,\r\n          schema: schema,\r\n          tableName: tableName,\r\n          tableType: tableType,\r\n          type: tableType, // 供 v-if 使用\r\n          roleName: isRole ? tableName : null,\r\n          filter: filter,\r\n          initViewMode: finalViewMode,\r\n        });\r\n        this.activeTab = tabKey;\r\n      }\r\n    },\r\n\r\n    removeTab(targetName) {\r\n      const tabs = this.tabs;\r\n      let activeName = this.activeTab;\r\n      if (activeName === targetName) {\r\n        tabs.forEach((tab, index) => {\r\n          if (tab.key === targetName) {\r\n            const nextTab = tabs[index + 1] || tabs[index - 1];\r\n            if (nextTab) activeName = nextTab.key;\r\n          }\r\n        });\r\n      }\r\n      this.activeTab = activeName;\r\n      this.tabs = tabs.filter((tab) => tab.key !== targetName);\r\n    },\r\n\r\n    openCreateDialog(node, data) {\r\n      this.currentNodeData = data;\r\n      this.currentNodeRef = node;\r\n      if (data.type === \"folder_table\") {\r\n        this.tableForm = {\r\n          tableName: \"\",\r\n          columns: [\r\n            {\r\n              name: \"ID\",\r\n              type: \"INTEGER\",\r\n              length: \"\",\r\n              pk: true,\r\n              notNull: true,\r\n            },\r\n          ],\r\n        };\r\n        this.createTableVisible = true;\r\n      } else if (data.type === \"folder_view\") {\r\n        this.viewForm = { name: \"\", sql: \"\" };\r\n        this.createViewVisible = true;\r\n      } else if (data.type === \"folder_trigger\") {\r\n        this.triggerSql = `CREATE OR REPLACE TRIGGER \"${data.schema}\".\"TRG_NAME\"\\nBEFORE INSERT ON \"${data.schema}\".\"TABLE_NAME\"\\nFOR EACH ROW\\nBEGIN\\n\\t-- logic here\\nEND;`;\r\n        this.createTriggerVisible = true;\r\n      } else if (data.type === \"folder_role\") {\r\n        // 【新增】新建角色\r\n        this.roleForm.name = \"\";\r\n        this.createRoleVisible = true;\r\n      }\r\n    },\r\n\r\n    handleDeleteObject(node, data) {\r\n      const typeName = { table: '表', view: '视图', trigger: '触发器', role: '角色' }[data.type];\r\n      this.$confirm(\r\n        `确定删除${typeName}【${data.label}】吗？此操作不可恢复！`,\r\n        \"危险操作\",\r\n        {\r\n          type: \"warning\",\r\n          confirmButtonClass: \"el-button--danger\",\r\n        }\r\n      )\r\n        .then(async () => {\r\n          try {\r\n            const url = data.type === 'role' ? \"/db/role/delete\" : \"/db/execute\";\r\n            const params = data.type === 'role' ? { roleName: data.label } : { sql: `DROP ${data.type.toUpperCase()} \"${data.schema}\".\"${data.label}\"` };\r\n            const method = data.type === 'role' ? 'delete' : 'post';\r\n\r\n            // 使用 request 实例，动态配置 method\r\n            const reqConfig = {\r\n              method,\r\n              url,\r\n              headers: { \"Conn-Id\": data.connId },\r\n              [method === 'delete' ? 'params' : 'data']: params\r\n            };\r\n\r\n            const res = await request(reqConfig);\r\n\r\n            if (res.data.code === 200) {\r\n              this.$message.success(\"删除成功\");\r\n              const tabKey = data.type === 'role'\r\n                ? `ROLE-${data.connId}-${data.label}`\r\n                : `${data.connId}-${data.schema}-${data.label}`;\r\n              this.removeTab(tabKey);\r\n              if (node.parent) {\r\n                node.parent.loaded = false;\r\n                node.parent.expand();\r\n              }\r\n            } else {\r\n              this.$message.error(res.data.msg);\r\n            }\r\n          } catch (e) {\r\n            this.$message.error(\"操作失败\");\r\n          }\r\n        })\r\n        .catch(() => { });\r\n    },\r\n\r\n    addTableColumn() {\r\n      this.tableForm.columns.push({\r\n        name: \"\",\r\n        type: \"VARCHAR\",\r\n        length: \"50\",\r\n        pk: false,\r\n        notNull: false,\r\n      });\r\n    },\r\n    removeTableColumn(index) {\r\n      this.tableForm.columns.splice(index, 1);\r\n    },\r\n    async executeDDL(sql) {\r\n      this.submitting = true;\r\n      try {\r\n        const res = await request.post(\r\n          \"/db/execute\",\r\n          { sql: sql },\r\n          { headers: { \"Conn-Id\": this.currentNodeData.connId } }\r\n        );\r\n        if (res.data.code === 200) {\r\n          this.$message.success(\"创建成功\");\r\n          this.currentNodeRef.loaded = false;\r\n          this.currentNodeRef.expand();\r\n          return true;\r\n        } else {\r\n          this.$message.error(res.data.msg);\r\n          return false;\r\n        }\r\n      } catch (e) {\r\n        this.$message.error(\"请求失败\");\r\n        return false;\r\n      } finally {\r\n        this.submitting = false;\r\n      }\r\n    },\r\n    // 【核心修改】支持复合主键的建表 SQL 生成\r\n    async submitCreateTable() {\r\n      if (!this.tableForm.tableName) return this.$message.warning(\"请输入表名\");\r\n      const schema = this.currentNodeData.schema;\r\n      const fullTableName = `\"${schema}\".\"${this.tableForm.tableName}\"`;\r\n\r\n      // 1. 生成普通列定义\r\n      let colsSql = this.tableForm.columns\r\n        .map((col) => {\r\n          let line = `\"${col.name}\" ${col.type}`;\r\n          if (\r\n            col.length &&\r\n            ![\"INTEGER\", \"DATE\", \"TIMESTAMP\", \"TEXT\"].includes(col.type)\r\n          )\r\n            line += `(${col.length})`;\r\n          if (col.notNull) line += \" NOT NULL\";\r\n          // 注意：不再这里加 PRIMARY KEY\r\n          return line;\r\n        })\r\n        .join(\",\\n  \");\r\n\r\n      // 2. 收集所有勾选了 PK 的列\r\n      const pkCols = this.tableForm.columns\r\n        .filter(c => c.pk)\r\n        .map(c => `\"${c.name}\"`);\r\n\r\n      // 3. 如果有主键，添加表级约束\r\n      let pkSql = \"\";\r\n      if (pkCols.length > 0) {\r\n        // CONSTRAINT PK_表名 PRIMARY KEY (列1, 列2)\r\n        pkSql = `,\\n  CONSTRAINT \"PK_${this.tableForm.tableName}\" PRIMARY KEY (${pkCols.join(', ')})`;\r\n      }\r\n\r\n      const sql = `CREATE TABLE ${fullTableName} (\\n  ${colsSql}${pkSql}\\n);`;\r\n\r\n      if (await this.executeDDL(sql)) this.createTableVisible = false;\r\n    },\r\n    async submitCreateView() {\r\n      if (!this.viewForm.name || !this.viewForm.sql)\r\n        return this.$message.warning(\"请填写完整\");\r\n      const schema = this.currentNodeData.schema;\r\n      const sql = `CREATE OR REPLACE VIEW \"${schema}\".\"${this.viewForm.name}\" AS\\n${this.viewForm.sql}`;\r\n      if (await this.executeDDL(sql)) this.createViewVisible = false;\r\n    },\r\n    async submitCreateTrigger() {\r\n      if (!this.triggerSql) return;\r\n      if (await this.executeDDL(this.triggerSql))\r\n        this.createTriggerVisible = false;\r\n    },\r\n\r\n    // 【新增】提交创建角色\r\n    async submitCreateRole() {\r\n      if (!this.roleForm.name) return this.$message.warning(\"请输入角色名称\");\r\n      try {\r\n        const res = await request.post(\"/db/role/create\", { roleName: this.roleForm.name }, { headers: { \"Conn-Id\": this.currentNodeData.connId } });\r\n        if (res.data.code === 200) {\r\n          this.$message.success(\"创建成功\");\r\n          this.createRoleVisible = false;\r\n          this.currentNodeRef.loaded = false;\r\n          this.currentNodeRef.expand();\r\n        } else {\r\n          this.$message.error(res.data.msg);\r\n        }\r\n      } catch (e) { this.$message.error(\"创建失败\"); }\r\n    }\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.layout-container {\r\n  height: 100vh;\r\n  background: #f0f2f5;\r\n}\r\n\r\n.sidebar {\r\n  background: #fff;\r\n  border-right: 1px solid #e6e6e6;\r\n  display: flex;\r\n  flex-direction: column;\r\n}\r\n\r\n.sidebar-header-wrapper {\r\n  border-bottom: 1px solid #eee;\r\n  padding-bottom: 10px;\r\n}\r\n\r\n.sidebar-header-top {\r\n  padding: 0 15px;\r\n  height: 40px;\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n}\r\n\r\n.sidebar-search {\r\n  padding: 0 10px;\r\n}\r\n\r\n.app-title {\r\n  font-weight: bold;\r\n  color: #333;\r\n  font-size: 14px;\r\n}\r\n\r\n.header-actions {\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n\r\n.db-tree {\r\n  flex: 1;\r\n  overflow-y: auto;\r\n  padding-top: 5px;\r\n}\r\n\r\n.custom-tree-node {\r\n  flex: 1;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n  font-size: 13px;\r\n  padding-right: 8px;\r\n}\r\n\r\n.custom-tree-node i {\r\n  margin-right: 5px;\r\n  color: #409eff;\r\n}\r\n\r\n.node-actions {\r\n  display: none;\r\n}\r\n\r\n.custom-tree-node:hover .node-actions {\r\n  display: inline-block;\r\n}\r\n\r\n.main-content {\r\n  padding: 0;\r\n  display: flex;\r\n  flex-direction: column;\r\n  background: #fff;\r\n  overflow: hidden;\r\n}\r\n\r\n.empty-state {\r\n  height: 100%;\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: center;\r\n  align-items: center;\r\n  color: #ccc;\r\n}\r\n\r\n.empty-state i {\r\n  font-size: 60px;\r\n  margin-bottom: 10px;\r\n}\r\n\r\n::v-deep .el-tabs {\r\n  height: 100%;\r\n  display: flex;\r\n  flex-direction: column;\r\n}\r\n\r\n::v-deep .el-tabs__header {\r\n  margin: 0;\r\n  background: #f5f7fa;\r\n  border-bottom: 1px solid #e4e7ed;\r\n}\r\n\r\n::v-deep .el-tabs__content {\r\n  flex: 1;\r\n  padding: 0;\r\n  overflow: hidden;\r\n  height: 100%;\r\n}\r\n\r\n::v-deep .el-tab-pane {\r\n  height: 100%;\r\n}\r\n</style>"]}]}
{"remainingRequest":"D:\\开发\\database-management-system\\dmdb-ui\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\开发\\database-management-system\\dmdb-ui\\src\\components\\TableDetail.vue?vue&type=script&lang=js","dependencies":[{"path":"D:\\开发\\database-management-system\\dmdb-ui\\src\\components\\TableDetail.vue","mtime":1770398728692},{"path":"D:\\开发\\database-management-system\\dmdb-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\开发\\database-management-system\\dmdb-ui\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"D:\\开发\\database-management-system\\dmdb-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\开发\\database-management-system\\dmdb-ui\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQppbXBvcnQgcmVxdWVzdCBmcm9tICdAL3V0aWxzL3JlcXVlc3QnOw0KaW1wb3J0IEc2IGZyb20gJ0BhbnR2L2c2JzsNCmltcG9ydCBTcWxFZGl0b3IgZnJvbSAnLi9TcWxFZGl0b3IudnVlJzsNCg0KLy8gRzYgbG9naWMgcmVtYWlucyBzYW1lDQpHNi5yZWdpc3Rlck5vZGUoJ2RiLXRhYmxlJywgew0KICAgIGRyYXc6IChjZmcsIGdyb3VwKSA9PiB7DQogICAgICAgIGNvbnN0IHsgbGFiZWwsIHRhYmxlQ29tbWVudCwgY29sdW1ucyA9IFtdLCBpc0NlbnRlciwgaXNUcnVuY2F0ZWQsIHRvdGFsQ29sQ291bnQgfSA9IGNmZzsNCiAgICAgICAgY29uc3Qgd2lkdGggPSAzMDA7DQogICAgICAgIGNvbnN0IGhlYWRlckhlaWdodCA9IDUwOw0KICAgICAgICBjb25zdCByb3dIZWlnaHQgPSAyODsNCiAgICAgICAgY29uc3QgY29udGVudEhlaWdodCA9IGNvbHVtbnMubGVuZ3RoICogcm93SGVpZ2h0Ow0KDQogICAgICAgIGxldCBmb290ZXJIZWlnaHQgPSAwOw0KICAgICAgICBpZiAoaXNUcnVuY2F0ZWQpIGZvb3RlckhlaWdodCA9IDI0Ow0KICAgICAgICBlbHNlIGlmICh0b3RhbENvbENvdW50ID4gMTApIGZvb3RlckhlaWdodCA9IDI0Ow0KDQogICAgICAgIGNvbnN0IGhlaWdodCA9IGhlYWRlckhlaWdodCArIGNvbnRlbnRIZWlnaHQgKyBmb290ZXJIZWlnaHQgKyA4Ow0KDQogICAgICAgIGdyb3VwLmFkZFNoYXBlKCdyZWN0JywgeyBhdHRyczogeyB4OiAwLCB5OiAwLCB3aWR0aCwgaGVpZ2h0LCBmaWxsOiAnI2ZmZicsIHN0cm9rZTogaXNDZW50ZXIgPyAnIzQwOUVGRicgOiAnI0RDREZFNicsIGxpbmVXaWR0aDogMSwgcmFkaXVzOiA0IH0sIG5hbWU6ICdjb250YWluZXItc2hhcGUnIH0pOw0KICAgICAgICBncm91cC5hZGRTaGFwZSgncmVjdCcsIHsgYXR0cnM6IHsgeDogMCwgeTogMCwgd2lkdGgsIGhlaWdodDogaGVhZGVySGVpZ2h0LCBmaWxsOiBpc0NlbnRlciA/ICcjNDA5RUZGJyA6ICcjRjJGNkZDJywgcmFkaXVzOiBbNCwgNCwgMCwgMF0gfSwgbmFtZTogJ2hlYWRlci1zaGFwZScgfSk7DQoNCiAgICAgICAgZ3JvdXAuYWRkU2hhcGUoJ3RleHQnLCB7IGF0dHJzOiB7IHg6IDEwLCB5OiAyMCwgdGV4dDogbGFiZWwsIGZpbGw6IGlzQ2VudGVyID8gJyNmZmYnIDogJyMzMzMnLCBmb250U2l6ZTogMTMsIGZvbnRXZWlnaHQ6ICdib2xkJywgdGV4dEJhc2VsaW5lOiAnbWlkZGxlJyB9LCBuYW1lOiAndGl0bGUtdGV4dCcgfSk7DQogICAgICAgIGlmICh0YWJsZUNvbW1lbnQpIHsNCiAgICAgICAgICAgIGdyb3VwLmFkZFNoYXBlKCd0ZXh0JywgeyBhdHRyczogeyB4OiAxMCwgeTogMzgsIHRleHQ6IHRhYmxlQ29tbWVudCwgZmlsbDogaXNDZW50ZXIgPyAnI2VlZScgOiAnIzkwOTM5OScsIGZvbnRTaXplOiAxMSwgdGV4dEJhc2VsaW5lOiAnbWlkZGxlJyB9LCBuYW1lOiAnY29tbWVudC10ZXh0JyB9KTsNCiAgICAgICAgfQ0KDQogICAgICAgIGNvbHVtbnMuZm9yRWFjaCgoY29sLCBpKSA9PiB7DQogICAgICAgICAgICBjb25zdCB5ID0gaGVhZGVySGVpZ2h0ICsgKGkgKiByb3dIZWlnaHQpICsgKHJvd0hlaWdodCAvIDIpOw0KICAgICAgICAgICAgZ3JvdXAuYWRkU2hhcGUoJ3RleHQnLCB7IGF0dHJzOiB7IHg6IDI4LCB5OiB5LCB0ZXh0OiBjb2wuQ09MVU1OX05BTUUsIGZpbGw6IGNvbC5JU19QSyA/ICcjRTZBMjNDJyA6ICcjMzMzJywgZm9udFNpemU6IDEyLCB0ZXh0QmFzZWxpbmU6ICdtaWRkbGUnLCBmb250V2VpZ2h0OiBjb2wuSVNfUEsgPyAnYm9sZCcgOiAnbm9ybWFsJyB9IH0pOw0KICAgICAgICAgICAgaWYgKGNvbC5JU19QSykgew0KICAgICAgICAgICAgICAgIGdyb3VwLmFkZFNoYXBlKCdjaXJjbGUnLCB7IGF0dHJzOiB7IHg6IDE0LCB5OiB5LCByOiAzLCBmaWxsOiAnI0U2QTIzQycgfSB9KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChjb2wuQ09NTUVOVFMpIHsNCiAgICAgICAgICAgICAgICBsZXQgY29tbWVudCA9IGNvbC5DT01NRU5UUzsNCiAgICAgICAgICAgICAgICBpZiAoY29tbWVudC5sZW5ndGggPiAxMCkgY29tbWVudCA9IGNvbW1lbnQuc3Vic3RyaW5nKDAsIDEwKSArICcuLi4nOw0KICAgICAgICAgICAgICAgIGdyb3VwLmFkZFNoYXBlKCd0ZXh0JywgeyBhdHRyczogeyB4OiAxNjAsIHk6IHksIHRleHQ6IGNvbW1lbnQsIGZpbGw6ICcjOTA5Mzk5JywgZm9udFNpemU6IDExLCB0ZXh0QmFzZWxpbmU6ICdtaWRkbGUnIH0gfSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KDQogICAgICAgIGNvbnN0IHkgPSBoZWFkZXJIZWlnaHQgKyBjb250ZW50SGVpZ2h0ICsgMTI7DQogICAgICAgIGlmIChpc1RydW5jYXRlZCkgew0KICAgICAgICAgICAgZ3JvdXAuYWRkU2hhcGUoJ3RleHQnLCB7IGF0dHJzOiB7IHg6IHdpZHRoIC8gMiwgeTogeSwgdGV4dDogYC4uLiAo5YWxICR7dG90YWxDb2xDb3VudH0g5YiX77yM54K55Ye75bGV5byAKWAsIGZpbGw6ICcjOTA5Mzk5JywgZm9udFNpemU6IDExLCB0ZXh0QWxpZ246ICdjZW50ZXInLCB0ZXh0QmFzZWxpbmU6ICdtaWRkbGUnLCBjdXJzb3I6ICdwb2ludGVyJyB9LCBuYW1lOiAnZXhwYW5kLXRleHQnIH0pOw0KICAgICAgICB9IGVsc2UgaWYgKHRvdGFsQ29sQ291bnQgPiAxMCkgew0KICAgICAgICAgICAgZ3JvdXAuYWRkU2hhcGUoJ3RleHQnLCB7IGF0dHJzOiB7IHg6IHdpZHRoIC8gMiwgeTogeSwgdGV4dDogJ+KshiDngrnlh7vmipjlj6AnLCBmaWxsOiAnIzQwOUVGRicsIGZvbnRTaXplOiAxMSwgdGV4dEFsaWduOiAnY2VudGVyJywgdGV4dEJhc2VsaW5lOiAnbWlkZGxlJywgY3Vyc29yOiAncG9pbnRlcicgfSwgbmFtZTogJ2NvbGxhcHNlLXRleHQnIH0pOw0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIGdyb3VwLmdldCgnY2hpbGRyZW4nKVswXTsNCiAgICB9DQp9KTsNCg0KZXhwb3J0IGRlZmF1bHQgew0KICAgIG5hbWU6ICdUYWJsZURldGFpbCcsDQogICAgY29tcG9uZW50czogeyBTcWxFZGl0b3IgfSwNCiAgICBwcm9wczogWydjb25uSWQnLCAnY29ubk5hbWUnLCAnc2NoZW1hJywgJ3RhYmxlTmFtZScsICdpbml0aWFsRmlsdGVyJywgJ2luaXRWaWV3TW9kZScsICd0YWJsZVR5cGUnXSwNCiAgICBkYXRhKCkgew0KICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgY3VycmVudFNjaGVtYTogdGhpcy5zY2hlbWEsIGFjdGl2ZVRhYmxlOiB0aGlzLnRhYmxlTmFtZSwNCiAgICAgICAgICAgIHZpZXdNb2RlOiB0aGlzLmluaXRWaWV3TW9kZSB8fCAnZGF0YScsDQogICAgICAgICAgICBsb2FkaW5nOiBmYWxzZSwgc2F2aW5nOiBmYWxzZSwNCiAgICAgICAgICAgIGN1cnJlbnREYXRhTGlzdDogW10sIHRvdGFsQ291bnQ6IDAsIGN1cnJlbnRQYWdlOiAxLCBwYWdlU2l6ZTogNTAsDQogICAgICAgICAgICBlZGl0aW5nQ2VsbDogbnVsbCwgb3JpZ2luYWxEYXRhTWFwOiB7fSwgbW9kaWZpZWRSb3dzOiBuZXcgU2V0KCksIG5ld1Jvd3M6IFtdLA0KICAgICAgICAgICAgdGFibGVDb2x1bW5zOiBbXSwgY29uZGl0aW9uczogW10sIGxvZ2ljYWxPcGVyYXRvcjogJ0FORCcsDQogICAgICAgICAgICBjb25mbGljdFZpc2libGU6IGZhbHNlLCBjb25mbGljdExpc3Q6IFtdLCBjb25mbGljdFBrVmFsdWU6IG51bGwsIGNvbmZsaWN0VHlwZTogJ2RlbGV0ZScsDQogICAgICAgICAgICBjdXN0b21TcWw6ICcnLCBzcWxSZXN1bHQ6IFtdLA0KICAgICAgICAgICAgZGRsVmlzaWJsZTogZmFsc2UsIGN1cnJlbnREREw6ICcnLA0KDQogICAgICAgICAgICBlZGl0Vmlld1Zpc2libGU6IGZhbHNlLCB2aWV3U3FsOiAnJywNCiAgICAgICAgICAgIGlzU2ltcGxlVmlldzogdHJ1ZSwNCg0KICAgICAgICAgICAgLy8g5qCH6K6w5piv5ZCm5LuO5Yay56qB6Lez6L2sDQogICAgICAgICAgICBqdW1wRnJvbUNvbmZsaWN0OiBmYWxzZSwNCg0KICAgICAgICAgICAgLy8g44CQ5paw5aKe44CR6YCJ5Lit55qE6KGMDQogICAgICAgICAgICBzZWxlY3RlZFJvd3M6IFtdLA0KDQogICAgICAgICAgICBkZXNpZ25WaXNpYmxlOiBmYWxzZSwgZGVzaWduQWN0aXZlVGFiOiAnY29sdW1ucycsDQogICAgICAgICAgICBkZXNpZ25Db2x1bW5zOiBbXSwgb3JpZ2luYWxDb2x1bW5zOiBbXSwgZGVsZXRlQ29sdW1uTGlzdDogW10sDQogICAgICAgICAgICBkZXNpZ25JbmRleGVzOiBbXSwgZGVsZXRlSW5kZXhMaXN0OiBbXSwNCiAgICAgICAgICAgIGRlc2lnbkZvcmVpZ25LZXlzOiBbXSwgZGVsZXRlRmtMaXN0OiBbXSwNCiAgICAgICAgICAgIGFsbFRhYmxlTmFtZXM6IFtdLCByZWZDb2x1bW5zQ2FjaGU6IHt9LA0KDQogICAgICAgICAgICBzaG93QWxsQ29sdW1uczogZmFsc2UsIGV4cGFuZGVkVGFibGVMaXN0OiBbXSwgZ3JhcGhOb2RlSWRzOiBbXSwNCiAgICAgICAgICAgIHNxbENvbmZpcm1WaXNpYmxlOiBmYWxzZSwgZ2VuZXJhdGVkU3FsOiAnJywgYWx0ZXJpbmc6IGZhbHNlDQogICAgICAgIH07DQogICAgfSwNCg0KICAgIGNvbXB1dGVkOiB7DQogICAgICAgIHJhd0tleXMoKSB7IHJldHVybiB0aGlzLmN1cnJlbnREYXRhTGlzdC5sZW5ndGggPyBPYmplY3Qua2V5cyh0aGlzLmN1cnJlbnREYXRhTGlzdFswXSkuZmlsdGVyKGsgPT4gayAhPT0gJ0RCX0lOVEVSTkFMX0lEJykgOiBbXTsgfSwNCiAgICAgICAgaGFzQ2hhbmdlcygpIHsgcmV0dXJuIHRoaXMubW9kaWZpZWRSb3dzLnNpemUgPiAwIHx8IHRoaXMubmV3Um93cy5sZW5ndGggPiAwOyB9LA0KICAgICAgICBpc1JlYWRPbmx5KCkgew0KICAgICAgICAgICAgaWYgKHRoaXMudGFibGVUeXBlID09PSAndGFibGUnKSByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICBpZiAodGhpcy50YWJsZVR5cGUgPT09ICd2aWV3JykgcmV0dXJuICF0aGlzLmlzU2ltcGxlVmlldzsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9LA0KICAgICAgICBpc1BhcmVudE1pc3NpbmcoKSB7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5jb25mbGljdExpc3QubGVuZ3RoID4gMCAmJiB0aGlzLmNvbmZsaWN0TGlzdFswXS5DTlQgPT09ICdNSVNTSU5HJzsNCiAgICAgICAgfSwNCiAgICAgICAgY29uZmxpY3RUaXRsZSgpIHsNCiAgICAgICAgICAgIGlmICh0aGlzLmlzUGFyZW50TWlzc2luZykgcmV0dXJuICfimqDvuI8g5L+d5a2Y5aSx6LSl77ya55uu5qCH5Li76ZSu57y65aSxJzsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbmZsaWN0VHlwZSA9PT0gJ2RlbGV0ZScgPyAn4pqg77iPIOaXoOazleWIoOmZpO+8muWtmOWcqOWFs+iBlOW8leeUqCcgOiAn4pqg77iPIOaXoOazleS/ruaUue+8muWtmOWcqOWFs+iBlOW8leeUqCc7DQogICAgICAgIH0sDQogICAgICAgIGNvbmZsaWN0TWVzc2FnZSgpIHsNCiAgICAgICAgICAgIGlmICh0aGlzLmlzUGFyZW50TWlzc2luZykgcmV0dXJuICfmgqjovpPlhaXnmoQg5aSW6ZSu5YC8IOWcqOebruagh+S4u+ihqOS4reS4jeWtmOWcqOOAguivt+WFiOWcqOS4u+ihqOS4reWIm+W7uuivpeaVsOaNru+8jOaIluS/ruaUueS4uuW3suWtmOWcqOeahOWAvOOAgic7DQogICAgICAgICAgICByZXR1cm4gYOivpeiusOW9leiiq+S7peS4iyAke3RoaXMuY29uZmxpY3RMaXN0Lmxlbmd0aH0g5byg6KGo5byV55So77yM6K+35YWI5aSE55CG6L+Z5Lqb5YWz6IGU5pWw5o2u44CCYDsNCiAgICAgICAgfQ0KICAgIH0sDQoNCiAgICBtb3VudGVkKCkgeyB0aGlzLmluaXRWaWV3KCk7IH0sDQoNCiAgICB3YXRjaDogew0KICAgICAgICBpbml0aWFsRmlsdGVyOiB7DQogICAgICAgICAgICBpbW1lZGlhdGU6IHRydWUsIGRlZXA6IHRydWUsDQogICAgICAgICAgICBoYW5kbGVyKHZhbCkgew0KICAgICAgICAgICAgICAgIGlmICh2YWwgJiYgdmFsLmZpZWxkICYmIHZhbC52YWx1ZSAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnZpZXdNb2RlICE9PSAnZGF0YScpIHRoaXMuaGFuZGxlVmlld01vZGVTd2l0Y2goJ2RhdGEnKTsNCiAgICAgICAgICAgICAgICAgICAgLy8g5qCH6K6w5LuO5aSW6YOo6Lez6L2sDQogICAgICAgICAgICAgICAgICAgIHRoaXMuanVtcEZyb21Db25mbGljdCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuYXBwbHlBdXRvRmlsdGVyKHZhbCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9LA0KICAgICAgICB0YWJsZU5hbWU6IHsNCiAgICAgICAgICAgIGltbWVkaWF0ZTogdHJ1ZSwNCiAgICAgICAgICAgIGhhbmRsZXIodmFsKSB7DQogICAgICAgICAgICAgICAgaWYgKHZhbCkgew0KICAgICAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZVRhYmxlID0gdmFsOw0KICAgICAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRTY2hlbWEgPSB0aGlzLnNjaGVtYTsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50UGFnZSA9IDE7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuZXhwYW5kZWRUYWJsZUxpc3QgPSBbXTsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93QWxsQ29sdW1ucyA9IGZhbHNlOw0KICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkUm93cyA9IFtdOyAvLyDmuIXnqbrpgInkuK0NCg0KICAgICAgICAgICAgICAgICAgICAvLyDlpoLmnpzmnInot7PovazmnaHku7bvvIzot7Pov4fmma7pgJrliqDovb0NCiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaW5pdGlhbEZpbHRlciAmJiB0aGlzLmluaXRpYWxGaWx0ZXIuZmllbGQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWREYXRhKCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9LA0KICAgICAgICBpbml0Vmlld01vZGUodmFsKSB7IGlmICh2YWwgJiYgdmFsICE9PSB0aGlzLnZpZXdNb2RlKSB0aGlzLmhhbmRsZVZpZXdNb2RlU3dpdGNoKHZhbCk7IH0sDQogICAgfSwNCg0KICAgIG1ldGhvZHM6IHsNCiAgICAgICAgYXN5bmMgcmVxdWVzdChtZXRob2QsIHVybCwgZGF0YU9yUGFyYW1zID0ge30pIHsNCiAgICAgICAgICAgIGNvbnN0IGNvbmZpZyA9IHsgbWV0aG9kLCB1cmwsIGhlYWRlcnM6IHsgJ0Nvbm4tSWQnOiB0aGlzLmNvbm5JZCB9IH07DQogICAgICAgICAgICBpZiAoIXVybC5zdGFydHNXaXRoKCcvZGInKSkgdXJsID0gJy9kYicgKyB1cmw7DQogICAgICAgICAgICBjb25maWcudXJsID0gdXJsOw0KICAgICAgICAgICAgaWYgKG1ldGhvZCA9PT0gJ2dldCcgfHwgbWV0aG9kID09PSAnZGVsZXRlJykgY29uZmlnLnBhcmFtcyA9IGRhdGFPclBhcmFtczsgZWxzZSBjb25maWcuZGF0YSA9IGRhdGFPclBhcmFtczsNCiAgICAgICAgICAgIHJldHVybiByZXF1ZXN0KGNvbmZpZyk7DQogICAgICAgIH0sDQoNCiAgICAgICAgaGFuZGxlRXJyb3IoZSwgdGl0bGUgPSAn5pON5L2c5aSx6LSlJykgew0KICAgICAgICAgICAgbGV0IHJhd01zZyA9IGUucmVzcG9uc2U/LmRhdGE/Lm1zZyB8fCBlLnJlc3BvbnNlPy5kYXRhPy5tZXNzYWdlIHx8IGUubWVzc2FnZSB8fCAn5pyq55+l6ZSZ6K+vJzsNCiAgICAgICAgICAgIGlmIChyYXdNc2cuaW5jbHVkZXMoJ25lc3RlZCBleGNlcHRpb24gaXMnKSkgcmF3TXNnID0gcmF3TXNnLnNwbGl0KCduZXN0ZWQgZXhjZXB0aW9uIGlzJykucG9wKCk7DQogICAgICAgICAgICByYXdNc2cgPSByYXdNc2cucmVwbGFjZSgvW1x3XC5dKkV4Y2VwdGlvbjpccyovZywgJycpLnRyaW0oKTsNCiAgICAgICAgICAgIGlmIChyYXdNc2cubGVuZ3RoID4gMzAwKSByYXdNc2cgPSByYXdNc2cuc3Vic3RyaW5nKDAsIDMwMCkgKyAnLi4uJzsNCiAgICAgICAgICAgIHRoaXMuJGFsZXJ0KGA8ZGl2IHN0eWxlPSJmb250LXNpemU6IDE0cHg7IGxpbmUtaGVpZ2h0OiAxLjU7IGNvbG9yOiAjNjA2MjY2OyI+PHAgc3R5bGU9ImZvbnQtd2VpZ2h0OiBib2xkOyBjb2xvcjogI0Y1NkM2QzsiPuKdjCAke3RpdGxlfe+8mjwvcD48cCBzdHlsZT0iYmFja2dyb3VuZDogI2ZlZjBmMDsgcGFkZGluZzogOHB4OyBib3JkZXItcmFkaXVzOiA0cHg7IG1hcmdpbjogNXB4IDA7IHdvcmQtYnJlYWs6IGJyZWFrLWFsbDsiPiR7cmF3TXNnfTwvcD48L2Rpdj5gLCB0aXRsZSwgeyBkYW5nZXJvdXNseVVzZUhUTUxTdHJpbmc6IHRydWUsIGNvbmZpcm1CdXR0b25UZXh0OiAn55+l6YGT5LqGJywgdHlwZTogJ2Vycm9yJywgY3VzdG9tQ2xhc3M6ICdlcnJvci1kaWFsb2ctd2lkdGgnIH0pOw0KICAgICAgICB9LA0KDQogICAgICAgIGluaXRWaWV3KCkgew0KICAgICAgICAgICAgdGhpcy5kZXN0cm95R3JhcGgoKTsNCiAgICAgICAgICAgIGlmICh0aGlzLnZpZXdNb2RlID09PSAncmVsYXRpb24nKSB0aGlzLmxvYWRSZWxhdGlvbnMoKTsNCiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMudmlld01vZGUgPT09ICdkYXRhJykgew0KICAgICAgICAgICAgICAgIGlmICghdGhpcy5pbml0aWFsRmlsdGVyIHx8ICF0aGlzLmluaXRpYWxGaWx0ZXIuZmllbGQpIHRoaXMubG9hZERhdGEoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSwNCg0KICAgICAgICBoYW5kbGVWaWV3TW9kZVN3aXRjaCh2YWwpIHsNCiAgICAgICAgICAgIGlmICh0aGlzLmhhc0NoYW5nZXMpIHsNCiAgICAgICAgICAgICAgICB0aGlzLiRjb25maXJtKCflvZPliY3mnInmnKrkv53lrZjnmoTkv67mlLnvvIzliIfmjaLop4blm77lsIbkuKLlpLHov5nkupvkv67mlLnvvIzmmK/lkKbnu6fnu63vvJ8nLCAn5o+Q56S6JywgeyB0eXBlOiAnd2FybmluZycgfSkNCiAgICAgICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4geyB0aGlzLnJlc2V0RWRpdFN0YXRlKCk7IHRoaXMuX2RvU3dpdGNoKHZhbCk7IH0pDQogICAgICAgICAgICAgICAgICAgIC5jYXRjaCgoKSA9PiB7IHRoaXMudmlld01vZGUgPSAnZGF0YSc7IH0pOw0KICAgICAgICAgICAgfSBlbHNlIHsgdGhpcy5fZG9Td2l0Y2godmFsKTsgfQ0KICAgICAgICB9LA0KDQogICAgICAgIF9kb1N3aXRjaCh2YWwpIHsNCiAgICAgICAgICAgIGNvbnN0IG1vZGUgPSAodHlwZW9mIHZhbCA9PT0gJ3N0cmluZycpID8gdmFsIDogdGhpcy52aWV3TW9kZTsNCiAgICAgICAgICAgIHRoaXMudmlld01vZGUgPSBtb2RlOw0KICAgICAgICAgICAgdGhpcy4kZW1pdCgndmlldy1tb2RlLWNoYW5nZScsIG1vZGUpOw0KICAgICAgICAgICAgaWYgKG1vZGUgPT09ICdyZWxhdGlvbicpIHRoaXMuJG5leHRUaWNrKCgpID0+IHsgdGhpcy5sb2FkUmVsYXRpb25zKCk7IH0pOw0KICAgICAgICAgICAgZWxzZSB7IHRoaXMuZGVzdHJveUdyYXBoKCk7IGlmIChtb2RlID09PSAnZGF0YScpIHRoaXMubG9hZERhdGEoKTsgfQ0KICAgICAgICB9LA0KDQogICAgICAgIGFzeW5jIGxvYWREYXRhKCkgew0KICAgICAgICAgICAgdGhpcy5yZXNldEVkaXRTdGF0ZSgpOw0KICAgICAgICAgICAgdGhpcy5zZWxlY3RlZFJvd3MgPSBbXTsNCiAgICAgICAgICAgIHRoaXMubG9hZGluZyA9IHRydWU7DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgIGNvbnN0IGNvbFJlcyA9IGF3YWl0IHRoaXMucmVxdWVzdCgnZ2V0JywgJy9jb2x1bW5zJywgeyBzY2hlbWE6IHRoaXMuY3VycmVudFNjaGVtYSwgdGFibGVOYW1lOiB0aGlzLmFjdGl2ZVRhYmxlIH0pOw0KICAgICAgICAgICAgICAgIHRoaXMudGFibGVDb2x1bW5zID0gY29sUmVzLmRhdGEuZGF0YSB8fCBbXTsNCiAgICAgICAgICAgICAgICBsZXQgbGlzdCA9IFtdOyBsZXQgdG90YWwgPSAwOw0KICAgICAgICAgICAgICAgIGNvbnN0IHBhcmFtcyA9IHsgc2NoZW1hOiB0aGlzLmN1cnJlbnRTY2hlbWEsIHRhYmxlTmFtZTogdGhpcy5hY3RpdmVUYWJsZSwgcGFnZTogdGhpcy5jdXJyZW50UGFnZSwgc2l6ZTogdGhpcy5wYWdlU2l6ZSB9Ow0KICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbmRpdGlvbnMubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgICAgICAgICBjb25zdCBmaWx0ZXJSZXMgPSBhd2FpdCB0aGlzLnJlcXVlc3QoJ3Bvc3QnLCAnL2ZpbHRlcicsIHsgLi4ucGFyYW1zLCBsb2dpYzogdGhpcy5sb2dpY2FsT3BlcmF0b3IsIGNvbmRpdGlvbnM6IHRoaXMuY29uZGl0aW9ucyB9KTsNCiAgICAgICAgICAgICAgICAgICAgbGlzdCA9IGZpbHRlclJlcy5kYXRhLmRhdGEubGlzdCB8fCBbXTsgdG90YWwgPSBmaWx0ZXJSZXMuZGF0YS5kYXRhLnRvdGFsIHx8IDA7IGlmIChmaWx0ZXJSZXMuZGF0YS5kYXRhLmlzVmlldykgeyB0aGlzLmlzU2ltcGxlVmlldyA9IGZpbHRlclJlcy5kYXRhLmRhdGEuaXNTaW1wbGVWaWV3OyB9DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0YVJlcyA9IGF3YWl0IHRoaXMucmVxdWVzdCgnZ2V0JywgJy9kYXRhJywgcGFyYW1zKTsNCiAgICAgICAgICAgICAgICAgICAgbGlzdCA9IGRhdGFSZXMuZGF0YS5kYXRhLmxpc3QgfHwgW107IHRvdGFsID0gZGF0YVJlcy5kYXRhLmRhdGEudG90YWwgfHwgMDsgaWYgKGRhdGFSZXMuZGF0YS5kYXRhLmlzVmlldykgeyB0aGlzLmlzU2ltcGxlVmlldyA9IGRhdGFSZXMuZGF0YS5kYXRhLmlzU2ltcGxlVmlldzsgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnREYXRhTGlzdCA9IGxpc3Q7IHRoaXMudG90YWxDb3VudCA9IHRvdGFsOyB0aGlzLm9yaWdpbmFsRGF0YU1hcCA9IHt9OyBsaXN0LmZvckVhY2gocm93ID0+IHsgaWYgKHJvdy5EQl9JTlRFUk5BTF9JRCkgdGhpcy5vcmlnaW5hbERhdGFNYXBbcm93LkRCX0lOVEVSTkFMX0lEXSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkocm93KSk7IH0pOw0KDQogICAgICAgICAgICAgICAgLy8g44CQ5qC45b+D5LyY5YyW44CR5LuO5Yay56qB6Lez6L2s5p2l5LiU5peg5pWw5o2uIC0+IOaJuemHj+iHquWKqOaPkuWFpQ0KICAgICAgICAgICAgICAgIGlmICh0aGlzLmp1bXBGcm9tQ29uZmxpY3QgJiYgdGhpcy50b3RhbENvdW50ID09PSAwKSB7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuanVtcEZyb21Db25mbGljdCA9IGZhbHNlOw0KICAgICAgICAgICAgICAgICAgICB0aGlzLiRuZXh0VGljaygoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyDpgY3ljobmiYDmnInov4fmu6TmnaHku7bvvIzlpoLmnpzlrZjlnKjlpJrkuKogT1Ig5p2h5Lu277yM55Sf5oiQ5aSa6KGMDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5jb25kaXRpb25zLmxlbmd0aCA+IDAgJiYgdGhpcy5sb2dpY2FsT3BlcmF0b3IgPT09ICdPUicpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgYWRkZWRDb3VudCA9IDA7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25kaXRpb25zLmZvckVhY2goY29uZCA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb25kLm9wZXJhdG9yID09PSAnPScgJiYgY29uZC52YWx1ZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVBZGRSb3coY29uZC52YWx1ZSwgY29uZC5maWVsZCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRlZENvdW50Kys7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWRkZWRDb3VudCA+IDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kbWVzc2FnZSh7IG1lc3NhZ2U6IGDlt7LkuLrmgqjmibnph4/liJvlu7ogJHthZGRlZENvdW50fSDmnaHmlrDooYzlubbloavlhaXnvLrlpLHnmoTkuLvplK7vvIzor7fooaXlhYXlhbbku5bkv6Hmga/jgIJgLCB0eXBlOiAnc3VjY2VzcycsIGR1cmF0aW9uOiA2MDAwLCBzaG93Q2xvc2U6IHRydWUgfSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDljZXmnaHku7bmg4XlhrUNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZUFkZFJvdygpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJG1lc3NhZ2UoeyBtZXNzYWdlOiAn5pyq5om+5Yiw5oyH5a6a5Li76ZSu6K6w5b2V77yM5bey6Ieq5Yqo5Li65oKo5Yib5bu65paw6KGM5bm25aGr5YWl5Li76ZSu77yM6K+36KGl5YWF5YW25LuW5L+h5oGv44CCJywgdHlwZTogJ3N1Y2Nlc3MnLCBkdXJhdGlvbjogNTAwMCwgc2hvd0Nsb3NlOiB0cnVlIH0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMudG90YWxDb3VudCA+IDApIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5qdW1wRnJvbUNvbmZsaWN0ID0gZmFsc2U7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSBjYXRjaCAoZSkgeyB0aGlzLmhhbmRsZUVycm9yKGUsICfmlbDmja7liqDovb3lpLHotKUnKTsgfSBmaW5hbGx5IHsgdGhpcy5sb2FkaW5nID0gZmFsc2U7IH0NCiAgICAgICAgfSwNCg0KICAgICAgICBhc3luYyBoYW5kbGVFZGl0VmlldygpIHsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5yZXF1ZXN0KCdnZXQnLCAnL2RkbCcsIHsgc2NoZW1hOiB0aGlzLmN1cnJlbnRTY2hlbWEsIHRhYmxlTmFtZTogdGhpcy5hY3RpdmVUYWJsZSB9KTsNCiAgICAgICAgICAgICAgICBsZXQgcmF3RERMID0gcmVzLmRhdGEuZGF0YSB8fCAnJzsNCiAgICAgICAgICAgICAgICB0aGlzLnZpZXdTcWwgPSByYXdEREwucmVwbGFjZSgvJnF1b3Q7L2csICciJykucmVwbGFjZSgvJmFwb3M7L2csICInIikucmVwbGFjZSgvJmx0Oy9nLCAnPCcpLnJlcGxhY2UoLyZndDsvZywgJz4nKS5yZXBsYWNlKC8mYW1wOy9nLCAnJicpOw0KICAgICAgICAgICAgICAgIHRoaXMuZWRpdFZpZXdWaXNpYmxlID0gdHJ1ZTsNCiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsgdGhpcy5oYW5kbGVFcnJvcihlLCAn6I635Y+W6KeG5Zu+5a6a5LmJ5aSx6LSlJyk7IH0NCiAgICAgICAgfSwNCg0KICAgICAgICBhc3luYyBzdWJtaXRWaWV3QWx0ZXIoKSB7DQogICAgICAgICAgICB0aGlzLmFsdGVyaW5nID0gdHJ1ZTsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5yZXF1ZXN0KCdwb3N0JywgJy9leGVjdXRlJywgeyBzcWw6IHRoaXMudmlld1NxbCB9KTsNCiAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuY29kZSA9PT0gMjAwKSB7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuJG1lc3NhZ2Uuc3VjY2Vzcygn6KeG5Zu+5L+u5pS55oiQ5YqfJyk7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuZWRpdFZpZXdWaXNpYmxlID0gZmFsc2U7DQogICAgICAgICAgICAgICAgICAgIHRoaXMubG9hZERhdGEoKTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IocmVzLmRhdGEubXNnKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVFcnJvcihlLCAn5L+u5pS56KeG5Zu+5aSx6LSlJyk7DQogICAgICAgICAgICB9IGZpbmFsbHkgew0KICAgICAgICAgICAgICAgIHRoaXMuYWx0ZXJpbmcgPSBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSwNCg0KICAgICAgICByZXNldEVkaXRTdGF0ZSgpIHsgdGhpcy5lZGl0aW5nQ2VsbCA9IG51bGw7IHRoaXMubW9kaWZpZWRSb3dzID0gbmV3IFNldCgpOyB0aGlzLm5ld1Jvd3MgPSBbXTsgfSwNCiAgICAgICAgaGFuZGxlRGlzY2FyZENoYW5nZXMoKSB7IHRoaXMucmVzZXRFZGl0U3RhdGUoKTsgdGhpcy5sb2FkRGF0YSgpOyB9LA0KICAgICAgICBoYW5kbGVDZWxsRGJsQ2xpY2socm93LCBjb2x1bW4pIHsNCiAgICAgICAgICAgIGlmICh0aGlzLmlzUmVhZE9ubHkpIHJldHVybjsNCiAgICAgICAgICAgIHRoaXMuZWRpdGluZ0NlbGwgPSB7IHJvd0lkOiByb3cuREJfSU5URVJOQUxfSUQgfHwgcm93Ll90ZW1wSWQsIGNvbDogY29sdW1uLnByb3BlcnR5IH07DQogICAgICAgICAgICB0aGlzLiRuZXh0VGljaygoKSA9PiB7IGNvbnN0IGlucHV0cyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdpbnB1dCcpOyBpZiAoaW5wdXRzICYmIGlucHV0cy5sZW5ndGggPiAwKSBpbnB1dHNbaW5wdXRzLmxlbmd0aCAtIDFdLmZvY3VzKCk7IH0pOw0KICAgICAgICB9LA0KICAgICAgICBpc0NlbGxFZGl0aW5nKHJvdywgY29sTmFtZSkgeyBpZiAoIXRoaXMuZWRpdGluZ0NlbGwpIHJldHVybiBmYWxzZTsgY29uc3QgaWQgPSByb3cuREJfSU5URVJOQUxfSUQgfHwgcm93Ll90ZW1wSWQ7IHJldHVybiB0aGlzLmVkaXRpbmdDZWxsLnJvd0lkID09PSBpZCAmJiB0aGlzLmVkaXRpbmdDZWxsLmNvbCA9PT0gY29sTmFtZTsgfSwNCiAgICAgICAgZmluaXNoRWRpdGluZyhyb3csIGNvbE5hbWUpIHsgdGhpcy5lZGl0aW5nQ2VsbCA9IG51bGw7IGNvbnN0IGlkID0gcm93LkRCX0lOVEVSTkFMX0lEOyBpZiAoIWlkKSByZXR1cm47IGNvbnN0IG9yaWdpbmFsUm93ID0gdGhpcy5vcmlnaW5hbERhdGFNYXBbaWRdOyBsZXQgbmV3VmFsID0gcm93W2NvbE5hbWVdOyBsZXQgb2xkVmFsID0gb3JpZ2luYWxSb3cgPyBvcmlnaW5hbFJvd1tjb2xOYW1lXSA6ICcnOyBpZiAobmV3VmFsID09IG51bGwpIG5ld1ZhbCA9ICcnOyBpZiAob2xkVmFsID09IG51bGwpIG9sZFZhbCA9ICcnOyBpZiAoU3RyaW5nKG5ld1ZhbCkgIT09IFN0cmluZyhvbGRWYWwpKSB7IHRoaXMubW9kaWZpZWRSb3dzLmFkZChpZCk7IHRoaXMubW9kaWZpZWRSb3dzID0gbmV3IFNldCh0aGlzLm1vZGlmaWVkUm93cyk7IH0gfSwNCiAgICAgICAgZ2V0Q2VsbFN0eWxlKHsgcm93LCBjb2x1bW4gfSkgeyBjb25zdCBpZCA9IHJvdy5EQl9JTlRFUk5BTF9JRDsgY29uc3QgY29sID0gY29sdW1uLnByb3BlcnR5OyBpZiAoIWlkICYmIHJvdy5fdGVtcElkKSByZXR1cm4geyBiYWNrZ3JvdW5kQ29sb3I6ICcjZjBmOWViJyB9OyBpZiAodGhpcy5tb2RpZmllZFJvd3MuaGFzKGlkKSkgeyBjb25zdCBvcmlnaW5hbCA9IHRoaXMub3JpZ2luYWxEYXRhTWFwW2lkXTsgbGV0IG5ld1ZhbCA9IHJvd1tjb2xdOyBsZXQgb2xkVmFsID0gb3JpZ2luYWwgPyBvcmlnaW5hbFtjb2xdIDogJyc7IGlmIChuZXdWYWwgPT0gbnVsbCkgbmV3VmFsID0gJyc7IGlmIChvbGRWYWwgPT0gbnVsbCkgb2xkVmFsID0gJyc7IGlmIChTdHJpbmcobmV3VmFsKSAhPT0gU3RyaW5nKG9sZFZhbCkpIHJldHVybiB7IGJhY2tncm91bmRDb2xvcjogJyNmZGY2ZWMnLCBjb2xvcjogJyNFNkEyM0MnLCBmb250V2VpZ2h0OiAnYm9sZCcgfTsgfSByZXR1cm4ge307IH0sDQoNCiAgICAgICAgLy8g44CQ5qC45b+D5L+u5pS544CR5pSv5oyB5Y+C5pWw5YyW5aGr5YWFDQogICAgICAgIGhhbmRsZUFkZFJvdyhwcmVmaWxsVmFsdWUgPSBudWxsLCBwcmVmaWxsRmllbGQgPSBudWxsKSB7DQogICAgICAgICAgICBjb25zdCBuZXdSb3cgPSB7IF90ZW1wSWQ6ICdORVdfJyArIERhdGUubm93KCkgKyBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgNSkgfTsNCiAgICAgICAgICAgIHRoaXMudGFibGVDb2x1bW5zLmZvckVhY2goYyA9PiBuZXdSb3dbYy5DT0xVTU5fTkFNRV0gPSBudWxsKTsNCg0KICAgICAgICAgICAgLy8g5LyY5YWI5L2/55So5Lyg5YWl55qE5aGr5YWF5YC8DQogICAgICAgICAgICBpZiAocHJlZmlsbFZhbHVlICE9PSBudWxsICYmIHByZWZpbGxGaWVsZCkgew0KICAgICAgICAgICAgICAgIG5ld1Jvd1twcmVmaWxsRmllbGRdID0gcHJlZmlsbFZhbHVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgLy8g5ZCm5YiZ5L2/55So5b2T5YmN55qE562b6YCJ5p2h5Lu2ICjljZXmnaHku7YpDQogICAgICAgICAgICBlbHNlIGlmICh0aGlzLmNvbmRpdGlvbnMubGVuZ3RoID09PSAxICYmIHRoaXMuY29uZGl0aW9uc1swXS5vcGVyYXRvciA9PT0gJz0nKSB7DQogICAgICAgICAgICAgICAgY29uc3QgZmllbGROYW1lID0gdGhpcy5jb25kaXRpb25zWzBdLmZpZWxkOw0KICAgICAgICAgICAgICAgIGNvbnN0IHZhbCA9IHRoaXMuY29uZGl0aW9uc1swXS52YWx1ZTsNCiAgICAgICAgICAgICAgICBjb25zdCBtYXRjaEtleSA9IE9iamVjdC5rZXlzKG5ld1JvdykuZmluZChrID0+IGsudG9VcHBlckNhc2UoKSA9PT0gZmllbGROYW1lLnRvVXBwZXJDYXNlKCkpOw0KICAgICAgICAgICAgICAgIGlmIChtYXRjaEtleSAmJiB2YWwgIT09IHVuZGVmaW5lZCAmJiB2YWwgIT09IG51bGwpIHsNCiAgICAgICAgICAgICAgICAgICAgbmV3Um93W21hdGNoS2V5XSA9IHZhbDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICB0aGlzLmN1cnJlbnREYXRhTGlzdC51bnNoaWZ0KG5ld1Jvdyk7DQogICAgICAgICAgICB0aGlzLm5ld1Jvd3MucHVzaChuZXdSb3cpOw0KICAgICAgICB9LA0KDQogICAgICAgIGdldFBrQ29sdW1uTmFtZSgpIHsNCiAgICAgICAgICAgIGNvbnN0IHBrQ29sID0gdGhpcy50YWJsZUNvbHVtbnMuZmluZChjID0+IFsnMScsIDEsICdZJywgdHJ1ZV0uaW5jbHVkZXMoYy5JU19QSykpOw0KICAgICAgICAgICAgaWYgKHBrQ29sKSByZXR1cm4gcGtDb2wuQ09MVU1OX05BTUU7DQogICAgICAgICAgICBjb25zdCBpZENvbCA9IHRoaXMudGFibGVDb2x1bW5zLmZpbmQoYyA9PiBjLkNPTFVNTl9OQU1FLnRvVXBwZXJDYXNlKCkgPT09ICdJRCcpOw0KICAgICAgICAgICAgaWYgKGlkQ29sKSByZXR1cm4gaWRDb2wuQ09MVU1OX05BTUU7DQogICAgICAgICAgICBpZiAodGhpcy50YWJsZUNvbHVtbnMubGVuZ3RoID4gMCkgcmV0dXJuIHRoaXMudGFibGVDb2x1bW5zWzBdLkNPTFVNTl9OQU1FOw0KICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgIH0sDQogICAgICAgIGdldENsZWFuUm93RGF0YShyb3cpIHsgY29uc3QgY2xlYW5EYXRhID0ge307IHRoaXMudGFibGVDb2x1bW5zLmZvckVhY2goY29sID0+IHsgY2xlYW5EYXRhW2NvbC5DT0xVTU5fTkFNRV0gPSByb3dbY29sLkNPTFVNTl9OQU1FXTsgfSk7IGlmIChyb3cuREJfSU5URVJOQUxfSUQpIGNsZWFuRGF0YS5EQl9JTlRFUk5BTF9JRCA9IHJvdy5EQl9JTlRFUk5BTF9JRDsgcmV0dXJuIGNsZWFuRGF0YTsgfSwNCg0KICAgICAgICBhc3luYyBzdWJtaXRCYXRjaENoYW5nZXMoKSB7DQogICAgICAgICAgICBpZiAodGhpcy5zYXZpbmcpIHJldHVybjsNCiAgICAgICAgICAgIHRoaXMuc2F2aW5nID0gdHJ1ZTsNCg0KICAgICAgICAgICAgY29uc3QgaW5zZXJ0TGlzdCA9IHRoaXMubmV3Um93cy5tYXAocm93ID0+IHsNCiAgICAgICAgICAgICAgICBjb25zdCBjbGVhbiA9IHRoaXMuZ2V0Q2xlYW5Sb3dEYXRhKHJvdyk7DQogICAgICAgICAgICAgICAgZGVsZXRlIGNsZWFuLkRCX0lOVEVSTkFMX0lEOw0KICAgICAgICAgICAgICAgIHJldHVybiBjbGVhbjsNCiAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICBjb25zdCB1cGRhdGVMaXN0ID0gQXJyYXkuZnJvbSh0aGlzLm1vZGlmaWVkUm93cykubWFwKGlkID0+IHsNCiAgICAgICAgICAgICAgICBjb25zdCByb3cgPSB0aGlzLmN1cnJlbnREYXRhTGlzdC5maW5kKHIgPT4gci5EQl9JTlRFUk5BTF9JRCA9PT0gaWQpOw0KICAgICAgICAgICAgICAgIHJldHVybiByb3cgPyB0aGlzLmdldENsZWFuUm93RGF0YShyb3cpIDogbnVsbDsNCiAgICAgICAgICAgIH0pLmZpbHRlcihyID0+IHIgIT09IG51bGwpOw0KDQogICAgICAgICAgICBpZiAoaW5zZXJ0TGlzdC5sZW5ndGggPT09IDAgJiYgdXBkYXRlTGlzdC5sZW5ndGggPT09IDApIHsNCiAgICAgICAgICAgICAgICB0aGlzLiRtZXNzYWdlLmluZm8oIuayoeacieajgOa1i+WIsOacieaViOWPmOabtCIpOw0KICAgICAgICAgICAgICAgIHRoaXMuc2F2aW5nID0gZmFsc2U7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBjb25zdCBsb2FkaW5nSW5zdGFuY2UgPSB0aGlzLiRsb2FkaW5nKHsgbG9jazogdHJ1ZSwgdGV4dDogJ+ato+WcqOaJuemHj+S/neWtmOS4rS4uLicsIGJhY2tncm91bmQ6ICdyZ2JhKDAsIDAsIDAsIDAuNyknIH0pOw0KDQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMucmVxdWVzdCgncG9zdCcsIGAvc2F2ZS9iYXRjaD9zY2hlbWE9JHt0aGlzLmN1cnJlbnRTY2hlbWF9JnRhYmxlTmFtZT0ke3RoaXMuYWN0aXZlVGFibGV9YCwgew0KICAgICAgICAgICAgICAgICAgICBpbnNlcnRMaXN0LA0KICAgICAgICAgICAgICAgICAgICB1cGRhdGVMaXN0DQogICAgICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgICAgICBsb2FkaW5nSW5zdGFuY2UuY2xvc2UoKTsNCg0KICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5jb2RlID09PSAyMDApIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy4kbWVzc2FnZS5zdWNjZXNzKCfmibnph4/kv53lrZjmiJDlip/vvIEnKTsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkRGF0YSgpOw0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzLmRhdGEuY29kZSA9PT0gNTAzKSB7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuY29uZmxpY3RMaXN0ID0gcmVzLmRhdGEuZGF0YTsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25mbGljdFR5cGUgPSAnc2F2ZSc7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuY29uZmxpY3RWaXNpYmxlID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IocmVzLmRhdGEubXNnKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgICAgICAgbG9hZGluZ0luc3RhbmNlLmNsb3NlKCk7DQogICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVFcnJvcihlLCAn5L+d5a2Y5aSx6LSlJyk7DQogICAgICAgICAgICB9IGZpbmFsbHkgew0KICAgICAgICAgICAgICAgIHRoaXMuc2F2aW5nID0gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgIH0sDQoNCiAgICAgICAgaGFuZGxlRGVsZXRlUm93KGluZGV4LCByb3cpIHsNCiAgICAgICAgICAgIGlmICghcm93LkRCX0lOVEVSTkFMX0lEKSB7IHRoaXMuY3VycmVudERhdGFMaXN0LnNwbGljZShpbmRleCwgMSk7IGNvbnN0IGlkeCA9IHRoaXMubmV3Um93cy5pbmRleE9mKHJvdyk7IGlmIChpZHggPiAtMSkgdGhpcy5uZXdSb3dzLnNwbGljZShpZHgsIDEpOyB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICB0aGlzLiRjb25maXJtKCfnoa7lrprliKDpmaTor6XooYzmlbDmja7lkJc/JywgJ+aPkOekuicsIHsgdHlwZTogJ3dhcm5pbmcnIH0pLnRoZW4oYXN5bmMgKCkgPT4gew0KICAgICAgICAgICAgICAgICAgICBjb25zdCBwa05hbWUgPSB0aGlzLmdldFBrQ29sdW1uTmFtZSgpOyBjb25zdCBwa1ZhbCA9IHBrTmFtZSA/IHJvd1twa05hbWVdIDogbnVsbDsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5yZXF1ZXN0KCdkZWxldGUnLCAnL2RlbGV0ZScsIHsgc2NoZW1hOiB0aGlzLmN1cnJlbnRTY2hlbWEsIHRhYmxlTmFtZTogdGhpcy5hY3RpdmVUYWJsZSwgaW50ZXJuYWxJZDogcm93LkRCX0lOVEVSTkFMX0lELCBwa1ZhbHVlOiBwa1ZhbCB9KTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHJlcy5kYXRhLmNvZGUgPT09IDIwMCkgeyB0aGlzLiRtZXNzYWdlLnN1Y2Nlc3MoJ+WIoOmZpOaIkOWKnycpOyB0aGlzLmxvYWREYXRhKCk7IH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAocmVzLmRhdGEuY29kZSA9PT0gNTAzKSB7IHRoaXMuY29uZmxpY3RMaXN0ID0gcmVzLmRhdGEuZGF0YTsgdGhpcy5jb25mbGljdFBrVmFsdWUgPSBwa1ZhbDsgdGhpcy5jb25mbGljdFR5cGUgPSAnZGVsZXRlJzsgdGhpcy5jb25mbGljdFZpc2libGUgPSB0cnVlOyB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UgeyB0aHJvdyBuZXcgRXJyb3IocmVzLmRhdGEubXNnKTsgfQ0KICAgICAgICAgICAgICAgIH0pLmNhdGNoKChlKSA9PiB7DQogICAgICAgICAgICAgICAgICAgIGlmIChlICE9PSAnY2FuY2VsJykgdGhpcy5oYW5kbGVFcnJvcih7IG1lc3NhZ2U6IGUubWVzc2FnZSB8fCAn5Yig6Zmk5aSx6LSlJyB9LCAn5Yig6Zmk5aSx6LSlJyk7DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0sDQoNCiAgICAgICAgLy8g44CQ5paw5aKe44CR6YCJ5Yy65Y+Y5pu0DQogICAgICAgIGhhbmRsZVNlbGVjdGlvbkNoYW5nZSh2YWwpIHsNCiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRSb3dzID0gdmFsOw0KICAgICAgICB9LA0KDQogICAgICAgIC8vIOOAkOaWsOWinuOAkeaJuemHj+WIoOmZpOaWueazlQ0KICAgICAgICBhc3luYyBoYW5kbGVCYXRjaERlbGV0ZSgpIHsNCiAgICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGVkUm93cy5sZW5ndGggPT09IDApIHJldHVybjsNCiAgICAgICAgICAgIGNvbnN0IGV4aXN0Um93c1RvRGVsZXRlID0gdGhpcy5zZWxlY3RlZFJvd3MuZmlsdGVyKHJvdyA9PiByb3cuREJfSU5URVJOQUxfSUQpLm1hcChyb3cgPT4gcm93LkRCX0lOVEVSTkFMX0lEKTsNCiAgICAgICAgICAgIGNvbnN0IG5ld1Jvd3NUb0RlbGV0ZSA9IHRoaXMuc2VsZWN0ZWRSb3dzLmZpbHRlcihyb3cgPT4gIXJvdy5EQl9JTlRFUk5BTF9JRCk7DQoNCiAgICAgICAgICAgIHRoaXMuJGNvbmZpcm0oYOehruWumuimgeWIoOmZpOmAieS4reeahCAke3RoaXMuc2VsZWN0ZWRSb3dzLmxlbmd0aH0g5p2h5pWw5o2u5ZCX77yfYCwgJ+aJuemHj+WIoOmZpCcsIHsgdHlwZTogJ3dhcm5pbmcnIH0pLnRoZW4oYXN5bmMgKCkgPT4gew0KICAgICAgICAgICAgICAgIC8vIDEuIOWFiOWIoOacrOWcsOaWsOihjA0KICAgICAgICAgICAgICAgIG5ld1Jvd3NUb0RlbGV0ZS5mb3JFYWNoKHJvdyA9PiB7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGlkeCA9IHRoaXMuY3VycmVudERhdGFMaXN0LmluZGV4T2Yocm93KTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGlkeCA+IC0xKSB0aGlzLmN1cnJlbnREYXRhTGlzdC5zcGxpY2UoaWR4LCAxKTsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgbklkeCA9IHRoaXMubmV3Um93cy5pbmRleE9mKHJvdyk7DQogICAgICAgICAgICAgICAgICAgIGlmIChuSWR4ID4gLTEpIHRoaXMubmV3Um93cy5zcGxpY2UobklkeCwgMSk7DQogICAgICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgICAgICAvLyAyLiDlho3osIPlkI7nq6/liKDmjIHkuYXljJbooYwNCiAgICAgICAgICAgICAgICBpZiAoZXhpc3RSb3dzVG9EZWxldGUubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgICAgICAgICBjb25zdCBsb2FkaW5nSW5zdGFuY2UgPSB0aGlzLiRsb2FkaW5nKHsgbG9jazogdHJ1ZSwgdGV4dDogJ+ato+WcqOaJuemHj+WIoOmZpC4uLicsIGJhY2tncm91bmQ6ICdyZ2JhKDAsMCwwLDAuNyknIH0pOw0KICAgICAgICAgICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5yZXF1ZXN0KCdwb3N0JywgYC9kZWxldGUvYmF0Y2g/c2NoZW1hPSR7dGhpcy5jdXJyZW50U2NoZW1hfSZ0YWJsZU5hbWU9JHt0aGlzLmFjdGl2ZVRhYmxlfWAsIGV4aXN0Um93c1RvRGVsZXRlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRpbmdJbnN0YW5jZS5jbG9zZSgpOw0KDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuY29kZSA9PT0gMjAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kbWVzc2FnZS5zdWNjZXNzKCfmibnph4/liKDpmaTmiJDlip8nKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWREYXRhKCk7DQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlcy5kYXRhLmNvZGUgPT09IDUwMykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29uZmxpY3RMaXN0ID0gcmVzLmRhdGEuZGF0YTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbmZsaWN0VHlwZSA9ICdkZWxldGUnOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29uZmxpY3RWaXNpYmxlID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKHJlcy5kYXRhLm1zZyk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRpbmdJbnN0YW5jZS5jbG9zZSgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVFcnJvcihlLCAn5om56YeP5Yig6Zmk5aSx6LSlJyk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICB0aGlzLiRtZXNzYWdlLnN1Y2Nlc3MoJ+WIoOmZpOaIkOWKnycpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pLmNhdGNoKCgpID0+IHsgfSk7DQogICAgICAgIH0sDQoNCiAgICAgICAgYWRkQ29uZGl0aW9uKCkgeyBpZiAodGhpcy50YWJsZUNvbHVtbnMubGVuZ3RoID4gMCkgdGhpcy5jb25kaXRpb25zLnB1c2goeyBmaWVsZDogdGhpcy50YWJsZUNvbHVtbnNbMF0uQ09MVU1OX05BTUUsIG9wZXJhdG9yOiAnPScsIHZhbHVlOiAnJyB9KTsgfSwNCiAgICAgICAgcmVtb3ZlQ29uZGl0aW9uKGluZGV4KSB7IHRoaXMuY29uZGl0aW9ucy5zcGxpY2UoaW5kZXgsIDEpOyB9LA0KICAgICAgICBoYW5kbGVRdWVyeSgpIHsgdGhpcy5jdXJyZW50UGFnZSA9IDE7IHRoaXMubG9hZERhdGEoKTsgfSwNCiAgICAgICAgcmVzZXRGaWx0ZXJzKCkgeyB0aGlzLmNvbmRpdGlvbnMgPSBbXTsgdGhpcy5oYW5kbGVRdWVyeSgpOyB9LA0KICAgICAgICAvLyDjgJDmoLjlv4Pkv67lpI3jgJHoh6rliqjnrZvpgInvvJrmlK/mjIHlpJrlgLwgKE9SKQ0KICAgICAgICBhcHBseUF1dG9GaWx0ZXIoZmlsdGVyKSB7DQogICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShmaWx0ZXIudmFsdWUpKSB7DQogICAgICAgICAgICAgICAgdGhpcy5jb25kaXRpb25zID0gZmlsdGVyLnZhbHVlLm1hcCh2ID0+ICh7DQogICAgICAgICAgICAgICAgICAgIGZpZWxkOiBmaWx0ZXIuZmllbGQsDQogICAgICAgICAgICAgICAgICAgIG9wZXJhdG9yOiAnPScsDQogICAgICAgICAgICAgICAgICAgIHZhbHVlOiB2DQogICAgICAgICAgICAgICAgfSkpOw0KICAgICAgICAgICAgICAgIHRoaXMubG9naWNhbE9wZXJhdG9yID0gJ09SJzsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgdGhpcy5jb25kaXRpb25zID0gW3sgZmllbGQ6IGZpbHRlci5maWVsZCwgb3BlcmF0b3I6ICc9JywgdmFsdWU6IGZpbHRlci52YWx1ZSB9XTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHRoaXMuJG5leHRUaWNrKCgpID0+IHsgdGhpcy5oYW5kbGVRdWVyeSgpOyB9KTsNCiAgICAgICAgfSwNCg0KICAgICAgICAvLyDjgJDmoLjlv4Pkv67lpI3jgJHlpITnkIbogZrlkIjlhrLnqoHliJfooagNCiAgICAgICAgcmVzb2x2ZUNvbmZsaWN0KHJvdykgew0KICAgICAgICAgICAgdGhpcy5jb25mbGljdFZpc2libGUgPSBmYWxzZTsNCg0KICAgICAgICAgICAgLy8g5LyY5YWI5L2/55So6IGa5ZCI5YC85YiX6KGoDQogICAgICAgICAgICBsZXQgZmlsdGVyVmFsdWUgPSBbXTsNCiAgICAgICAgICAgIGlmIChyb3cuTVlfVkFMX0xJU1QgJiYgcm93Lk1ZX1ZBTF9MSVNULmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgICAgICBmaWx0ZXJWYWx1ZSA9IHJvdy5NWV9WQUxfTElTVDsNCiAgICAgICAgICAgIH0gZWxzZSBpZiAocm93Lk1ZX1ZBTCAhPT0gdW5kZWZpbmVkICYmIHJvdy5NWV9WQUwgIT09IG51bGwpIHsNCiAgICAgICAgICAgICAgICBmaWx0ZXJWYWx1ZSA9IFtyb3cuTVlfVkFMXTsNCiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5jb25mbGljdFBrVmFsdWUpIHsNCiAgICAgICAgICAgICAgICBmaWx0ZXJWYWx1ZSA9IFt0aGlzLmNvbmZsaWN0UGtWYWx1ZV07DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHRoaXMuJGVtaXQoJ29wZW4tdGFibGUnLCB7DQogICAgICAgICAgICAgICAgY29ubklkOiB0aGlzLmNvbm5JZCwNCiAgICAgICAgICAgICAgICBzY2hlbWE6IHRoaXMuY3VycmVudFNjaGVtYSwNCiAgICAgICAgICAgICAgICB0YWJsZU5hbWU6IHJvdy5UQUJMRV9OQU1FLA0KICAgICAgICAgICAgICAgIGluaXRWaWV3TW9kZTogJ2RhdGEnLA0KICAgICAgICAgICAgICAgIGZpbHRlcjogew0KICAgICAgICAgICAgICAgICAgICBmaWVsZDogcm93LkNPTFVNTl9OQU1FLA0KICAgICAgICAgICAgICAgICAgICB2YWx1ZTogZmlsdGVyVmFsdWUgLy8g5Lyg5pWw57uEDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0sDQogICAgICAgIGFzeW5jIGhhbmRsZVNob3dEREwoKSB7DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMucmVxdWVzdCgnZ2V0JywgJy9kZGwnLCB7IHNjaGVtYTogdGhpcy5jdXJyZW50U2NoZW1hLCB0YWJsZU5hbWU6IHRoaXMuYWN0aXZlVGFibGUgfSk7DQogICAgICAgICAgICAgICAgbGV0IHJhd0RETCA9IHJlcy5kYXRhLmRhdGEgfHwgJyc7DQogICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50RERMID0gcmF3RERMLnJlcGxhY2UoLyZxdW90Oy9nLCAnIicpLnJlcGxhY2UoLyZhcG9zOy9nLCAiJyIpLnJlcGxhY2UoLyZsdDsvZywgJzwnKS5yZXBsYWNlKC8mZ3Q7L2csICc+JykucmVwbGFjZSgvJmFtcDsvZywgJyYnKTsNCiAgICAgICAgICAgICAgICB0aGlzLmRkbFZpc2libGUgPSB0cnVlOw0KICAgICAgICAgICAgfSBjYXRjaCAoZSkgeyB0aGlzLmhhbmRsZUVycm9yKGUsICfojrflj5ZEREzlpLHotKUnKTsgfQ0KICAgICAgICB9LA0KDQogICAgICAgIC8vIC4uLiBEZXNpZ24gdGFibGUgcmVsYXRlZCBtZXRob2RzIChvbWl0dGVkIGZvciBicmV2aXR5LCBrZWVwIGFzIGlzKSAuLi4NCiAgICAgICAgYXN5bmMgaGFuZGxlRGVzaWduVGFibGUoKSB7DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgIGNvbnN0IGNvbFJlcyA9IGF3YWl0IHRoaXMucmVxdWVzdCgnZ2V0JywgJy9jb2x1bW5zJywgeyBzY2hlbWE6IHRoaXMuY3VycmVudFNjaGVtYSwgdGFibGVOYW1lOiB0aGlzLmFjdGl2ZVRhYmxlIH0pOw0KICAgICAgICAgICAgICAgIGNvbnN0IGNvbHMgPSBjb2xSZXMuZGF0YS5kYXRhOw0KICAgICAgICAgICAgICAgIHRoaXMub3JpZ2luYWxDb2x1bW5zID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShjb2xzLm1hcChjID0+ICh7DQogICAgICAgICAgICAgICAgICAgIC4uLmMsDQogICAgICAgICAgICAgICAgICAgIERBVEFfTEVOR1RIOiBjLkRBVEFfTEVOR1RIID8gU3RyaW5nKGMuREFUQV9MRU5HVEgpIDogJycsDQogICAgICAgICAgICAgICAgICAgIENPTU1FTlRTOiBjLkNPTU1FTlRTIHx8ICcnLA0KICAgICAgICAgICAgICAgICAgICBEQVRBX0RFRkFVTFQ6IGMuREFUQV9ERUZBVUxUIHx8ICcnLA0KICAgICAgICAgICAgICAgICAgICBJU19QSzogWycxJywgMSwgJ1knLCAneScsICd0cnVlJywgdHJ1ZV0uaW5jbHVkZXMoYy5JU19QSykNCiAgICAgICAgICAgICAgICB9KSkpKTsNCg0KICAgICAgICAgICAgICAgIHRoaXMuZGVzaWduQ29sdW1ucyA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5vcmlnaW5hbENvbHVtbnMpKS5tYXAoYyA9PiAoeyAuLi5jLCBfc3RhdHVzOiAnb3JpZ2luYWwnLCBfb3JpZ2luYWxOYW1lOiBjLkNPTFVNTl9OQU1FIH0pKTsNCg0KICAgICAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGlkeFJlcyA9IGF3YWl0IHRoaXMucmVxdWVzdCgnZ2V0JywgJy9pbmRleGVzJywgeyBzY2hlbWE6IHRoaXMuY3VycmVudFNjaGVtYSwgdGFibGVOYW1lOiB0aGlzLmFjdGl2ZVRhYmxlIH0pOw0KICAgICAgICAgICAgICAgICAgICBpZiAoaWR4UmVzLmRhdGEuY29kZSA9PT0gMjAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRlc2lnbkluZGV4ZXMgPSBpZHhSZXMuZGF0YS5kYXRhLm1hcChpID0+ICh7IC4uLmksIF9zdGF0dXM6ICdvcmlnaW5hbCcsIENPTFVNTlM6IGkuQ09MVU1OUy5zcGxpdCgnLCcpIH0pKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsgdGhpcy5kZXNpZ25JbmRleGVzID0gW107IH0NCg0KICAgICAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGZrUmVzID0gYXdhaXQgdGhpcy5yZXF1ZXN0KCdnZXQnLCAnL2ZvcmVpZ24ta2V5cycsIHsgc2NoZW1hOiB0aGlzLmN1cnJlbnRTY2hlbWEsIHRhYmxlTmFtZTogdGhpcy5hY3RpdmVUYWJsZSB9KTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGZrUmVzLmRhdGEuY29kZSA9PT0gMjAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRlc2lnbkZvcmVpZ25LZXlzID0gZmtSZXMuZGF0YS5kYXRhLm1hcChmID0+ICh7IC4uLmYsIF9zdGF0dXM6ICdvcmlnaW5hbCcgfSkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVmVGFibGVzID0gWy4uLm5ldyBTZXQodGhpcy5kZXNpZ25Gb3JlaWduS2V5cy5tYXAoZiA9PiBmLlJfVEFCTEVfTkFNRSkuZmlsdGVyKHQgPT4gdCkpXTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlZlRhYmxlcy5mb3JFYWNoKHQgPT4gdGhpcy5sb2FkUmVmQ29sdW1ucyh0KSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7IHRoaXMuZGVzaWduRm9yZWlnbktleXMgPSBbXTsgfQ0KDQogICAgICAgICAgICAgICAgY29uc3QgdGFibGVzUmVzID0gYXdhaXQgdGhpcy5yZXF1ZXN0KCdnZXQnLCAnL3RhYmxlcycsIHsgc2NoZW1hOiB0aGlzLmN1cnJlbnRTY2hlbWEgfSk7DQogICAgICAgICAgICAgICAgdGhpcy5hbGxUYWJsZU5hbWVzID0gKHRhYmxlc1Jlcy5kYXRhLmRhdGEgfHwgW10pLm1hcCh0ID0+IHQuVEFCTEVfTkFNRSk7DQoNCiAgICAgICAgICAgICAgICB0aGlzLmRlbGV0ZUNvbHVtbkxpc3QgPSBbXTsNCiAgICAgICAgICAgICAgICB0aGlzLmRlbGV0ZUluZGV4TGlzdCA9IFtdOw0KICAgICAgICAgICAgICAgIHRoaXMuZGVsZXRlRmtMaXN0ID0gW107DQogICAgICAgICAgICAgICAgdGhpcy5kZXNpZ25BY3RpdmVUYWIgPSAnY29sdW1ucyc7DQogICAgICAgICAgICAgICAgdGhpcy5kZXNpZ25WaXNpYmxlID0gdHJ1ZTsNCiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsgdGhpcy5oYW5kbGVFcnJvcihlLCAn5Yqg6L296K6+6K6h5Zmo5aSx6LSlJyk7IH0NCiAgICAgICAgfSwNCg0KICAgICAgICBhc3luYyBsb2FkUmVmQ29sdW1ucyh0YWJsZU5hbWUpIHsNCiAgICAgICAgICAgIGlmICghdGFibGVOYW1lIHx8IHRoaXMucmVmQ29sdW1uc0NhY2hlW3RhYmxlTmFtZV0pIHJldHVybjsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5yZXF1ZXN0KCdnZXQnLCAnL2NvbHVtbnMnLCB7IHNjaGVtYTogdGhpcy5jdXJyZW50U2NoZW1hLCB0YWJsZU5hbWU6IHRhYmxlTmFtZSB9KTsNCiAgICAgICAgICAgICAgICB0aGlzLiRzZXQodGhpcy5yZWZDb2x1bW5zQ2FjaGUsIHRhYmxlTmFtZSwgcmVzLmRhdGEuZGF0YSB8fCBbXSk7DQogICAgICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcigi5Yqg6L295byV55So6KGo5YiX5aSx6LSlIiwgZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0sDQoNCiAgICAgICAgaGFuZGxlUmVmVGFibGVDaGFuZ2Uocm93KSB7DQogICAgICAgICAgICByb3cuUl9DT0xVTU5fTkFNRSA9ICcnOw0KICAgICAgICAgICAgaWYgKHJvdy5SX1RBQkxFX05BTUUpIHsNCiAgICAgICAgICAgICAgICB0aGlzLmxvYWRSZWZDb2x1bW5zKHJvdy5SX1RBQkxFX05BTUUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9LA0KDQogICAgICAgIGlzRGlmZihuZXdWYWwsIG9sZFZhbCkgew0KICAgICAgICAgICAgY29uc3QgbiA9IChuZXdWYWwgPT09IG51bGwgfHwgbmV3VmFsID09PSB1bmRlZmluZWQpID8gIiIgOiBTdHJpbmcobmV3VmFsKS50cmltKCk7DQogICAgICAgICAgICBjb25zdCBvID0gKG9sZFZhbCA9PT0gbnVsbCB8fCBvbGRWYWwgPT09IHVuZGVmaW5lZCkgPyAiIiA6IFN0cmluZyhvbGRWYWwpLnRyaW0oKTsNCiAgICAgICAgICAgIHJldHVybiBuICE9PSBvOw0KICAgICAgICB9LA0KDQogICAgICAgIGFkZERlc2lnbkNvbHVtbigpIHsgdGhpcy5kZXNpZ25Db2x1bW5zLnB1c2goeyBDT0xVTU5fTkFNRTogJ05FV19DT0wnLCBEQVRBX1RZUEU6ICdWQVJDSEFSMicsIERBVEFfTEVOR1RIOiAnNTAnLCBOVUxMQUJMRTogJ1knLCBJU19QSzogZmFsc2UsIF9zdGF0dXM6ICduZXcnIH0pOyB9LA0KDQogICAgICAgIHJlbW92ZURlc2lnbkNvbHVtbihpbmRleCwgcm93KSB7IGlmIChyb3cuX3N0YXR1cyAhPT0gJ25ldycpIHRoaXMuZGVsZXRlQ29sdW1uTGlzdC5wdXNoKHJvdy5DT0xVTU5fTkFNRSk7IHRoaXMuZGVzaWduQ29sdW1ucy5zcGxpY2UoaW5kZXgsIDEpOyB9LA0KDQogICAgICAgIG1hcmtNb2RpZmllZChyb3cpIHsNCiAgICAgICAgICAgIGlmIChyb3cuX3N0YXR1cyA9PT0gJ25ldycpIHJldHVybjsNCg0KICAgICAgICAgICAgY29uc3Qgb3JpZ2luYWwgPSB0aGlzLm9yaWdpbmFsQ29sdW1ucy5maW5kKG8gPT4gby5DT0xVTU5fTkFNRSA9PT0gcm93Ll9vcmlnaW5hbE5hbWUpOw0KICAgICAgICAgICAgaWYgKCFvcmlnaW5hbCkgcmV0dXJuOw0KDQogICAgICAgICAgICBjb25zdCBpc0NoYW5nZWQgPQ0KICAgICAgICAgICAgICAgIHRoaXMuaXNEaWZmKHJvdy5DT0xVTU5fTkFNRSwgb3JpZ2luYWwuQ09MVU1OX05BTUUpIHx8DQogICAgICAgICAgICAgICAgdGhpcy5pc0RpZmYocm93LkRBVEFfVFlQRSwgb3JpZ2luYWwuREFUQV9UWVBFKSB8fA0KICAgICAgICAgICAgICAgIHRoaXMuaXNEaWZmKHJvdy5EQVRBX0xFTkdUSCwgb3JpZ2luYWwuREFUQV9MRU5HVEgpIHx8DQogICAgICAgICAgICAgICAgKHJvdy5JU19QSyAhPT0gb3JpZ2luYWwuSVNfUEspIHx8DQogICAgICAgICAgICAgICAgdGhpcy5pc0RpZmYocm93Lk5VTExBQkxFLCBvcmlnaW5hbC5OVUxMQUJMRSkgfHwNCiAgICAgICAgICAgICAgICB0aGlzLmlzRGlmZihyb3cuREFUQV9ERUZBVUxULCBvcmlnaW5hbC5EQVRBX0RFRkFVTFQpIHx8DQogICAgICAgICAgICAgICAgdGhpcy5pc0RpZmYocm93LkNPTU1FTlRTLCBvcmlnaW5hbC5DT01NRU5UUyk7DQoNCiAgICAgICAgICAgIHJvdy5fc3RhdHVzID0gaXNDaGFuZ2VkID8gJ21vZGlmaWVkJyA6ICdvcmlnaW5hbCc7DQogICAgICAgIH0sDQoNCiAgICAgICAgaGFuZGxlUGtDaGFuZ2Uocm93KSB7DQogICAgICAgICAgICB0aGlzLm1hcmtNb2RpZmllZChyb3cpOw0KICAgICAgICB9LA0KDQogICAgICAgIGFkZERlc2lnbkluZGV4KCkgeyB0aGlzLmRlc2lnbkluZGV4ZXMucHVzaCh7IElOREVYX05BTUU6ICcnLCBJTkRFWF9UWVBFOiAnTk9STUFMJywgQ09MVU1OUzogW10sIF9zdGF0dXM6ICduZXcnIH0pOyB9LA0KICAgICAgICByZW1vdmVEZXNpZ25JbmRleChpbmRleCwgcm93KSB7IGlmIChyb3cuX3N0YXR1cyAhPT0gJ25ldycpIHRoaXMuZGVsZXRlSW5kZXhMaXN0LnB1c2gocm93LklOREVYX05BTUUpOyB0aGlzLmRlc2lnbkluZGV4ZXMuc3BsaWNlKGluZGV4LCAxKTsgfSwNCg0KICAgICAgICBhZGREZXNpZ25GaygpIHsgdGhpcy5kZXNpZ25Gb3JlaWduS2V5cy5wdXNoKHsgQ09OU1RSQUlOVF9OQU1FOiAnJywgQ09MVU1OX05BTUU6ICcnLCBSX1RBQkxFX05BTUU6ICcnLCBSX0NPTFVNTl9OQU1FOiAnJywgREVMRVRFX1JVTEU6ICdOTyBBQ1RJT04nLCBfc3RhdHVzOiAnbmV3JyB9KTsgfSwNCiAgICAgICAgcmVtb3ZlRGVzaWduRmsoaW5kZXgsIHJvdykgeyBpZiAocm93Ll9zdGF0dXMgIT09ICduZXcnKSB0aGlzLmRlbGV0ZUZrTGlzdC5wdXNoKHJvdy5DT05TVFJBSU5UX05BTUUpOyB0aGlzLmRlc2lnbkZvcmVpZ25LZXlzLnNwbGljZShpbmRleCwgMSk7IH0sDQoNCiAgICAgICAgZ2VuZXJhdGVBbmRSdW5BbHRlcigpIHsNCiAgICAgICAgICAgIGxldCBzcWxzID0gW107IGNvbnN0IHMgPSB0aGlzLmN1cnJlbnRTY2hlbWE7IGNvbnN0IHQgPSB0aGlzLmFjdGl2ZVRhYmxlOw0KDQogICAgICAgICAgICBjb25zdCBuYW1lUmVnZXggPSAvXlthLXpBLVowLTlfXSskLzsNCiAgICAgICAgICAgIGZvciAoY29uc3QgYyBvZiB0aGlzLmRlc2lnbkNvbHVtbnMpIHsNCiAgICAgICAgICAgICAgICBpZiAoIW5hbWVSZWdleC50ZXN0KGMuQ09MVU1OX05BTUUpKSB7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoYOWIl+WQjSAiJHtjLkNPTFVNTl9OQU1FfSIg5LiN5ZCI5rOV77yM5LuF5pSv5oyB5a2X5q+N44CB5pWw5a2X5ZKM5LiL5YiS57q/44CCYCk7DQogICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHRoaXMuZGVsZXRlQ29sdW1uTGlzdC5mb3JFYWNoKGMgPT4gc3Fscy5wdXNoKGBBTFRFUiBUQUJMRSAiJHtzfSIuIiR7dH0iIERST1AgQ09MVU1OICIke2N9IjtgKSk7DQoNCiAgICAgICAgICAgIHRoaXMuZGVzaWduQ29sdW1ucy5maWx0ZXIoYyA9PiBjLl9zdGF0dXMgPT09ICdtb2RpZmllZCcpLmZvckVhY2goYyA9PiB7DQogICAgICAgICAgICAgICAgY29uc3Qgb3JpZ2luYWwgPSB0aGlzLm9yaWdpbmFsQ29sdW1ucy5maW5kKG8gPT4gby5DT0xVTU5fTkFNRSA9PT0gYy5fb3JpZ2luYWxOYW1lKTsNCiAgICAgICAgICAgICAgICBpZiAoIW9yaWdpbmFsKSByZXR1cm47DQoNCiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0RpZmYoYy5DT0xVTU5fTkFNRSwgYy5fb3JpZ2luYWxOYW1lKSkgew0KICAgICAgICAgICAgICAgICAgICBzcWxzLnB1c2goYEFMVEVSIFRBQkxFICIke3N9Ii4iJHt0fSIgUkVOQU1FIENPTFVNTiAiJHtjLl9vcmlnaW5hbE5hbWV9IiBUTyAiJHtjLkNPTFVNTl9OQU1FfSI7YCk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgbGV0IHR5cGVMZW4gPSBjLkRBVEFfVFlQRTsNCiAgICAgICAgICAgICAgICBpZiAoYy5EQVRBX0xFTkdUSCAmJiAhWydOVU1CRVInLCAnREFURScsICdUSU1FU1RBTVAnLCAnQ0xPQicsICdCTE9CJ10uaW5jbHVkZXMoYy5EQVRBX1RZUEUpKSB0eXBlTGVuICs9IGAoJHtjLkRBVEFfTEVOR1RIfSlgOw0KDQogICAgICAgICAgICAgICAgbGV0IG1vZGlmeVNxbCA9IGBBTFRFUiBUQUJMRSAiJHtzfSIuIiR7dH0iIE1PRElGWSAiJHtjLkNPTFVNTl9OQU1FfSIgJHt0eXBlTGVufWA7DQogICAgICAgICAgICAgICAgaWYgKGMuREFUQV9ERUZBVUxUICYmIHRoaXMuaXNEaWZmKGMuREFUQV9ERUZBVUxULCBvcmlnaW5hbC5EQVRBX0RFRkFVTFQpKSBtb2RpZnlTcWwgKz0gYCBERUZBVUxUICR7Yy5EQVRBX0RFRkFVTFR9YDsNCiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0RpZmYoYy5OVUxMQUJMRSwgb3JpZ2luYWwuTlVMTEFCTEUpKSBtb2RpZnlTcWwgKz0gKGMuTlVMTEFCTEUgPT09ICdOJyA/ICcgTk9UIE5VTEwnIDogJyBOVUxMJyk7DQoNCiAgICAgICAgICAgICAgICBjb25zdCBpc0F0dHJDaGFuZ2VkID0gdGhpcy5pc0RpZmYoYy5EQVRBX1RZUEUsIG9yaWdpbmFsLkRBVEFfVFlQRSkgfHwNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0RpZmYoYy5EQVRBX0xFTkdUSCwgb3JpZ2luYWwuREFUQV9MRU5HVEgpIHx8DQogICAgICAgICAgICAgICAgICAgIHRoaXMuaXNEaWZmKGMuTlVMTEFCTEUsIG9yaWdpbmFsLk5VTExBQkxFKSB8fA0KICAgICAgICAgICAgICAgICAgICB0aGlzLmlzRGlmZihjLkRBVEFfREVGQVVMVCwgb3JpZ2luYWwuREFUQV9ERUZBVUxUKTsNCg0KICAgICAgICAgICAgICAgIGlmIChpc0F0dHJDaGFuZ2VkKSBzcWxzLnB1c2gobW9kaWZ5U3FsICsgJzsnKTsNCg0KICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzRGlmZihjLkNPTU1FTlRTLCBvcmlnaW5hbC5DT01NRU5UUykpIHsNCiAgICAgICAgICAgICAgICAgICAgc3Fscy5wdXNoKGBDT01NRU5UIE9OIENPTFVNTiAiJHtzfSIuIiR7dH0iLiIke2MuQ09MVU1OX05BTUV9IiBJUyAnJHtjLkNPTU1FTlRTfSc7YCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgIGNvbnN0IG9sZFBrQ29scyA9IHRoaXMub3JpZ2luYWxDb2x1bW5zLmZpbHRlcihjID0+IFsnMScsIDEsICdZJywgdHJ1ZV0uaW5jbHVkZXMoYy5JU19QSykpLm1hcChjID0+IGMuQ09MVU1OX05BTUUpLnNvcnQoKTsNCiAgICAgICAgICAgIGNvbnN0IG5ld1BrQ29scyA9IHRoaXMuZGVzaWduQ29sdW1ucy5maWx0ZXIoYyA9PiBjLklTX1BLKS5tYXAoYyA9PiBjLkNPTFVNTl9OQU1FKS5zb3J0KCk7DQoNCiAgICAgICAgICAgIGNvbnN0IGlzUGtDaGFuZ2VkID0gSlNPTi5zdHJpbmdpZnkob2xkUGtDb2xzKSAhPT0gSlNPTi5zdHJpbmdpZnkobmV3UGtDb2xzKTsNCg0KICAgICAgICAgICAgaWYgKGlzUGtDaGFuZ2VkKSB7DQogICAgICAgICAgICAgICAgaWYgKG9sZFBrQ29scy5sZW5ndGggPiAwKSBzcWxzLnB1c2goYEFMVEVSIFRBQkxFICIke3N9Ii4iJHt0fSIgRFJPUCBQUklNQVJZIEtFWTtgKTsNCiAgICAgICAgICAgICAgICBpZiAobmV3UGtDb2xzLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgcGtMaXN0ID0gbmV3UGtDb2xzLm1hcChjID0+IGAiJHtjfSJgKS5qb2luKCcsJyk7DQogICAgICAgICAgICAgICAgICAgIHNxbHMucHVzaChgQUxURVIgVEFCTEUgIiR7c30iLiIke3R9IiBBREQgUFJJTUFSWSBLRVkgKCR7cGtMaXN0fSk7YCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB0aGlzLmRlc2lnbkNvbHVtbnMuZmlsdGVyKGMgPT4gYy5fc3RhdHVzID09PSAnbmV3JykuZm9yRWFjaChjID0+IHsNCiAgICAgICAgICAgICAgICBsZXQgbCA9IGBBTFRFUiBUQUJMRSAiJHtzfSIuIiR7dH0iIEFERCAiJHtjLkNPTFVNTl9OQU1FfSIgJHtjLkRBVEFfVFlQRX1gOw0KICAgICAgICAgICAgICAgIGlmIChjLkRBVEFfTEVOR1RIICYmICFbJ05VTUJFUicsICdEQVRFJywgJ1RJTUVTVEFNUCcsICdDTE9CJywgJ0JMT0InXS5pbmNsdWRlcyhjLkRBVEFfVFlQRSkpIGwgKz0gYCgke2MuREFUQV9MRU5HVEh9KWA7DQogICAgICAgICAgICAgICAgaWYgKGMuREFUQV9ERUZBVUxUKSBsICs9IGAgREVGQVVMVCAke2MuREFUQV9ERUZBVUxUfWA7DQogICAgICAgICAgICAgICAgaWYgKGMuTlVMTEFCTEUgPT09ICdOJykgbCArPSAnIE5PVCBOVUxMJzsNCiAgICAgICAgICAgICAgICBzcWxzLnB1c2gobCArICc7Jyk7DQogICAgICAgICAgICAgICAgaWYgKGMuQ09NTUVOVFMpIHNxbHMucHVzaChgQ09NTUVOVCBPTiBDT0xVTU4gIiR7c30iLiIke3R9Ii4iJHtjLkNPTFVNTl9OQU1FfSIgSVMgJyR7Yy5DT01NRU5UU30nO2ApOw0KICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgIHRoaXMuZGVsZXRlSW5kZXhMaXN0LmZvckVhY2goaWR4ID0+IHNxbHMucHVzaChgRFJPUCBJTkRFWCAiJHtzfSIuIiR7aWR4fSI7YCkpOw0KICAgICAgICAgICAgdGhpcy5kZXNpZ25JbmRleGVzLmZpbHRlcihpID0+IGkuX3N0YXR1cyA9PT0gJ25ldycpLmZvckVhY2goaSA9PiB7DQogICAgICAgICAgICAgICAgaWYgKCFpLklOREVYX05BTUUgfHwgaS5DT0xVTU5TLmxlbmd0aCA9PT0gMCkgcmV0dXJuOw0KICAgICAgICAgICAgICAgIGNvbnN0IGNvbHMgPSBpLkNPTFVNTlMubWFwKGMgPT4gYCIke2N9ImApLmpvaW4oJywnKTsNCiAgICAgICAgICAgICAgICBjb25zdCB1bmlxdWUgPSBpLklOREVYX1RZUEUgPT09ICdVTklRVUUnID8gJ1VOSVFVRScgOiAoaS5JTkRFWF9UWVBFID09PSAnQklUTUFQJyA/ICdCSVRNQVAnIDogJycpOw0KICAgICAgICAgICAgICAgIHNxbHMucHVzaChgQ1JFQVRFICR7dW5pcXVlfSBJTkRFWCAiJHtpLklOREVYX05BTUV9IiBPTiAiJHtzfSIuIiR7dH0iICgke2NvbHN9KTtgKTsNCiAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICB0aGlzLmRlbGV0ZUZrTGlzdC5mb3JFYWNoKGZrID0+IHNxbHMucHVzaChgQUxURVIgVEFCTEUgIiR7c30iLiIke3R9IiBEUk9QIENPTlNUUkFJTlQgIiR7Zmt9IjtgKSk7DQogICAgICAgICAgICB0aGlzLmRlc2lnbkZvcmVpZ25LZXlzLmZpbHRlcihmID0+IGYuX3N0YXR1cyA9PT0gJ25ldycpLmZvckVhY2goZiA9PiB7DQogICAgICAgICAgICAgICAgaWYgKCFmLkNPTlNUUkFJTlRfTkFNRSB8fCAhZi5DT0xVTU5fTkFNRSB8fCAhZi5SX1RBQkxFX05BTUUgfHwgIWYuUl9DT0xVTU5fTkFNRSkgcmV0dXJuOw0KICAgICAgICAgICAgICAgIGxldCBzcWwgPSBgQUxURVIgVEFCTEUgIiR7c30iLiIke3R9IiBBREQgQ09OU1RSQUlOVCAiJHtmLkNPTlNUUkFJTlRfTkFNRX0iIEZPUkVJR04gS0VZICgiJHtmLkNPTFVNTl9OQU1FfSIpIFJFRkVSRU5DRVMgIiR7c30iLiIke2YuUl9UQUJMRV9OQU1FfSIoIiR7Zi5SX0NPTFVNTl9OQU1FfSIpYDsNCiAgICAgICAgICAgICAgICBpZiAoZi5ERUxFVEVfUlVMRSA9PT0gJ0NBU0NBREUnKSBzcWwgKz0gJyBPTiBERUxFVEUgQ0FTQ0FERSc7DQogICAgICAgICAgICAgICAgZWxzZSBpZiAoZi5ERUxFVEVfUlVMRSA9PT0gJ1NFVCBOVUxMJykgc3FsICs9ICcgT04gREVMRVRFIFNFVCBOVUxMJzsNCiAgICAgICAgICAgICAgICBzcWxzLnB1c2goc3FsICsgJzsnKTsNCiAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICBpZiAoIXNxbHMubGVuZ3RoKSByZXR1cm4gdGhpcy4kbWVzc2FnZS5pbmZvKCfml6Dnu5PmnoTlj5jmm7QnKTsNCiAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGVkU3FsID0gc3Fscy5qb2luKCdcbicpOw0KICAgICAgICAgICAgdGhpcy5zcWxDb25maXJtVmlzaWJsZSA9IHRydWU7DQogICAgICAgIH0sDQoNCiAgICAgICAgYXN5bmMgZXhlY3V0ZUFsdGVyKCkgew0KICAgICAgICAgICAgdGhpcy5hbHRlcmluZyA9IHRydWU7DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgIGNvbnN0IHN0YXRlbWVudHMgPSB0aGlzLmdlbmVyYXRlZFNxbC5zcGxpdCgnOycpLm1hcChzID0+IHMudHJpbSgpKS5maWx0ZXIocyA9PiBzKTsNCiAgICAgICAgICAgICAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLnJlcXVlc3QoJ3Bvc3QnLCAnL2V4ZWN1dGUvYmF0Y2gnLCB7IHNxbHM6IHN0YXRlbWVudHMgfSk7DQogICAgICAgICAgICAgICAgaWYgKHJlcy5kYXRhLmNvZGUgPT09IDIwMCkgew0KICAgICAgICAgICAgICAgICAgICB0aGlzLiRtZXNzYWdlLnN1Y2Nlc3MoJ+S/ruaUueaIkOWKnycpOw0KICAgICAgICAgICAgICAgICAgICB0aGlzLnNxbENvbmZpcm1WaXNpYmxlID0gZmFsc2U7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuZGVzaWduVmlzaWJsZSA9IGZhbHNlOw0KDQogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnZpZXdNb2RlID09PSAncmVsYXRpb24nKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWRSZWxhdGlvbnMoKTsNCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9hZERhdGEoKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihyZXMuZGF0YS5tc2cpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZUVycm9yKGUsICfooajnu5PmnoTlj5jmm7TlpLHotKUnKTsNCiAgICAgICAgICAgIH0gZmluYWxseSB7IHRoaXMuYWx0ZXJpbmcgPSBmYWxzZTsgfQ0KICAgICAgICB9LA0KDQogICAgICAgIGluZGV4TWV0aG9kKGluZGV4KSB7IHJldHVybiAodGhpcy5jdXJyZW50UGFnZSAtIDEpICogdGhpcy5wYWdlU2l6ZSArIGluZGV4ICsgMTsgfSwNCiAgICAgICAgaGFuZGxlU29ydENoYW5nZSh7IHByb3AsIG9yZGVyIH0pIHsgaWYgKCFwcm9wKSByZXR1cm47IGNvbnN0IHNvcnRlZERhdGEgPSBbLi4udGhpcy5jdXJyZW50RGF0YUxpc3RdOyBzb3J0ZWREYXRhLnNvcnQoKGEsIGIpID0+IHsgbGV0IHZhbEEgPSBhW3Byb3BdOyBsZXQgdmFsQiA9IGJbcHJvcF07IGlmICh2YWxBID09IG51bGwpIHZhbEEgPSAnJzsgaWYgKHZhbEIgPT0gbnVsbCkgdmFsQiA9ICcnOyBpZiAodmFsQSA+IHZhbEIpIHJldHVybiBvcmRlciA9PT0gJ2FzY2VuZGluZycgPyAxIDogLTE7IGlmICh2YWxBIDwgdmFsQikgcmV0dXJuIG9yZGVyID09PSAnYXNjZW5kaW5nJyA/IC0xIDogMTsgcmV0dXJuIDA7IH0pOyB0aGlzLmN1cnJlbnREYXRhTGlzdCA9IHNvcnRlZERhdGE7IH0sDQogICAgICAgIGhhbmRsZVNpemVDaGFuZ2UodikgeyB0aGlzLnBhZ2VTaXplID0gdjsgdGhpcy5jdXJyZW50UGFnZSA9IDE7IHRoaXMubG9hZERhdGEoKTsgfSwNCiAgICAgICAgaGFuZGxlQ3VycmVudENoYW5nZSh2KSB7IHRoaXMuY3VycmVudFBhZ2UgPSB2OyB0aGlzLmxvYWREYXRhKCk7IH0sDQoNCiAgICAgICAgYXN5bmMgcnVuU3FsKCkgeyBjb25zdCByZXMgPSBhd2FpdCB0aGlzLnJlcXVlc3QoJ3Bvc3QnLCAnL2V4ZWN1dGUnLCB7IHNxbDogdGhpcy5jdXN0b21TcWwgfSk7IGlmIChyZXMuZGF0YS5jb2RlID09PSAyMDApIHRoaXMuc3FsUmVzdWx0ID0gcmVzLmRhdGEuZGF0YTsgfSwNCiAgICAgICAgZGVzdHJveUdyYXBoKCkgeyBpZiAodGhpcy5ncmFwaEluc3RhbmNlKSB7IHRoaXMuZ3JhcGhJbnN0YW5jZS5kZXN0cm95KCk7IHRoaXMuZ3JhcGhJbnN0YW5jZSA9IG51bGw7IH0gY29uc3QgYyA9IHRoaXMuJHJlZnMucmVsYXRpb25DYW52YXM7IGlmIChjKSBjLmlubmVySFRNTCA9ICcnOyB9LA0KDQogICAgICAgIGhhbmRsZVNob3dBbGxDaGFuZ2UodmFsKSB7DQogICAgICAgICAgICBpZiAodmFsKSB7DQogICAgICAgICAgICAgICAgaWYgKHRoaXMuZ3JhcGhOb2RlSWRzLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5leHBhbmRlZFRhYmxlTGlzdCA9IFsuLi50aGlzLmdyYXBoTm9kZUlkc107DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICB0aGlzLmV4cGFuZGVkVGFibGVMaXN0ID0gW107DQogICAgICAgICAgICB9DQogICAgICAgICAgICB0aGlzLmxvYWRSZWxhdGlvbnMoKTsNCiAgICAgICAgfSwNCg0KICAgICAgICBhc3luYyBsb2FkUmVsYXRpb25zKCkgew0KICAgICAgICAgICAgdGhpcy5kZXN0cm95R3JhcGgoKTsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5yZXF1ZXN0KCdnZXQnLCAnL2VyLWRhdGEnLCB7DQogICAgICAgICAgICAgICAgICAgIHNjaGVtYTogdGhpcy5jdXJyZW50U2NoZW1hLA0KICAgICAgICAgICAgICAgICAgICB0YWJsZU5hbWU6IHRoaXMuYWN0aXZlVGFibGUsDQogICAgICAgICAgICAgICAgICAgIHNob3dBbGw6IHRoaXMuc2hvd0FsbENvbHVtbnMsDQogICAgICAgICAgICAgICAgICAgIGV4cGFuZGVkVGFibGVzOiB0aGlzLmV4cGFuZGVkVGFibGVMaXN0LmpvaW4oJywnKQ0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIGlmICh0aGlzLnZpZXdNb2RlID09PSAncmVsYXRpb24nKSB7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuZ3JhcGhOb2RlSWRzID0gcmVzLmRhdGEuZGF0YS5ub2Rlcy5tYXAobiA9PiBuLmlkKTsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5jaGVja0F1dG9FeHBhbmRTdGF0ZSgpOw0KICAgICAgICAgICAgICAgICAgICB0aGlzLiRuZXh0VGljaygoKSA9PiB0aGlzLmluaXRHcmFwaChyZXMuZGF0YS5kYXRhKSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSBjYXRjaCAoZSkgeyB9DQogICAgICAgIH0sDQoNCiAgICAgICAgY2hlY2tBdXRvRXhwYW5kU3RhdGUoKSB7DQogICAgICAgICAgICBpZiAodGhpcy5ncmFwaE5vZGVJZHMubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgICAgIGNvbnN0IGFsbEV4cGFuZGVkID0gdGhpcy5ncmFwaE5vZGVJZHMuZXZlcnkoaWQgPT4gdGhpcy5leHBhbmRlZFRhYmxlTGlzdC5pbmNsdWRlcyhpZCkpOw0KICAgICAgICAgICAgICAgIGlmICh0aGlzLnNob3dBbGxDb2x1bW5zICE9PSBhbGxFeHBhbmRlZCkgew0KICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dBbGxDb2x1bW5zID0gYWxsRXhwYW5kZWQ7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9LA0KDQogICAgICAgIGhhbmRsZUdyYXBoWm9vbShyYXRpbykgew0KICAgICAgICAgICAgaWYgKCF0aGlzLmdyYXBoSW5zdGFuY2UpIHJldHVybjsNCiAgICAgICAgICAgIGNvbnN0IHpvb20gPSB0aGlzLmdyYXBoSW5zdGFuY2UuZ2V0Wm9vbSgpOw0KICAgICAgICAgICAgdGhpcy5ncmFwaEluc3RhbmNlLnpvb21Ubyh6b29tICogcmF0aW8sIHsgeDogdGhpcy4kcmVmcy5yZWxhdGlvbkNhbnZhcy5vZmZzZXRXaWR0aCAvIDIsIHk6IHRoaXMuJHJlZnMucmVsYXRpb25DYW52YXMub2Zmc2V0SGVpZ2h0IC8gMiB9KTsNCiAgICAgICAgfSwNCiAgICAgICAgaGFuZGxlR3JhcGhGaXQoKSB7DQogICAgICAgICAgICBpZiAoIXRoaXMuZ3JhcGhJbnN0YW5jZSkgcmV0dXJuOw0KICAgICAgICAgICAgdGhpcy5ncmFwaEluc3RhbmNlLmZpdFZpZXcoKTsNCiAgICAgICAgfSwNCg0KICAgICAgICBpbml0R3JhcGgoZGF0YSkgew0KICAgICAgICAgICAgY29uc3QgY29udGFpbmVyID0gdGhpcy4kcmVmcy5yZWxhdGlvbkNhbnZhczsgaWYgKCFjb250YWluZXIpIHJldHVybjsNCiAgICAgICAgICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSAnJzsNCg0KICAgICAgICAgICAgY29uc3Qgbm9kZUNvdW50ID0gZGF0YS5ub2Rlcy5sZW5ndGg7DQogICAgICAgICAgICBjb25zdCByYW5rc2VwID0gbm9kZUNvdW50ID4gNSA/IDE1MCA6IDEwMDsNCg0KICAgICAgICAgICAgdGhpcy5ncmFwaEluc3RhbmNlID0gbmV3IEc2LkdyYXBoKHsNCiAgICAgICAgICAgICAgICBjb250YWluZXIsDQogICAgICAgICAgICAgICAgd2lkdGg6IGNvbnRhaW5lci5vZmZzZXRXaWR0aCwNCiAgICAgICAgICAgICAgICBoZWlnaHQ6IGNvbnRhaW5lci5vZmZzZXRIZWlnaHQsDQogICAgICAgICAgICAgICAgZml0VmlldzogdHJ1ZSwNCiAgICAgICAgICAgICAgICBmaXRWaWV3UGFkZGluZzogNDAsDQogICAgICAgICAgICAgICAgcmVuZGVyZXI6ICdjYW52YXMnLA0KICAgICAgICAgICAgICAgIGxheW91dDogew0KICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZGFncmUnLA0KICAgICAgICAgICAgICAgICAgICByYW5rZGlyOiAnTFInLA0KICAgICAgICAgICAgICAgICAgICBub2Rlc2VwOiA1MCwNCiAgICAgICAgICAgICAgICAgICAgcmFua3NlcDogcmFua3NlcA0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgZGVmYXVsdE5vZGU6IHsNCiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2RiLXRhYmxlJywNCiAgICAgICAgICAgICAgICAgICAgYW5jaG9yUG9pbnRzOiBbWzAsIDAuNV0sIFsxLCAwLjVdXQ0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgZGVmYXVsdEVkZ2U6IHsNCiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2N1YmljLWhvcml6b250YWwnLA0KICAgICAgICAgICAgICAgICAgICBzdHlsZTogeyBzdHJva2U6ICcjQTNCMUJGJywgbGluZVdpZHRoOiAyLCBlbmRBcnJvdzogdHJ1ZSB9LA0KICAgICAgICAgICAgICAgICAgICBsYWJlbENmZzogeyBhdXRvUm90YXRlOiB0cnVlLCBzdHlsZTogeyBmb250U2l6ZTogMTAsIGZpbGw6ICcjYWFhJyB9IH0NCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIG1vZGVzOiB7IGRlZmF1bHQ6IFsnZHJhZy1jYW52YXMnLCAnem9vbS1jYW52YXMnLCAnZHJhZy1ub2RlJ10gfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB0aGlzLmdyYXBoSW5zdGFuY2UuZGF0YShKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGRhdGEpKSk7DQogICAgICAgICAgICB0aGlzLmdyYXBoSW5zdGFuY2UucmVuZGVyKCk7DQoNCiAgICAgICAgICAgIHRoaXMuZ3JhcGhJbnN0YW5jZS5vbignbm9kZTpjbGljaycsIChlKSA9PiB7DQogICAgICAgICAgICAgICAgY29uc3Qgc2hhcGVOYW1lID0gZS50YXJnZXQuZ2V0KCduYW1lJyk7DQogICAgICAgICAgICAgICAgY29uc3Qgbm9kZUlkID0gZS5pdGVtLmdldE1vZGVsKCkuaWQ7DQoNCiAgICAgICAgICAgICAgICBpZiAoc2hhcGVOYW1lID09PSAnZXhwYW5kLXRleHQnKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5leHBhbmRlZFRhYmxlTGlzdC5pbmNsdWRlcyhub2RlSWQpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmV4cGFuZGVkVGFibGVMaXN0LnB1c2gobm9kZUlkKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9hZFJlbGF0aW9ucygpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzaGFwZU5hbWUgPT09ICdjb2xsYXBzZS10ZXh0Jykgew0KICAgICAgICAgICAgICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMuZXhwYW5kZWRUYWJsZUxpc3QuaW5kZXhPZihub2RlSWQpOw0KICAgICAgICAgICAgICAgICAgICBpZiAoaW5kZXggPiAtMSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5leHBhbmRlZFRhYmxlTGlzdC5zcGxpY2UoaW5kZXgsIDEpOw0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93QWxsQ29sdW1ucyA9IGZhbHNlOw0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkUmVsYXRpb25zKCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgdGhpcy5ncmFwaEluc3RhbmNlLm9uKCdub2RlOmRibGNsaWNrJywgKGUpID0+IHsNCiAgICAgICAgICAgICAgICBjb25zdCB0ID0gZS5pdGVtLmdldE1vZGVsKCkubGFiZWw7DQogICAgICAgICAgICAgICAgaWYgKHQgIT09IHRoaXMuYWN0aXZlVGFibGUpIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy4kZW1pdCgnb3Blbi10YWJsZScsIHsgY29ubklkOiB0aGlzLmNvbm5JZCwgc2NoZW1hOiB0aGlzLmN1cnJlbnRTY2hlbWEsIHRhYmxlTmFtZTogdCwgaW5pdFZpZXdNb2RlOiAnZGF0YScgfSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICB9LA0KICAgIGJlZm9yZURlc3Ryb3koKSB7IHRoaXMuZGVzdHJveUdyYXBoKCk7IH0NCn07DQo="},{"version":3,"sources":["TableDetail.vue"],"names":[],"mappings":";AAuXA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"TableDetail.vue","sourceRoot":"src/components","sourcesContent":["<template>\r\n    <div class=\"table-detail-wrapper\">\r\n        <el-container class=\"main-workspace\">\r\n            <el-header height=\"50px\" class=\"workspace-header\">\r\n                <div class=\"header-left\">\r\n                    <el-breadcrumb separator=\"/\">\r\n                        <el-breadcrumb-item><i class=\"el-icon-connection\"></i> {{ connName }}</el-breadcrumb-item>\r\n                        <el-breadcrumb-item>{{ currentSchema }}</el-breadcrumb-item>\r\n                        <el-breadcrumb-item>\r\n                            <i v-if=\"tableType === 'view'\" class=\"el-icon-view\"\r\n                                style=\"color: #E6A23C; margin-right: 4px;\"></i>\r\n                            <i v-else class=\"el-icon-document-copy\" style=\"color: #409EFF; margin-right: 4px;\"></i>\r\n                            <b>{{ activeTable }}</b>\r\n                        </el-breadcrumb-item>\r\n                    </el-breadcrumb>\r\n                </div>\r\n                <div class=\"header-right\">\r\n                    <el-button-group style=\"margin-right: 15px\">\r\n                        <el-button size=\"small\" icon=\"el-icon-document\" @click=\"handleShowDDL\">查看DDL</el-button>\r\n                        <el-button v-if=\"tableType === 'table'\" size=\"small\" icon=\"el-icon-edit-outline\"\r\n                            @click=\"handleDesignTable\">设计表</el-button>\r\n                        <el-button v-else-if=\"tableType === 'view'\" size=\"small\" icon=\"el-icon-edit\"\r\n                            @click=\"handleEditView\">修改视图</el-button>\r\n                    </el-button-group>\r\n\r\n                    <el-radio-group v-model=\"viewMode\" size=\"small\" @change=\"handleViewModeSwitch\">\r\n                        <el-radio-button label=\"data\"><i class=\"el-icon-s-grid\"></i> 数据视图</el-radio-button>\r\n                        <el-radio-button label=\"relation\"><i class=\"el-icon-share\"></i> 关联关系</el-radio-button>\r\n                        <el-radio-button label=\"sql\"><i class=\"el-icon-cpu\"></i> SQL终端</el-radio-button>\r\n                    </el-radio-group>\r\n                </div>\r\n            </el-header>\r\n\r\n            <el-main class=\"content-area\">\r\n                <div v-if=\"viewMode === 'data'\" key=\"view-data\" class=\"full-height view-container\">\r\n                    <div class=\"filter-card\">\r\n                        <div class=\"compact-query-panel\">\r\n                            <div class=\"query-actions-top-bar\">\r\n                                <div class=\"left-btns\">\r\n                                    <span class=\"panel-title\"><i class=\"el-icon-search\"></i> 筛选条件</span>\r\n                                    <el-divider direction=\"vertical\"></el-divider>\r\n                                    <el-button type=\"text\" size=\"mini\" icon=\"el-icon-plus\"\r\n                                        @click=\"addCondition\">添加条件</el-button>\r\n                                    <template v-if=\"conditions.length > 1\">\r\n                                        <span class=\"v-divider\"></span>\r\n                                        <el-radio-group v-model=\"logicalOperator\" size=\"mini\">\r\n                                            <el-radio label=\"AND\">AND</el-radio>\r\n                                            <el-radio label=\"OR\">OR</el-radio>\r\n                                        </el-radio-group>\r\n                                    </template>\r\n                                </div>\r\n                                <div class=\"right-btns\">\r\n                                    <el-button type=\"primary\" size=\"mini\" icon=\"el-icon-search\" @click=\"handleQuery\"\r\n                                        :loading=\"loading\">查询</el-button>\r\n                                    <el-button size=\"mini\" icon=\"el-icon-refresh-left\"\r\n                                        @click=\"resetFilters\">重置</el-button>\r\n                                </div>\r\n                            </div>\r\n                            <div class=\"query-conditions-scroll-area\" v-if=\"conditions.length > 0\">\r\n                                <div class=\"query-grid\">\r\n                                    <div v-for=\"(cond, index) in conditions\" :key=\"index\" class=\"query-item\">\r\n                                        <span class=\"cond-index\">{{ index + 1 }}.</span>\r\n                                        <el-select v-model=\"cond.field\" placeholder=\"字段\" size=\"mini\" class=\"field-sel\"\r\n                                            filterable>\r\n                                            <el-option v-for=\"col in tableColumns\"\r\n                                                :key=\"col.COLUMN_NAME + '_' + (col.COMMENTS || '')\"\r\n                                                :label=\"col.COLUMN_NAME\" :value=\"col.COLUMN_NAME\">\r\n                                                <span style=\"float: left\">{{ col.COLUMN_NAME }}</span>\r\n                                                <span style=\"float: right; color: #8492a6; font-size: 12px\">{{\r\n                                                    col.COMMENTS }}</span>\r\n                                            </el-option>\r\n                                        </el-select>\r\n                                        <el-select v-model=\"cond.operator\" size=\"mini\" class=\"op-sel\">\r\n                                            <el-option label=\"=\" value=\"=\"></el-option>\r\n                                            <el-option label=\"LIKE\" value=\"LIKE\"></el-option>\r\n                                            <el-option label=\">\" value=\">\"></el-option>\r\n                                            <el-option label=\"<\" value=\"<\"></el-option>\r\n                                            <el-option label=\"IS NULL\" value=\"IS NULL\"></el-option>\r\n                                        </el-select>\r\n                                        <el-input v-if=\"!cond.operator.includes('NULL')\" v-model=\"cond.value\"\r\n                                            placeholder=\"值\" size=\"mini\" class=\"val-input\"\r\n                                            @keyup.enter.native=\"handleQuery\"></el-input>\r\n                                        <el-button type=\"text\" icon=\"el-icon-close\" class=\"cond-del\"\r\n                                            @click=\"removeCondition(index)\"></el-button>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div class=\"table-card\">\r\n                        <div class=\"data-toolbar\">\r\n                            <div class=\"tool-left\" v-if=\"!isReadOnly\">\r\n                                <el-button size=\"mini\" icon=\"el-icon-plus\" @click=\"handleAddRow\">插入行</el-button>\r\n                                <el-button size=\"mini\" type=\"success\" icon=\"el-icon-check\" @click=\"submitBatchChanges\"\r\n                                    :disabled=\"!hasChanges\" :loading=\"saving\">保存修改</el-button>\r\n                                <el-button size=\"mini\" icon=\"el-icon-close\" @click=\"handleDiscardChanges\"\r\n                                    :disabled=\"!hasChanges\">放弃修改</el-button>\r\n                                <el-divider direction=\"vertical\"></el-divider>\r\n                                <el-button size=\"mini\" type=\"danger\" icon=\"el-icon-delete\" @click=\"handleBatchDelete\"\r\n                                    :disabled=\"selectedRows.length === 0\" plain>批量删除</el-button>\r\n                                <el-divider direction=\"vertical\"></el-divider>\r\n                                <el-tag v-if=\"tableType === 'view'\" size=\"small\" type=\"success\" effect=\"plain\"\r\n                                    style=\"margin-right: 10px;\">\r\n                                    <i class=\"el-icon-check\"></i> 简单视图 (可编辑)\r\n                                </el-tag>\r\n                                <el-button size=\"mini\" icon=\"el-icon-refresh\" @click=\"loadData\">刷新</el-button>\r\n                            </div>\r\n                            <div class=\"tool-left\" v-else>\r\n                                <el-tag size=\"small\" type=\"warning\" effect=\"plain\" style=\"margin-right: 10px;\">\r\n                                    <i class=\"el-icon-lock\"></i> 复杂视图 (只读)\r\n                                </el-tag>\r\n                                <el-button size=\"mini\" icon=\"el-icon-refresh\" @click=\"loadData\">刷新数据</el-button>\r\n                            </div>\r\n\r\n                            <div class=\"data-stats\">\r\n                                <span v-if=\"selectedRows.length > 0\" style=\"color: #409EFF; margin-right: 15px;\">已选 {{\r\n                                    selectedRows.length\r\n                                    }} 行</span>\r\n                                <span v-if=\"hasChanges\" style=\"color: #E6A23C; margin-right: 10px;\"><i\r\n                                        class=\"el-icon-warning\"></i>\r\n                                    有未保存的更改</span>\r\n                                <i class=\"el-icon-info\"></i> 共 <b>{{ totalCount }}</b> 条记录\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div class=\"table-wrapper\" v-loading=\"loading\">\r\n                            <el-table ref=\"dataTable\" :data=\"currentDataList\" border height=\"100%\" size=\"mini\" stripe\r\n                                class=\"custom-table\" highlight-current-row @sort-change=\"handleSortChange\"\r\n                                @selection-change=\"handleSelectionChange\" @cell-dblclick=\"handleCellDblClick\"\r\n                                :cell-style=\"getCellStyle\">\r\n                                <el-table-column type=\"selection\" width=\"45\" align=\"center\"\r\n                                    fixed=\"left\"></el-table-column>\r\n                                <el-table-column type=\"index\" width=\"55\" align=\"center\" fixed=\"left\" label=\"#\"\r\n                                    :index=\"indexMethod\"></el-table-column>\r\n                                <template v-if=\"tableColumns.length > 0\">\r\n                                    <el-table-column v-for=\"col in tableColumns\"\r\n                                        :key=\"col.COLUMN_NAME + '_' + (col.COMMENTS || '')\" :prop=\"col.COLUMN_NAME\"\r\n                                        min-width=\"150\" show-overflow-tooltip sortable=\"custom\">\r\n                                        <template slot=\"header\" slot-scope=\"scope\">\r\n                                            <div class=\"custom-header\">\r\n                                                <div class=\"col-name\">\r\n                                                    <i v-if=\"col.IS_PK == 1\" class=\"el-icon-key\"\r\n                                                        style=\"color:#E6A23C;margin-right:2px;\" title=\"主键\"></i>\r\n                                                    {{ col.COLUMN_NAME }}\r\n                                                </div>\r\n                                                <div v-if=\"col.COMMENTS\" class=\"col-comment\">{{ col.COMMENTS }}</div>\r\n                                            </div>\r\n                                        </template>\r\n                                        <template slot-scope=\"scope\">\r\n                                            <div v-if=\"!isReadOnly && isCellEditing(scope.row, col.COLUMN_NAME)\"\r\n                                                class=\"inline-input-box\">\r\n                                                <el-input v-model=\"scope.row[col.COLUMN_NAME]\" size=\"mini\"\r\n                                                    @blur=\"finishEditing(scope.row, col.COLUMN_NAME)\"\r\n                                                    @keyup.enter.native=\"$event.target.blur()\"></el-input>\r\n                                            </div>\r\n                                            <span v-else>{{ scope.row[col.COLUMN_NAME] }}</span>\r\n                                        </template>\r\n                                    </el-table-column>\r\n                                </template>\r\n\r\n                                <el-table-column v-if=\"!isReadOnly\" label=\"操作\" width=\"80\" fixed=\"right\" align=\"center\">\r\n                                    <template slot-scope=\"scope\">\r\n                                        <el-button type=\"text\" size=\"mini\" icon=\"el-icon-delete\" class=\"danger-text\"\r\n                                            @click=\"handleDeleteRow(scope.$index, scope.row)\"></el-button>\r\n                                    </template>\r\n                                </el-table-column>\r\n                            </el-table>\r\n                        </div>\r\n\r\n                        <div class=\"pagination-bar\">\r\n                            <el-pagination @size-change=\"handleSizeChange\" @current-change=\"handleCurrentChange\"\r\n                                :current-page=\"currentPage\" :page-sizes=\"[20, 50, 100]\" :page-size=\"pageSize\"\r\n                                layout=\"total, sizes, prev, pager, next, jumper\" :total=\"totalCount\"></el-pagination>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <div v-else-if=\"viewMode === 'relation'\" key=\"view-relation\"\r\n                    class=\"relation-view-container view-container\">\r\n                    <div class=\"relation-toolbar\">\r\n                        <div class=\"legend-box\">\r\n                            <span class=\"legend-item\"><span class=\"dot active\"></span> 当前表</span>\r\n                            <span class=\"legend-item\"><span class=\"dot normal\"></span> 关联表</span>\r\n                            <el-divider direction=\"vertical\"></el-divider>\r\n                            <el-switch v-model=\"showAllColumns\" active-text=\"全部展开\" @change=\"handleShowAllChange\"\r\n                                size=\"mini\"></el-switch>\r\n                        </div>\r\n                        <div class=\"zoom-btns\">\r\n                            <el-button-group>\r\n                                <el-button size=\"mini\" icon=\"el-icon-zoom-in\" @click=\"handleGraphZoom(1.1)\"></el-button>\r\n                                <el-button size=\"mini\" icon=\"el-icon-zoom-out\"\r\n                                    @click=\"handleGraphZoom(0.9)\"></el-button>\r\n                                <el-button size=\"mini\" icon=\"el-icon-aim\" @click=\"handleGraphFit\"></el-button>\r\n                            </el-button-group>\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"canvas-wrapper\">\r\n                        <div ref=\"relationCanvas\" class=\"g6-canvas-box\"></div>\r\n                    </div>\r\n                </div>\r\n\r\n                <div v-else-if=\"viewMode === 'sql'\" key=\"view-sql\" class=\"full-height view-container\">\r\n                    <div class=\"sql-box\"\r\n                        style=\"height: 300px; padding: 0; border: 1px solid #dcdfe6; overflow: hidden; display: flex; flex-direction: column;\">\r\n                        <SqlEditor v-model=\"customSql\" language=\"sql\" style=\"flex: 1; width: 100%;\" />\r\n                    </div>\r\n                    <div style=\"text-align: right; padding: 10px 0;\"><el-button type=\"success\" size=\"small\"\r\n                            @click=\"runSql\" icon=\"el-icon-video-play\">执行 SQL</el-button></div>\r\n                    <div class=\"sql-result\" v-if=\"sqlResult.length\">\r\n                        <el-divider content-position=\"left\">结果预览</el-divider>\r\n                        <el-table :data=\"sqlResult\" border height=\"100%\" size=\"mini\" stripe><el-table-column\r\n                                v-for=\"(val, key) in sqlResult[0]\" :key=\"key\" :prop=\"key\" :label=\"key\"\r\n                                show-overflow-tooltip></el-table-column></el-table>\r\n                    </div>\r\n                </div>\r\n            </el-main>\r\n        </el-container>\r\n\r\n        <el-dialog title=\"编辑视图定义\" :visible.sync=\"editViewVisible\" width=\"900px\" append-to-body\r\n            :close-on-click-modal=\"false\">\r\n            <div style=\"margin-bottom: 10px;\">\r\n                <el-alert title=\"修改视图定义将执行 CREATE OR REPLACE VIEW 语句。\" type=\"warning\" show-icon\r\n                    :closable=\"false\"></el-alert>\r\n            </div>\r\n            <div style=\"height: 450px; border: 1px solid #dcdfe6;\">\r\n                <SqlEditor v-model=\"viewSql\" language=\"sql\" />\r\n            </div>\r\n            <div slot=\"footer\">\r\n                <el-button @click=\"editViewVisible = false\">取消</el-button>\r\n                <el-button type=\"primary\" @click=\"submitViewAlter\" :loading=\"altering\">保存修改</el-button>\r\n            </div>\r\n        </el-dialog>\r\n\r\n        <el-dialog :title=\"conflictTitle\" :visible.sync=\"conflictVisible\" width=\"750px\" append-to-body\r\n            :close-on-click-modal=\"false\">\r\n            <div class=\"conflict-alert\"\r\n                :style=\"{ backgroundColor: isParentMissing ? '#fef0f0' : '#fdf6ec', color: isParentMissing ? '#F56C6C' : '#e6a23c', borderColor: isParentMissing ? '#fde2e2' : '#faecd8' }\">\r\n                <i class=\"el-icon-warning\" style=\"margin-right: 8px;\"></i>\r\n                {{ conflictMessage }}\r\n            </div>\r\n            <el-table :data=\"conflictList\" border size=\"small\" style=\"margin-top: 15px;\">\r\n                <el-table-column :label=\"isParentMissing ? '目标主表名' : '引用表名'\" width=\"220\" prop=\"TABLE_NAME\">\r\n                    <template slot-scope=\"scope\"><el-tag size=\"mini\" type=\"info\">{{ scope.row.TABLE_NAME\r\n                            }}</el-tag></template>\r\n                </el-table-column>\r\n                <el-table-column :label=\"isParentMissing ? '目标主键列' : '关联字段'\" width=\"180\"\r\n                    prop=\"COLUMN_NAME\"></el-table-column>\r\n                <el-table-column :label=\"isParentMissing ? '状态' : '冲突记录数'\" align=\"center\" width=\"120\">\r\n                    <template slot-scope=\"scope\">\r\n                        <span v-if=\"scope.row.CNT === 'MISSING'\" style=\"color:#F56C6C;font-weight:bold;\">主键缺失</span>\r\n                        <span v-else style=\"color:#F56C6C;font-weight:bold;\">{{ scope.row.CNT }}</span>\r\n                    </template>\r\n                </el-table-column>\r\n                <el-table-column label=\"操作\" align=\"center\">\r\n                    <template slot-scope=\"scope\">\r\n                        <el-button type=\"primary\" plain size=\"mini\" @click=\"resolveConflict(scope.row)\">\r\n                            去处理 <i class=\"el-icon-right\"></i>\r\n                        </el-button>\r\n                    </template>\r\n                </el-table-column>\r\n            </el-table>\r\n            <div slot=\"footer\"><el-button @click=\"conflictVisible = false\">关闭</el-button></div>\r\n        </el-dialog>\r\n\r\n        <el-dialog title=\"DDL 预览\" :visible.sync=\"ddlVisible\" width=\"800px\" append-to-body>\r\n            <div style=\"height: 500px; border: 1px solid #dcdfe6;\">\r\n                <SqlEditor v-model=\"currentDDL\" :readOnly=\"true\" />\r\n            </div>\r\n            <div slot=\"footer\"><el-button @click=\"ddlVisible = false\">关闭</el-button></div>\r\n        </el-dialog>\r\n\r\n        <el-dialog title=\"设计表结构\" :visible.sync=\"designVisible\" width=\"1100px\" append-to-body\r\n            :close-on-click-modal=\"false\" top=\"5vh\">\r\n            <div style=\"margin-bottom: 10px;\"><el-alert title=\"注意：修改结构会生成 ALTER TABLE 语句。请谨慎操作。\" type=\"warning\"\r\n                    show-icon :closable=\"false\"></el-alert></div>\r\n            <el-tabs v-model=\"designActiveTab\" type=\"card\">\r\n                <el-tab-pane label=\"字段列 (Columns)\" name=\"columns\">\r\n                    <div style=\"margin-bottom: 10px; text-align: right;\"><el-button size=\"mini\" type=\"primary\"\r\n                            icon=\"el-icon-plus\" @click=\"addDesignColumn\">添加列</el-button></div>\r\n                    <el-table :data=\"designColumns\" border size=\"mini\" height=\"400\">\r\n                        <el-table-column label=\"状态\" width=\"50\" align=\"center\"><template slot-scope=\"scope\"><i\r\n                                    v-if=\"scope.row._status === 'new'\" class=\"el-icon-plus\" style=\"color:green\"></i><i\r\n                                    v-else-if=\"scope.row._status === 'modified'\" class=\"el-icon-edit\"\r\n                                    style=\"color:orange\"></i></template></el-table-column>\r\n                        <el-table-column label=\"列名\" width=\"150\"><template slot-scope=\"scope\"><el-input\r\n                                    v-model=\"scope.row.COLUMN_NAME\" @change=\"markModified(scope.row)\"\r\n                                    size=\"mini\"></el-input></template></el-table-column>\r\n                        <el-table-column label=\"类型\" width=\"120\"><template slot-scope=\"scope\"><el-select\r\n                                    v-model=\"scope.row.DATA_TYPE\" @change=\"markModified(scope.row)\" size=\"mini\"\r\n                                    filterable allow-create><el-option value=\"VARCHAR2\"></el-option><el-option\r\n                                        value=\"NUMBER\"></el-option><el-option\r\n                                        value=\"DATE\"></el-option></el-select></template></el-table-column>\r\n                        <el-table-column label=\"长度\" width=\"100\"><template slot-scope=\"scope\"><el-input\r\n                                    v-model=\"scope.row.DATA_LENGTH\" @change=\"markModified(scope.row)\"\r\n                                    size=\"mini\"></el-input></template></el-table-column>\r\n                        <el-table-column label=\"主键\" width=\"50\"><template slot-scope=\"scope\"><el-checkbox\r\n                                    v-model=\"scope.row.IS_PK\"\r\n                                    @change=\"handlePkChange(scope.row)\"></el-checkbox></template></el-table-column>\r\n                        <el-table-column label=\"空值\" width=\"50\"><template slot-scope=\"scope\"><el-checkbox\r\n                                    v-model=\"scope.row.NULLABLE\" @change=\"markModified(scope.row)\" true-label=\"Y\"\r\n                                    false-label=\"N\"></el-checkbox></template></el-table-column>\r\n                        <el-table-column label=\"注释\"><template slot-scope=\"scope\"><el-input v-model=\"scope.row.COMMENTS\"\r\n                                    @change=\"markModified(scope.row)\"\r\n                                    size=\"mini\"></el-input></template></el-table-column>\r\n                        <el-table-column label=\"操作\"><template slot-scope=\"scope\"><el-button type=\"text\"\r\n                                    style=\"color:#F56C6C\" icon=\"el-icon-delete\"\r\n                                    @click=\"removeDesignColumn(scope.$index, scope.row)\"></el-button></template></el-table-column>\r\n                    </el-table>\r\n                </el-tab-pane>\r\n                <el-tab-pane label=\"索引 (Indexes)\" name=\"indexes\">\r\n                    <div style=\"margin-bottom: 10px; text-align: right;\"><el-button size=\"mini\" type=\"primary\"\r\n                            icon=\"el-icon-plus\" @click=\"addDesignIndex\">添加索引</el-button></div>\r\n                    <el-table :data=\"designIndexes\" border size=\"mini\" height=\"400\">\r\n                        <el-table-column label=\"状态\" width=\"50\" align=\"center\"><template slot-scope=\"scope\"><i\r\n                                    v-if=\"scope.row._status === 'new'\" class=\"el-icon-plus\"\r\n                                    style=\"color:green\"></i></template></el-table-column>\r\n                        <el-table-column label=\"索引名称\" width=\"200\"><template slot-scope=\"scope\"><el-input\r\n                                    v-model=\"scope.row.INDEX_NAME\" size=\"mini\"></el-input></template></el-table-column>\r\n                        <el-table-column label=\"包含列\"><template slot-scope=\"scope\"><el-select v-model=\"scope.row.COLUMNS\"\r\n                                    multiple size=\"mini\" style=\"width: 100%\"><el-option v-for=\"c in designColumns\"\r\n                                        :key=\"c.COLUMN_NAME\" :label=\"c.COLUMN_NAME\"\r\n                                        :value=\"c.COLUMN_NAME\"></el-option></el-select></template></el-table-column>\r\n                        <el-table-column label=\"操作\" width=\"60\" align=\"center\"><template slot-scope=\"scope\"><el-button\r\n                                    type=\"text\" style=\"color:#F56C6C\" icon=\"el-icon-delete\"\r\n                                    @click=\"removeDesignIndex(scope.$index, scope.row)\"></el-button></template></el-table-column>\r\n                    </el-table>\r\n                </el-tab-pane>\r\n                <el-tab-pane label=\"外键 (Foreign Keys)\" name=\"fks\">\r\n                    <div style=\"margin-bottom: 10px; text-align: right;\"><el-button size=\"mini\" type=\"primary\"\r\n                            icon=\"el-icon-plus\" @click=\"addDesignFk\">添加外键</el-button></div>\r\n                    <el-table :data=\"designForeignKeys\" border size=\"mini\" height=\"400\">\r\n                        <el-table-column label=\"状态\" width=\"50\" align=\"center\"><template slot-scope=\"scope\"><i\r\n                                    v-if=\"scope.row._status === 'new'\" class=\"el-icon-plus\"\r\n                                    style=\"color:green\"></i></template></el-table-column>\r\n                        <el-table-column label=\"外键名称\" width=\"180\"><template slot-scope=\"scope\"><el-input\r\n                                    v-model=\"scope.row.CONSTRAINT_NAME\"\r\n                                    size=\"mini\"></el-input></template></el-table-column>\r\n                        <el-table-column label=\"本表字段\" width=\"150\"><template slot-scope=\"scope\"><el-select\r\n                                    v-model=\"scope.row.COLUMN_NAME\" size=\"mini\"><el-option v-for=\"c in designColumns\"\r\n                                        :key=\"c.COLUMN_NAME\" :label=\"c.COLUMN_NAME\"\r\n                                        :value=\"c.COLUMN_NAME\"></el-option></el-select></template></el-table-column>\r\n                        <el-table-column label=\"关联主表\" width=\"180\"><template slot-scope=\"scope\"><el-select\r\n                                    v-model=\"scope.row.R_TABLE_NAME\" size=\"mini\" allow-create\r\n                                    @change=\"handleRefTableChange(scope.row)\"><el-option v-for=\"t in allTableNames\"\r\n                                        :key=\"t\" :label=\"t\"\r\n                                        :value=\"t\"></el-option></el-select></template></el-table-column>\r\n                        <el-table-column label=\"目标列\" width=\"150\"><template slot-scope=\"scope\"><el-select\r\n                                    v-model=\"scope.row.R_COLUMN_NAME\" size=\"mini\"\r\n                                    @visible-change=\"(vis) => vis && loadRefColumns(scope.row.R_TABLE_NAME)\"><el-option\r\n                                        v-for=\"col in (refColumnsCache[scope.row.R_TABLE_NAME] || [])\"\r\n                                        :key=\"col.COLUMN_NAME\" :label=\"col.COLUMN_NAME\"\r\n                                        :value=\"col.COLUMN_NAME\"></el-option></el-select></template></el-table-column>\r\n                        <el-table-column label=\"操作\" width=\"60\" align=\"center\"><template slot-scope=\"scope\"><el-button\r\n                                    type=\"text\" style=\"color:#F56C6C\" icon=\"el-icon-delete\"\r\n                                    @click=\"removeDesignFk(scope.$index, scope.row)\"></el-button></template></el-table-column>\r\n                    </el-table>\r\n                </el-tab-pane>\r\n            </el-tabs>\r\n            <div slot=\"footer\"><el-button @click=\"designVisible = false\">取消</el-button><el-button type=\"primary\"\r\n                    @click=\"generateAndRunAlter\">预览并保存</el-button></div>\r\n        </el-dialog>\r\n\r\n        <el-dialog title=\"确认修改\" :visible.sync=\"sqlConfirmVisible\" width=\"600px\" append-to-body>\r\n            <div style=\"margin-bottom:10px;\">即将执行以下变更语句：</div>\r\n            <div style=\"height: 300px; border: 1px solid #dcdfe6;\">\r\n                <SqlEditor v-model=\"generatedSql\" />\r\n            </div>\r\n            <div slot=\"footer\"><el-button @click=\"sqlConfirmVisible = false\">取消</el-button><el-button type=\"primary\"\r\n                    @click=\"executeAlter\" :loading=\"altering\">确认执行</el-button></div>\r\n        </el-dialog>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport request from '@/utils/request';\r\nimport G6 from '@antv/g6';\r\nimport SqlEditor from './SqlEditor.vue';\r\n\r\n// G6 logic remains same\r\nG6.registerNode('db-table', {\r\n    draw: (cfg, group) => {\r\n        const { label, tableComment, columns = [], isCenter, isTruncated, totalColCount } = cfg;\r\n        const width = 300;\r\n        const headerHeight = 50;\r\n        const rowHeight = 28;\r\n        const contentHeight = columns.length * rowHeight;\r\n\r\n        let footerHeight = 0;\r\n        if (isTruncated) footerHeight = 24;\r\n        else if (totalColCount > 10) footerHeight = 24;\r\n\r\n        const height = headerHeight + contentHeight + footerHeight + 8;\r\n\r\n        group.addShape('rect', { attrs: { x: 0, y: 0, width, height, fill: '#fff', stroke: isCenter ? '#409EFF' : '#DCDFE6', lineWidth: 1, radius: 4 }, name: 'container-shape' });\r\n        group.addShape('rect', { attrs: { x: 0, y: 0, width, height: headerHeight, fill: isCenter ? '#409EFF' : '#F2F6FC', radius: [4, 4, 0, 0] }, name: 'header-shape' });\r\n\r\n        group.addShape('text', { attrs: { x: 10, y: 20, text: label, fill: isCenter ? '#fff' : '#333', fontSize: 13, fontWeight: 'bold', textBaseline: 'middle' }, name: 'title-text' });\r\n        if (tableComment) {\r\n            group.addShape('text', { attrs: { x: 10, y: 38, text: tableComment, fill: isCenter ? '#eee' : '#909399', fontSize: 11, textBaseline: 'middle' }, name: 'comment-text' });\r\n        }\r\n\r\n        columns.forEach((col, i) => {\r\n            const y = headerHeight + (i * rowHeight) + (rowHeight / 2);\r\n            group.addShape('text', { attrs: { x: 28, y: y, text: col.COLUMN_NAME, fill: col.IS_PK ? '#E6A23C' : '#333', fontSize: 12, textBaseline: 'middle', fontWeight: col.IS_PK ? 'bold' : 'normal' } });\r\n            if (col.IS_PK) {\r\n                group.addShape('circle', { attrs: { x: 14, y: y, r: 3, fill: '#E6A23C' } });\r\n            }\r\n            if (col.COMMENTS) {\r\n                let comment = col.COMMENTS;\r\n                if (comment.length > 10) comment = comment.substring(0, 10) + '...';\r\n                group.addShape('text', { attrs: { x: 160, y: y, text: comment, fill: '#909399', fontSize: 11, textBaseline: 'middle' } });\r\n            }\r\n        });\r\n\r\n        const y = headerHeight + contentHeight + 12;\r\n        if (isTruncated) {\r\n            group.addShape('text', { attrs: { x: width / 2, y: y, text: `... (共 ${totalColCount} 列，点击展开)`, fill: '#909399', fontSize: 11, textAlign: 'center', textBaseline: 'middle', cursor: 'pointer' }, name: 'expand-text' });\r\n        } else if (totalColCount > 10) {\r\n            group.addShape('text', { attrs: { x: width / 2, y: y, text: '⬆ 点击折叠', fill: '#409EFF', fontSize: 11, textAlign: 'center', textBaseline: 'middle', cursor: 'pointer' }, name: 'collapse-text' });\r\n        }\r\n\r\n        return group.get('children')[0];\r\n    }\r\n});\r\n\r\nexport default {\r\n    name: 'TableDetail',\r\n    components: { SqlEditor },\r\n    props: ['connId', 'connName', 'schema', 'tableName', 'initialFilter', 'initViewMode', 'tableType'],\r\n    data() {\r\n        return {\r\n            currentSchema: this.schema, activeTable: this.tableName,\r\n            viewMode: this.initViewMode || 'data',\r\n            loading: false, saving: false,\r\n            currentDataList: [], totalCount: 0, currentPage: 1, pageSize: 50,\r\n            editingCell: null, originalDataMap: {}, modifiedRows: new Set(), newRows: [],\r\n            tableColumns: [], conditions: [], logicalOperator: 'AND',\r\n            conflictVisible: false, conflictList: [], conflictPkValue: null, conflictType: 'delete',\r\n            customSql: '', sqlResult: [],\r\n            ddlVisible: false, currentDDL: '',\r\n\r\n            editViewVisible: false, viewSql: '',\r\n            isSimpleView: true,\r\n\r\n            // 标记是否从冲突跳转\r\n            jumpFromConflict: false,\r\n\r\n            // 【新增】选中的行\r\n            selectedRows: [],\r\n\r\n            designVisible: false, designActiveTab: 'columns',\r\n            designColumns: [], originalColumns: [], deleteColumnList: [],\r\n            designIndexes: [], deleteIndexList: [],\r\n            designForeignKeys: [], deleteFkList: [],\r\n            allTableNames: [], refColumnsCache: {},\r\n\r\n            showAllColumns: false, expandedTableList: [], graphNodeIds: [],\r\n            sqlConfirmVisible: false, generatedSql: '', altering: false\r\n        };\r\n    },\r\n\r\n    computed: {\r\n        rawKeys() { return this.currentDataList.length ? Object.keys(this.currentDataList[0]).filter(k => k !== 'DB_INTERNAL_ID') : []; },\r\n        hasChanges() { return this.modifiedRows.size > 0 || this.newRows.length > 0; },\r\n        isReadOnly() {\r\n            if (this.tableType === 'table') return false;\r\n            if (this.tableType === 'view') return !this.isSimpleView;\r\n            return true;\r\n        },\r\n        isParentMissing() {\r\n            return this.conflictList.length > 0 && this.conflictList[0].CNT === 'MISSING';\r\n        },\r\n        conflictTitle() {\r\n            if (this.isParentMissing) return '⚠️ 保存失败：目标主键缺失';\r\n            return this.conflictType === 'delete' ? '⚠️ 无法删除：存在关联引用' : '⚠️ 无法修改：存在关联引用';\r\n        },\r\n        conflictMessage() {\r\n            if (this.isParentMissing) return '您输入的 外键值 在目标主表中不存在。请先在主表中创建该数据，或修改为已存在的值。';\r\n            return `该记录被以下 ${this.conflictList.length} 张表引用，请先处理这些关联数据。`;\r\n        }\r\n    },\r\n\r\n    mounted() { this.initView(); },\r\n\r\n    watch: {\r\n        initialFilter: {\r\n            immediate: true, deep: true,\r\n            handler(val) {\r\n                if (val && val.field && val.value !== undefined) {\r\n                    if (this.viewMode !== 'data') this.handleViewModeSwitch('data');\r\n                    // 标记从外部跳转\r\n                    this.jumpFromConflict = true;\r\n                    this.applyAutoFilter(val);\r\n                }\r\n            }\r\n        },\r\n        tableName: {\r\n            immediate: true,\r\n            handler(val) {\r\n                if (val) {\r\n                    this.activeTable = val;\r\n                    this.currentSchema = this.schema;\r\n                    this.currentPage = 1;\r\n                    this.expandedTableList = [];\r\n                    this.showAllColumns = false;\r\n                    this.selectedRows = []; // 清空选中\r\n\r\n                    // 如果有跳转条件，跳过普通加载\r\n                    if (this.initialFilter && this.initialFilter.field) {\r\n                        return;\r\n                    }\r\n                    this.loadData();\r\n                }\r\n            }\r\n        },\r\n        initViewMode(val) { if (val && val !== this.viewMode) this.handleViewModeSwitch(val); },\r\n    },\r\n\r\n    methods: {\r\n        async request(method, url, dataOrParams = {}) {\r\n            const config = { method, url, headers: { 'Conn-Id': this.connId } };\r\n            if (!url.startsWith('/db')) url = '/db' + url;\r\n            config.url = url;\r\n            if (method === 'get' || method === 'delete') config.params = dataOrParams; else config.data = dataOrParams;\r\n            return request(config);\r\n        },\r\n\r\n        handleError(e, title = '操作失败') {\r\n            let rawMsg = e.response?.data?.msg || e.response?.data?.message || e.message || '未知错误';\r\n            if (rawMsg.includes('nested exception is')) rawMsg = rawMsg.split('nested exception is').pop();\r\n            rawMsg = rawMsg.replace(/[\\w\\.]*Exception:\\s*/g, '').trim();\r\n            if (rawMsg.length > 300) rawMsg = rawMsg.substring(0, 300) + '...';\r\n            this.$alert(`<div style=\"font-size: 14px; line-height: 1.5; color: #606266;\"><p style=\"font-weight: bold; color: #F56C6C;\">❌ ${title}：</p><p style=\"background: #fef0f0; padding: 8px; border-radius: 4px; margin: 5px 0; word-break: break-all;\">${rawMsg}</p></div>`, title, { dangerouslyUseHTMLString: true, confirmButtonText: '知道了', type: 'error', customClass: 'error-dialog-width' });\r\n        },\r\n\r\n        initView() {\r\n            this.destroyGraph();\r\n            if (this.viewMode === 'relation') this.loadRelations();\r\n            else if (this.viewMode === 'data') {\r\n                if (!this.initialFilter || !this.initialFilter.field) this.loadData();\r\n            }\r\n        },\r\n\r\n        handleViewModeSwitch(val) {\r\n            if (this.hasChanges) {\r\n                this.$confirm('当前有未保存的修改，切换视图将丢失这些修改，是否继续？', '提示', { type: 'warning' })\r\n                    .then(() => { this.resetEditState(); this._doSwitch(val); })\r\n                    .catch(() => { this.viewMode = 'data'; });\r\n            } else { this._doSwitch(val); }\r\n        },\r\n\r\n        _doSwitch(val) {\r\n            const mode = (typeof val === 'string') ? val : this.viewMode;\r\n            this.viewMode = mode;\r\n            this.$emit('view-mode-change', mode);\r\n            if (mode === 'relation') this.$nextTick(() => { this.loadRelations(); });\r\n            else { this.destroyGraph(); if (mode === 'data') this.loadData(); }\r\n        },\r\n\r\n        async loadData() {\r\n            this.resetEditState();\r\n            this.selectedRows = [];\r\n            this.loading = true;\r\n            try {\r\n                const colRes = await this.request('get', '/columns', { schema: this.currentSchema, tableName: this.activeTable });\r\n                this.tableColumns = colRes.data.data || [];\r\n                let list = []; let total = 0;\r\n                const params = { schema: this.currentSchema, tableName: this.activeTable, page: this.currentPage, size: this.pageSize };\r\n                if (this.conditions.length > 0) {\r\n                    const filterRes = await this.request('post', '/filter', { ...params, logic: this.logicalOperator, conditions: this.conditions });\r\n                    list = filterRes.data.data.list || []; total = filterRes.data.data.total || 0; if (filterRes.data.data.isView) { this.isSimpleView = filterRes.data.data.isSimpleView; }\r\n                } else {\r\n                    const dataRes = await this.request('get', '/data', params);\r\n                    list = dataRes.data.data.list || []; total = dataRes.data.data.total || 0; if (dataRes.data.data.isView) { this.isSimpleView = dataRes.data.data.isSimpleView; }\r\n                }\r\n                this.currentDataList = list; this.totalCount = total; this.originalDataMap = {}; list.forEach(row => { if (row.DB_INTERNAL_ID) this.originalDataMap[row.DB_INTERNAL_ID] = JSON.parse(JSON.stringify(row)); });\r\n\r\n                // 【核心优化】从冲突跳转来且无数据 -> 批量自动插入\r\n                if (this.jumpFromConflict && this.totalCount === 0) {\r\n                    this.jumpFromConflict = false;\r\n                    this.$nextTick(() => {\r\n                        // 遍历所有过滤条件，如果存在多个 OR 条件，生成多行\r\n                        if (this.conditions.length > 0 && this.logicalOperator === 'OR') {\r\n                            let addedCount = 0;\r\n                            this.conditions.forEach(cond => {\r\n                                if (cond.operator === '=' && cond.value) {\r\n                                    this.handleAddRow(cond.value, cond.field);\r\n                                    addedCount++;\r\n                                }\r\n                            });\r\n                            if (addedCount > 0) {\r\n                                this.$message({ message: `已为您批量创建 ${addedCount} 条新行并填入缺失的主键，请补充其他信息。`, type: 'success', duration: 6000, showClose: true });\r\n                            }\r\n                        } else {\r\n                            // 单条件情况\r\n                            this.handleAddRow();\r\n                            this.$message({ message: '未找到指定主键记录，已自动为您创建新行并填入主键，请补充其他信息。', type: 'success', duration: 5000, showClose: true });\r\n                        }\r\n                    });\r\n                } else if (this.totalCount > 0) {\r\n                    this.jumpFromConflict = false;\r\n                }\r\n            } catch (e) { this.handleError(e, '数据加载失败'); } finally { this.loading = false; }\r\n        },\r\n\r\n        async handleEditView() {\r\n            try {\r\n                const res = await this.request('get', '/ddl', { schema: this.currentSchema, tableName: this.activeTable });\r\n                let rawDDL = res.data.data || '';\r\n                this.viewSql = rawDDL.replace(/&quot;/g, '\"').replace(/&apos;/g, \"'\").replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/&amp;/g, '&');\r\n                this.editViewVisible = true;\r\n            } catch (e) { this.handleError(e, '获取视图定义失败'); }\r\n        },\r\n\r\n        async submitViewAlter() {\r\n            this.altering = true;\r\n            try {\r\n                const res = await this.request('post', '/execute', { sql: this.viewSql });\r\n                if (res.data.code === 200) {\r\n                    this.$message.success('视图修改成功');\r\n                    this.editViewVisible = false;\r\n                    this.loadData();\r\n                } else {\r\n                    throw new Error(res.data.msg);\r\n                }\r\n            } catch (e) {\r\n                this.handleError(e, '修改视图失败');\r\n            } finally {\r\n                this.altering = false;\r\n            }\r\n        },\r\n\r\n        resetEditState() { this.editingCell = null; this.modifiedRows = new Set(); this.newRows = []; },\r\n        handleDiscardChanges() { this.resetEditState(); this.loadData(); },\r\n        handleCellDblClick(row, column) {\r\n            if (this.isReadOnly) return;\r\n            this.editingCell = { rowId: row.DB_INTERNAL_ID || row._tempId, col: column.property };\r\n            this.$nextTick(() => { const inputs = document.getElementsByTagName('input'); if (inputs && inputs.length > 0) inputs[inputs.length - 1].focus(); });\r\n        },\r\n        isCellEditing(row, colName) { if (!this.editingCell) return false; const id = row.DB_INTERNAL_ID || row._tempId; return this.editingCell.rowId === id && this.editingCell.col === colName; },\r\n        finishEditing(row, colName) { this.editingCell = null; const id = row.DB_INTERNAL_ID; if (!id) return; const originalRow = this.originalDataMap[id]; let newVal = row[colName]; let oldVal = originalRow ? originalRow[colName] : ''; if (newVal == null) newVal = ''; if (oldVal == null) oldVal = ''; if (String(newVal) !== String(oldVal)) { this.modifiedRows.add(id); this.modifiedRows = new Set(this.modifiedRows); } },\r\n        getCellStyle({ row, column }) { const id = row.DB_INTERNAL_ID; const col = column.property; if (!id && row._tempId) return { backgroundColor: '#f0f9eb' }; if (this.modifiedRows.has(id)) { const original = this.originalDataMap[id]; let newVal = row[col]; let oldVal = original ? original[col] : ''; if (newVal == null) newVal = ''; if (oldVal == null) oldVal = ''; if (String(newVal) !== String(oldVal)) return { backgroundColor: '#fdf6ec', color: '#E6A23C', fontWeight: 'bold' }; } return {}; },\r\n\r\n        // 【核心修改】支持参数化填充\r\n        handleAddRow(prefillValue = null, prefillField = null) {\r\n            const newRow = { _tempId: 'NEW_' + Date.now() + Math.random().toString(36).substr(2, 5) };\r\n            this.tableColumns.forEach(c => newRow[c.COLUMN_NAME] = null);\r\n\r\n            // 优先使用传入的填充值\r\n            if (prefillValue !== null && prefillField) {\r\n                newRow[prefillField] = prefillValue;\r\n            }\r\n            // 否则使用当前的筛选条件 (单条件)\r\n            else if (this.conditions.length === 1 && this.conditions[0].operator === '=') {\r\n                const fieldName = this.conditions[0].field;\r\n                const val = this.conditions[0].value;\r\n                const matchKey = Object.keys(newRow).find(k => k.toUpperCase() === fieldName.toUpperCase());\r\n                if (matchKey && val !== undefined && val !== null) {\r\n                    newRow[matchKey] = val;\r\n                }\r\n            }\r\n            this.currentDataList.unshift(newRow);\r\n            this.newRows.push(newRow);\r\n        },\r\n\r\n        getPkColumnName() {\r\n            const pkCol = this.tableColumns.find(c => ['1', 1, 'Y', true].includes(c.IS_PK));\r\n            if (pkCol) return pkCol.COLUMN_NAME;\r\n            const idCol = this.tableColumns.find(c => c.COLUMN_NAME.toUpperCase() === 'ID');\r\n            if (idCol) return idCol.COLUMN_NAME;\r\n            if (this.tableColumns.length > 0) return this.tableColumns[0].COLUMN_NAME;\r\n            return null;\r\n        },\r\n        getCleanRowData(row) { const cleanData = {}; this.tableColumns.forEach(col => { cleanData[col.COLUMN_NAME] = row[col.COLUMN_NAME]; }); if (row.DB_INTERNAL_ID) cleanData.DB_INTERNAL_ID = row.DB_INTERNAL_ID; return cleanData; },\r\n\r\n        async submitBatchChanges() {\r\n            if (this.saving) return;\r\n            this.saving = true;\r\n\r\n            const insertList = this.newRows.map(row => {\r\n                const clean = this.getCleanRowData(row);\r\n                delete clean.DB_INTERNAL_ID;\r\n                return clean;\r\n            });\r\n\r\n            const updateList = Array.from(this.modifiedRows).map(id => {\r\n                const row = this.currentDataList.find(r => r.DB_INTERNAL_ID === id);\r\n                return row ? this.getCleanRowData(row) : null;\r\n            }).filter(r => r !== null);\r\n\r\n            if (insertList.length === 0 && updateList.length === 0) {\r\n                this.$message.info(\"没有检测到有效变更\");\r\n                this.saving = false;\r\n                return;\r\n            }\r\n\r\n            const loadingInstance = this.$loading({ lock: true, text: '正在批量保存中...', background: 'rgba(0, 0, 0, 0.7)' });\r\n\r\n            try {\r\n                const res = await this.request('post', `/save/batch?schema=${this.currentSchema}&tableName=${this.activeTable}`, {\r\n                    insertList,\r\n                    updateList\r\n                });\r\n\r\n                loadingInstance.close();\r\n\r\n                if (res.data.code === 200) {\r\n                    this.$message.success('批量保存成功！');\r\n                    this.loadData();\r\n                } else if (res.data.code === 503) {\r\n                    this.conflictList = res.data.data;\r\n                    this.conflictType = 'save';\r\n                    this.conflictVisible = true;\r\n                } else {\r\n                    throw new Error(res.data.msg);\r\n                }\r\n            } catch (e) {\r\n                loadingInstance.close();\r\n                this.handleError(e, '保存失败');\r\n            } finally {\r\n                this.saving = false;\r\n            }\r\n        },\r\n\r\n        handleDeleteRow(index, row) {\r\n            if (!row.DB_INTERNAL_ID) { this.currentDataList.splice(index, 1); const idx = this.newRows.indexOf(row); if (idx > -1) this.newRows.splice(idx, 1); }\r\n            else {\r\n                this.$confirm('确定删除该行数据吗?', '提示', { type: 'warning' }).then(async () => {\r\n                    const pkName = this.getPkColumnName(); const pkVal = pkName ? row[pkName] : null;\r\n                    const res = await this.request('delete', '/delete', { schema: this.currentSchema, tableName: this.activeTable, internalId: row.DB_INTERNAL_ID, pkValue: pkVal });\r\n                    if (res.data.code === 200) { this.$message.success('删除成功'); this.loadData(); }\r\n                    else if (res.data.code === 503) { this.conflictList = res.data.data; this.conflictPkValue = pkVal; this.conflictType = 'delete'; this.conflictVisible = true; }\r\n                    else { throw new Error(res.data.msg); }\r\n                }).catch((e) => {\r\n                    if (e !== 'cancel') this.handleError({ message: e.message || '删除失败' }, '删除失败');\r\n                });\r\n            }\r\n        },\r\n\r\n        // 【新增】选区变更\r\n        handleSelectionChange(val) {\r\n            this.selectedRows = val;\r\n        },\r\n\r\n        // 【新增】批量删除方法\r\n        async handleBatchDelete() {\r\n            if (this.selectedRows.length === 0) return;\r\n            const existRowsToDelete = this.selectedRows.filter(row => row.DB_INTERNAL_ID).map(row => row.DB_INTERNAL_ID);\r\n            const newRowsToDelete = this.selectedRows.filter(row => !row.DB_INTERNAL_ID);\r\n\r\n            this.$confirm(`确定要删除选中的 ${this.selectedRows.length} 条数据吗？`, '批量删除', { type: 'warning' }).then(async () => {\r\n                // 1. 先删本地新行\r\n                newRowsToDelete.forEach(row => {\r\n                    const idx = this.currentDataList.indexOf(row);\r\n                    if (idx > -1) this.currentDataList.splice(idx, 1);\r\n                    const nIdx = this.newRows.indexOf(row);\r\n                    if (nIdx > -1) this.newRows.splice(nIdx, 1);\r\n                });\r\n\r\n                // 2. 再调后端删持久化行\r\n                if (existRowsToDelete.length > 0) {\r\n                    const loadingInstance = this.$loading({ lock: true, text: '正在批量删除...', background: 'rgba(0,0,0,0.7)' });\r\n                    try {\r\n                        const res = await this.request('post', `/delete/batch?schema=${this.currentSchema}&tableName=${this.activeTable}`, existRowsToDelete);\r\n                        loadingInstance.close();\r\n\r\n                        if (res.data.code === 200) {\r\n                            this.$message.success('批量删除成功');\r\n                            this.loadData();\r\n                        } else if (res.data.code === 503) {\r\n                            this.conflictList = res.data.data;\r\n                            this.conflictType = 'delete';\r\n                            this.conflictVisible = true;\r\n                        } else {\r\n                            throw new Error(res.data.msg);\r\n                        }\r\n                    } catch (e) {\r\n                        loadingInstance.close();\r\n                        this.handleError(e, '批量删除失败');\r\n                    }\r\n                } else {\r\n                    this.$message.success('删除成功');\r\n                }\r\n            }).catch(() => { });\r\n        },\r\n\r\n        addCondition() { if (this.tableColumns.length > 0) this.conditions.push({ field: this.tableColumns[0].COLUMN_NAME, operator: '=', value: '' }); },\r\n        removeCondition(index) { this.conditions.splice(index, 1); },\r\n        handleQuery() { this.currentPage = 1; this.loadData(); },\r\n        resetFilters() { this.conditions = []; this.handleQuery(); },\r\n        // 【核心修复】自动筛选：支持多值 (OR)\r\n        applyAutoFilter(filter) {\r\n            if (Array.isArray(filter.value)) {\r\n                this.conditions = filter.value.map(v => ({\r\n                    field: filter.field,\r\n                    operator: '=',\r\n                    value: v\r\n                }));\r\n                this.logicalOperator = 'OR';\r\n            } else {\r\n                this.conditions = [{ field: filter.field, operator: '=', value: filter.value }];\r\n            }\r\n            this.$nextTick(() => { this.handleQuery(); });\r\n        },\r\n\r\n        // 【核心修复】处理聚合冲突列表\r\n        resolveConflict(row) {\r\n            this.conflictVisible = false;\r\n\r\n            // 优先使用聚合值列表\r\n            let filterValue = [];\r\n            if (row.MY_VAL_LIST && row.MY_VAL_LIST.length > 0) {\r\n                filterValue = row.MY_VAL_LIST;\r\n            } else if (row.MY_VAL !== undefined && row.MY_VAL !== null) {\r\n                filterValue = [row.MY_VAL];\r\n            } else if (this.conflictPkValue) {\r\n                filterValue = [this.conflictPkValue];\r\n            }\r\n\r\n            this.$emit('open-table', {\r\n                connId: this.connId,\r\n                schema: this.currentSchema,\r\n                tableName: row.TABLE_NAME,\r\n                initViewMode: 'data',\r\n                filter: {\r\n                    field: row.COLUMN_NAME,\r\n                    value: filterValue // 传数组\r\n                }\r\n            });\r\n        },\r\n        async handleShowDDL() {\r\n            try {\r\n                const res = await this.request('get', '/ddl', { schema: this.currentSchema, tableName: this.activeTable });\r\n                let rawDDL = res.data.data || '';\r\n                this.currentDDL = rawDDL.replace(/&quot;/g, '\"').replace(/&apos;/g, \"'\").replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/&amp;/g, '&');\r\n                this.ddlVisible = true;\r\n            } catch (e) { this.handleError(e, '获取DDL失败'); }\r\n        },\r\n\r\n        // ... Design table related methods (omitted for brevity, keep as is) ...\r\n        async handleDesignTable() {\r\n            try {\r\n                const colRes = await this.request('get', '/columns', { schema: this.currentSchema, tableName: this.activeTable });\r\n                const cols = colRes.data.data;\r\n                this.originalColumns = JSON.parse(JSON.stringify(cols.map(c => ({\r\n                    ...c,\r\n                    DATA_LENGTH: c.DATA_LENGTH ? String(c.DATA_LENGTH) : '',\r\n                    COMMENTS: c.COMMENTS || '',\r\n                    DATA_DEFAULT: c.DATA_DEFAULT || '',\r\n                    IS_PK: ['1', 1, 'Y', 'y', 'true', true].includes(c.IS_PK)\r\n                }))));\r\n\r\n                this.designColumns = JSON.parse(JSON.stringify(this.originalColumns)).map(c => ({ ...c, _status: 'original', _originalName: c.COLUMN_NAME }));\r\n\r\n                try {\r\n                    const idxRes = await this.request('get', '/indexes', { schema: this.currentSchema, tableName: this.activeTable });\r\n                    if (idxRes.data.code === 200) {\r\n                        this.designIndexes = idxRes.data.data.map(i => ({ ...i, _status: 'original', COLUMNS: i.COLUMNS.split(',') }));\r\n                    }\r\n                } catch (e) { this.designIndexes = []; }\r\n\r\n                try {\r\n                    const fkRes = await this.request('get', '/foreign-keys', { schema: this.currentSchema, tableName: this.activeTable });\r\n                    if (fkRes.data.code === 200) {\r\n                        this.designForeignKeys = fkRes.data.data.map(f => ({ ...f, _status: 'original' }));\r\n                        const refTables = [...new Set(this.designForeignKeys.map(f => f.R_TABLE_NAME).filter(t => t))];\r\n                        refTables.forEach(t => this.loadRefColumns(t));\r\n                    }\r\n                } catch (e) { this.designForeignKeys = []; }\r\n\r\n                const tablesRes = await this.request('get', '/tables', { schema: this.currentSchema });\r\n                this.allTableNames = (tablesRes.data.data || []).map(t => t.TABLE_NAME);\r\n\r\n                this.deleteColumnList = [];\r\n                this.deleteIndexList = [];\r\n                this.deleteFkList = [];\r\n                this.designActiveTab = 'columns';\r\n                this.designVisible = true;\r\n            } catch (e) { this.handleError(e, '加载设计器失败'); }\r\n        },\r\n\r\n        async loadRefColumns(tableName) {\r\n            if (!tableName || this.refColumnsCache[tableName]) return;\r\n            try {\r\n                const res = await this.request('get', '/columns', { schema: this.currentSchema, tableName: tableName });\r\n                this.$set(this.refColumnsCache, tableName, res.data.data || []);\r\n            } catch (e) {\r\n                console.error(\"加载引用表列失败\", e);\r\n            }\r\n        },\r\n\r\n        handleRefTableChange(row) {\r\n            row.R_COLUMN_NAME = '';\r\n            if (row.R_TABLE_NAME) {\r\n                this.loadRefColumns(row.R_TABLE_NAME);\r\n            }\r\n        },\r\n\r\n        isDiff(newVal, oldVal) {\r\n            const n = (newVal === null || newVal === undefined) ? \"\" : String(newVal).trim();\r\n            const o = (oldVal === null || oldVal === undefined) ? \"\" : String(oldVal).trim();\r\n            return n !== o;\r\n        },\r\n\r\n        addDesignColumn() { this.designColumns.push({ COLUMN_NAME: 'NEW_COL', DATA_TYPE: 'VARCHAR2', DATA_LENGTH: '50', NULLABLE: 'Y', IS_PK: false, _status: 'new' }); },\r\n\r\n        removeDesignColumn(index, row) { if (row._status !== 'new') this.deleteColumnList.push(row.COLUMN_NAME); this.designColumns.splice(index, 1); },\r\n\r\n        markModified(row) {\r\n            if (row._status === 'new') return;\r\n\r\n            const original = this.originalColumns.find(o => o.COLUMN_NAME === row._originalName);\r\n            if (!original) return;\r\n\r\n            const isChanged =\r\n                this.isDiff(row.COLUMN_NAME, original.COLUMN_NAME) ||\r\n                this.isDiff(row.DATA_TYPE, original.DATA_TYPE) ||\r\n                this.isDiff(row.DATA_LENGTH, original.DATA_LENGTH) ||\r\n                (row.IS_PK !== original.IS_PK) ||\r\n                this.isDiff(row.NULLABLE, original.NULLABLE) ||\r\n                this.isDiff(row.DATA_DEFAULT, original.DATA_DEFAULT) ||\r\n                this.isDiff(row.COMMENTS, original.COMMENTS);\r\n\r\n            row._status = isChanged ? 'modified' : 'original';\r\n        },\r\n\r\n        handlePkChange(row) {\r\n            this.markModified(row);\r\n        },\r\n\r\n        addDesignIndex() { this.designIndexes.push({ INDEX_NAME: '', INDEX_TYPE: 'NORMAL', COLUMNS: [], _status: 'new' }); },\r\n        removeDesignIndex(index, row) { if (row._status !== 'new') this.deleteIndexList.push(row.INDEX_NAME); this.designIndexes.splice(index, 1); },\r\n\r\n        addDesignFk() { this.designForeignKeys.push({ CONSTRAINT_NAME: '', COLUMN_NAME: '', R_TABLE_NAME: '', R_COLUMN_NAME: '', DELETE_RULE: 'NO ACTION', _status: 'new' }); },\r\n        removeDesignFk(index, row) { if (row._status !== 'new') this.deleteFkList.push(row.CONSTRAINT_NAME); this.designForeignKeys.splice(index, 1); },\r\n\r\n        generateAndRunAlter() {\r\n            let sqls = []; const s = this.currentSchema; const t = this.activeTable;\r\n\r\n            const nameRegex = /^[a-zA-Z0-9_]+$/;\r\n            for (const c of this.designColumns) {\r\n                if (!nameRegex.test(c.COLUMN_NAME)) {\r\n                    this.$message.error(`列名 \"${c.COLUMN_NAME}\" 不合法，仅支持字母、数字和下划线。`);\r\n                    return;\r\n                }\r\n            }\r\n\r\n            this.deleteColumnList.forEach(c => sqls.push(`ALTER TABLE \"${s}\".\"${t}\" DROP COLUMN \"${c}\";`));\r\n\r\n            this.designColumns.filter(c => c._status === 'modified').forEach(c => {\r\n                const original = this.originalColumns.find(o => o.COLUMN_NAME === c._originalName);\r\n                if (!original) return;\r\n\r\n                if (this.isDiff(c.COLUMN_NAME, c._originalName)) {\r\n                    sqls.push(`ALTER TABLE \"${s}\".\"${t}\" RENAME COLUMN \"${c._originalName}\" TO \"${c.COLUMN_NAME}\";`);\r\n                }\r\n\r\n                let typeLen = c.DATA_TYPE;\r\n                if (c.DATA_LENGTH && !['NUMBER', 'DATE', 'TIMESTAMP', 'CLOB', 'BLOB'].includes(c.DATA_TYPE)) typeLen += `(${c.DATA_LENGTH})`;\r\n\r\n                let modifySql = `ALTER TABLE \"${s}\".\"${t}\" MODIFY \"${c.COLUMN_NAME}\" ${typeLen}`;\r\n                if (c.DATA_DEFAULT && this.isDiff(c.DATA_DEFAULT, original.DATA_DEFAULT)) modifySql += ` DEFAULT ${c.DATA_DEFAULT}`;\r\n                if (this.isDiff(c.NULLABLE, original.NULLABLE)) modifySql += (c.NULLABLE === 'N' ? ' NOT NULL' : ' NULL');\r\n\r\n                const isAttrChanged = this.isDiff(c.DATA_TYPE, original.DATA_TYPE) ||\r\n                    this.isDiff(c.DATA_LENGTH, original.DATA_LENGTH) ||\r\n                    this.isDiff(c.NULLABLE, original.NULLABLE) ||\r\n                    this.isDiff(c.DATA_DEFAULT, original.DATA_DEFAULT);\r\n\r\n                if (isAttrChanged) sqls.push(modifySql + ';');\r\n\r\n                if (this.isDiff(c.COMMENTS, original.COMMENTS)) {\r\n                    sqls.push(`COMMENT ON COLUMN \"${s}\".\"${t}\".\"${c.COLUMN_NAME}\" IS '${c.COMMENTS}';`);\r\n                }\r\n            });\r\n\r\n            const oldPkCols = this.originalColumns.filter(c => ['1', 1, 'Y', true].includes(c.IS_PK)).map(c => c.COLUMN_NAME).sort();\r\n            const newPkCols = this.designColumns.filter(c => c.IS_PK).map(c => c.COLUMN_NAME).sort();\r\n\r\n            const isPkChanged = JSON.stringify(oldPkCols) !== JSON.stringify(newPkCols);\r\n\r\n            if (isPkChanged) {\r\n                if (oldPkCols.length > 0) sqls.push(`ALTER TABLE \"${s}\".\"${t}\" DROP PRIMARY KEY;`);\r\n                if (newPkCols.length > 0) {\r\n                    const pkList = newPkCols.map(c => `\"${c}\"`).join(',');\r\n                    sqls.push(`ALTER TABLE \"${s}\".\"${t}\" ADD PRIMARY KEY (${pkList});`);\r\n                }\r\n            }\r\n\r\n            this.designColumns.filter(c => c._status === 'new').forEach(c => {\r\n                let l = `ALTER TABLE \"${s}\".\"${t}\" ADD \"${c.COLUMN_NAME}\" ${c.DATA_TYPE}`;\r\n                if (c.DATA_LENGTH && !['NUMBER', 'DATE', 'TIMESTAMP', 'CLOB', 'BLOB'].includes(c.DATA_TYPE)) l += `(${c.DATA_LENGTH})`;\r\n                if (c.DATA_DEFAULT) l += ` DEFAULT ${c.DATA_DEFAULT}`;\r\n                if (c.NULLABLE === 'N') l += ' NOT NULL';\r\n                sqls.push(l + ';');\r\n                if (c.COMMENTS) sqls.push(`COMMENT ON COLUMN \"${s}\".\"${t}\".\"${c.COLUMN_NAME}\" IS '${c.COMMENTS}';`);\r\n            });\r\n\r\n            this.deleteIndexList.forEach(idx => sqls.push(`DROP INDEX \"${s}\".\"${idx}\";`));\r\n            this.designIndexes.filter(i => i._status === 'new').forEach(i => {\r\n                if (!i.INDEX_NAME || i.COLUMNS.length === 0) return;\r\n                const cols = i.COLUMNS.map(c => `\"${c}\"`).join(',');\r\n                const unique = i.INDEX_TYPE === 'UNIQUE' ? 'UNIQUE' : (i.INDEX_TYPE === 'BITMAP' ? 'BITMAP' : '');\r\n                sqls.push(`CREATE ${unique} INDEX \"${i.INDEX_NAME}\" ON \"${s}\".\"${t}\" (${cols});`);\r\n            });\r\n\r\n            this.deleteFkList.forEach(fk => sqls.push(`ALTER TABLE \"${s}\".\"${t}\" DROP CONSTRAINT \"${fk}\";`));\r\n            this.designForeignKeys.filter(f => f._status === 'new').forEach(f => {\r\n                if (!f.CONSTRAINT_NAME || !f.COLUMN_NAME || !f.R_TABLE_NAME || !f.R_COLUMN_NAME) return;\r\n                let sql = `ALTER TABLE \"${s}\".\"${t}\" ADD CONSTRAINT \"${f.CONSTRAINT_NAME}\" FOREIGN KEY (\"${f.COLUMN_NAME}\") REFERENCES \"${s}\".\"${f.R_TABLE_NAME}\"(\"${f.R_COLUMN_NAME}\")`;\r\n                if (f.DELETE_RULE === 'CASCADE') sql += ' ON DELETE CASCADE';\r\n                else if (f.DELETE_RULE === 'SET NULL') sql += ' ON DELETE SET NULL';\r\n                sqls.push(sql + ';');\r\n            });\r\n\r\n            if (!sqls.length) return this.$message.info('无结构变更');\r\n            this.generatedSql = sqls.join('\\n');\r\n            this.sqlConfirmVisible = true;\r\n        },\r\n\r\n        async executeAlter() {\r\n            this.altering = true;\r\n            try {\r\n                const statements = this.generatedSql.split(';').map(s => s.trim()).filter(s => s);\r\n                const res = await this.request('post', '/execute/batch', { sqls: statements });\r\n                if (res.data.code === 200) {\r\n                    this.$message.success('修改成功');\r\n                    this.sqlConfirmVisible = false;\r\n                    this.designVisible = false;\r\n\r\n                    if (this.viewMode === 'relation') {\r\n                        this.loadRelations();\r\n                    } else {\r\n                        this.loadData();\r\n                    }\r\n                } else {\r\n                    throw new Error(res.data.msg);\r\n                }\r\n            } catch (e) {\r\n                this.handleError(e, '表结构变更失败');\r\n            } finally { this.altering = false; }\r\n        },\r\n\r\n        indexMethod(index) { return (this.currentPage - 1) * this.pageSize + index + 1; },\r\n        handleSortChange({ prop, order }) { if (!prop) return; const sortedData = [...this.currentDataList]; sortedData.sort((a, b) => { let valA = a[prop]; let valB = b[prop]; if (valA == null) valA = ''; if (valB == null) valB = ''; if (valA > valB) return order === 'ascending' ? 1 : -1; if (valA < valB) return order === 'ascending' ? -1 : 1; return 0; }); this.currentDataList = sortedData; },\r\n        handleSizeChange(v) { this.pageSize = v; this.currentPage = 1; this.loadData(); },\r\n        handleCurrentChange(v) { this.currentPage = v; this.loadData(); },\r\n\r\n        async runSql() { const res = await this.request('post', '/execute', { sql: this.customSql }); if (res.data.code === 200) this.sqlResult = res.data.data; },\r\n        destroyGraph() { if (this.graphInstance) { this.graphInstance.destroy(); this.graphInstance = null; } const c = this.$refs.relationCanvas; if (c) c.innerHTML = ''; },\r\n\r\n        handleShowAllChange(val) {\r\n            if (val) {\r\n                if (this.graphNodeIds.length > 0) {\r\n                    this.expandedTableList = [...this.graphNodeIds];\r\n                }\r\n            } else {\r\n                this.expandedTableList = [];\r\n            }\r\n            this.loadRelations();\r\n        },\r\n\r\n        async loadRelations() {\r\n            this.destroyGraph();\r\n            try {\r\n                const res = await this.request('get', '/er-data', {\r\n                    schema: this.currentSchema,\r\n                    tableName: this.activeTable,\r\n                    showAll: this.showAllColumns,\r\n                    expandedTables: this.expandedTableList.join(',')\r\n                });\r\n                if (this.viewMode === 'relation') {\r\n                    this.graphNodeIds = res.data.data.nodes.map(n => n.id);\r\n                    this.checkAutoExpandState();\r\n                    this.$nextTick(() => this.initGraph(res.data.data));\r\n                }\r\n            } catch (e) { }\r\n        },\r\n\r\n        checkAutoExpandState() {\r\n            if (this.graphNodeIds.length > 0) {\r\n                const allExpanded = this.graphNodeIds.every(id => this.expandedTableList.includes(id));\r\n                if (this.showAllColumns !== allExpanded) {\r\n                    this.showAllColumns = allExpanded;\r\n                }\r\n            }\r\n        },\r\n\r\n        handleGraphZoom(ratio) {\r\n            if (!this.graphInstance) return;\r\n            const zoom = this.graphInstance.getZoom();\r\n            this.graphInstance.zoomTo(zoom * ratio, { x: this.$refs.relationCanvas.offsetWidth / 2, y: this.$refs.relationCanvas.offsetHeight / 2 });\r\n        },\r\n        handleGraphFit() {\r\n            if (!this.graphInstance) return;\r\n            this.graphInstance.fitView();\r\n        },\r\n\r\n        initGraph(data) {\r\n            const container = this.$refs.relationCanvas; if (!container) return;\r\n            container.innerHTML = '';\r\n\r\n            const nodeCount = data.nodes.length;\r\n            const ranksep = nodeCount > 5 ? 150 : 100;\r\n\r\n            this.graphInstance = new G6.Graph({\r\n                container,\r\n                width: container.offsetWidth,\r\n                height: container.offsetHeight,\r\n                fitView: true,\r\n                fitViewPadding: 40,\r\n                renderer: 'canvas',\r\n                layout: {\r\n                    type: 'dagre',\r\n                    rankdir: 'LR',\r\n                    nodesep: 50,\r\n                    ranksep: ranksep\r\n                },\r\n                defaultNode: {\r\n                    type: 'db-table',\r\n                    anchorPoints: [[0, 0.5], [1, 0.5]]\r\n                },\r\n                defaultEdge: {\r\n                    type: 'cubic-horizontal',\r\n                    style: { stroke: '#A3B1BF', lineWidth: 2, endArrow: true },\r\n                    labelCfg: { autoRotate: true, style: { fontSize: 10, fill: '#aaa' } }\r\n                },\r\n                modes: { default: ['drag-canvas', 'zoom-canvas', 'drag-node'] }\r\n            });\r\n            this.graphInstance.data(JSON.parse(JSON.stringify(data)));\r\n            this.graphInstance.render();\r\n\r\n            this.graphInstance.on('node:click', (e) => {\r\n                const shapeName = e.target.get('name');\r\n                const nodeId = e.item.getModel().id;\r\n\r\n                if (shapeName === 'expand-text') {\r\n                    if (!this.expandedTableList.includes(nodeId)) {\r\n                        this.expandedTableList.push(nodeId);\r\n                        this.loadRelations();\r\n                    }\r\n                } else if (shapeName === 'collapse-text') {\r\n                    const index = this.expandedTableList.indexOf(nodeId);\r\n                    if (index > -1) {\r\n                        this.expandedTableList.splice(index, 1);\r\n                        this.showAllColumns = false;\r\n                        this.loadRelations();\r\n                    }\r\n                }\r\n            });\r\n\r\n            this.graphInstance.on('node:dblclick', (e) => {\r\n                const t = e.item.getModel().label;\r\n                if (t !== this.activeTable) {\r\n                    this.$emit('open-table', { connId: this.connId, schema: this.currentSchema, tableName: t, initViewMode: 'data' });\r\n                }\r\n            });\r\n        }\r\n    },\r\n    beforeDestroy() { this.destroyGraph(); }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n/* 保持原有样式，省略以节省空间，与提供的 TableDetail.vue 原始样式一致 */\r\n.table-detail-wrapper {\r\n    height: 100%;\r\n    display: flex;\r\n    flex-direction: column;\r\n    background: #f5f7fa;\r\n}\r\n\r\n.workspace-header {\r\n    background: #fff;\r\n    border-bottom: 1px solid #e4e7ed;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: space-between;\r\n    padding: 0 20px;\r\n    box-shadow: 0 1px 4px rgba(0, 21, 41, .08);\r\n    z-index: 10;\r\n}\r\n\r\n.content-area {\r\n    flex: 1;\r\n    padding: 15px;\r\n    display: flex;\r\n    flex-direction: column;\r\n    overflow: hidden;\r\n}\r\n\r\n.view-container {\r\n    height: 100%;\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: 12px;\r\n    background: #f5f7fa;\r\n}\r\n\r\n.full-height {\r\n    height: 100%;\r\n}\r\n\r\n.filter-card {\r\n    background: #fff;\r\n    padding: 12px;\r\n    border-radius: 4px;\r\n    box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.05);\r\n    flex-shrink: 0;\r\n}\r\n\r\n.compact-query-panel {\r\n    display: flex;\r\n    flex-direction: column;\r\n}\r\n\r\n.query-actions-top-bar {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    margin-bottom: 8px;\r\n}\r\n\r\n.panel-title {\r\n    font-weight: bold;\r\n    color: #303133;\r\n    font-size: 14px;\r\n}\r\n\r\n.query-conditions-scroll-area {\r\n    max-height: 120px;\r\n    overflow-y: auto;\r\n    padding: 5px;\r\n    background: #fafafa;\r\n    border-radius: 4px;\r\n    border: 1px dashed #dcdfe6;\r\n}\r\n\r\n.query-grid {\r\n    display: grid;\r\n    grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));\r\n    gap: 10px;\r\n}\r\n\r\n.query-item {\r\n    display: flex;\r\n    align-items: center;\r\n    gap: 8px;\r\n}\r\n\r\n.cond-index {\r\n    color: #909399;\r\n    font-size: 12px;\r\n    width: 15px;\r\n}\r\n\r\n.table-card {\r\n    flex: 1;\r\n    background: #fff;\r\n    border-radius: 4px;\r\n    box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.05);\r\n    padding: 12px;\r\n    display: flex;\r\n    flex-direction: column;\r\n    min-height: 0;\r\n}\r\n\r\n.data-toolbar {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    margin-bottom: 12px;\r\n}\r\n\r\n.data-stats {\r\n    font-size: 13px;\r\n    color: #606266;\r\n    background: #f4f4f5;\r\n    padding: 4px 10px;\r\n    border-radius: 4px;\r\n}\r\n\r\n.table-wrapper {\r\n    flex: 1;\r\n    min-height: 0;\r\n}\r\n\r\n.pagination-bar {\r\n    padding-top: 12px;\r\n    display: flex;\r\n    justify-content: flex-end;\r\n}\r\n\r\n.danger-text {\r\n    color: #F56C6C;\r\n}\r\n\r\n::v-deep .custom-table th>.cell {\r\n    display: flex !important;\r\n    align-items: center;\r\n    justify-content: flex-start;\r\n    line-height: 1.2;\r\n}\r\n\r\n.custom-header {\r\n    display: inline-flex;\r\n    flex-direction: column;\r\n    vertical-align: middle;\r\n    overflow: hidden;\r\n    text-overflow: ellipsis;\r\n    max-width: calc(100% - 24px);\r\n}\r\n\r\n::v-deep .custom-table .caret-wrapper {\r\n    margin-left: 4px;\r\n    flex-shrink: 0;\r\n}\r\n\r\n::v-deep .custom-table th {\r\n    background-color: #eef1f6 !important;\r\n    color: #303133;\r\n    font-weight: 600;\r\n    height: 40px;\r\n    padding: 4px 0;\r\n}\r\n\r\n::v-deep .custom-table td {\r\n    padding: 6px 0;\r\n}\r\n\r\n::v-deep .el-table--striped .el-table__body tr.el-table__row--striped td {\r\n    background: #fafafa;\r\n}\r\n\r\n::v-deep .el-table--border,\r\n.el-table--group {\r\n    border-color: #dcdfe6;\r\n}\r\n\r\n::v-deep .el-table td,\r\n::v-deep .el-table th.is-leaf {\r\n    border-bottom: 1px solid #dcdfe6;\r\n}\r\n\r\n::v-deep .el-table--border td,\r\n::v-deep .el-table--border th {\r\n    border-right: 1px solid #dcdfe6;\r\n}\r\n\r\n.col-name {\r\n    font-size: 13px;\r\n    white-space: nowrap;\r\n    overflow: hidden;\r\n    text-overflow: ellipsis;\r\n}\r\n\r\n.col-comment {\r\n    font-size: 12px;\r\n    color: #909399;\r\n    font-weight: normal;\r\n    transform: scale(0.95);\r\n    transform-origin: left;\r\n    white-space: nowrap;\r\n    overflow: hidden;\r\n    text-overflow: ellipsis;\r\n}\r\n\r\n.inline-input-box {\r\n    width: 100%;\r\n    padding: 0 2px;\r\n}\r\n\r\n::v-deep .inline-input-box .el-input__inner {\r\n    height: 26px;\r\n    line-height: 26px;\r\n    padding: 0 5px;\r\n    border-radius: 0;\r\n    border: 1px solid #409EFF;\r\n}\r\n\r\n.conflict-alert {\r\n    background: #fdf6ec;\r\n    color: #e6a23c;\r\n    padding: 12px 15px;\r\n    border-radius: 4px;\r\n    display: flex;\r\n    align-items: center;\r\n    font-size: 14px;\r\n    border: 1px solid #faecd8;\r\n}\r\n\r\n.relation-view-container {\r\n    height: 100%;\r\n    display: flex;\r\n    flex-direction: column;\r\n    background: #f5f7fa;\r\n    position: relative;\r\n    overflow: hidden;\r\n}\r\n\r\n.relation-toolbar {\r\n    padding: 10px 20px;\r\n    background: #fff;\r\n    border-bottom: 1px solid #eee;\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    z-index: 10;\r\n}\r\n\r\n.legend-box {\r\n    display: flex;\r\n    align-items: center;\r\n    gap: 15px;\r\n    font-size: 12px;\r\n    color: #666;\r\n}\r\n\r\n.dot {\r\n    width: 8px;\r\n    height: 8px;\r\n    display: inline-block;\r\n    border-radius: 50%;\r\n    margin-right: 5px;\r\n}\r\n\r\n.dot.active {\r\n    background: #409EFF;\r\n}\r\n\r\n.dot.normal {\r\n    background: #DCDFE6;\r\n}\r\n\r\n.canvas-wrapper {\r\n    width: 100%;\r\n    height: 100%;\r\n    background: #f5f7fa;\r\n    overflow: hidden;\r\n    position: relative;\r\n}\r\n\r\n.g6-canvas-box {\r\n    width: 100%;\r\n    height: 100%;\r\n    display: block;\r\n}\r\n\r\n.sql-box {\r\n    padding: 0;\r\n    background: #fff;\r\n    border-radius: 4px;\r\n    box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.05);\r\n    display: flex;\r\n    flex-direction: column;\r\n    overflow: hidden;\r\n    height: 300px;\r\n}\r\n\r\n.sql-result {\r\n    flex: 1;\r\n    margin-top: 10px;\r\n    overflow: auto;\r\n    background: #fff;\r\n    padding: 10px;\r\n    border-radius: 4px;\r\n}\r\n\r\n.error-dialog-width {\r\n    max-width: 500px;\r\n}\r\n</style>"]}]}